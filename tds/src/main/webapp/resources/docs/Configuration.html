<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html><head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>Configuration</title>
  <link rel="stylesheet" href="/thredds/upc.css" type="text/css">
</head>
<body>


<table width="100%">
    <tbody><tr>
        <td align="left" height="95" width="95"><img src="../unidataLogo.gif" height="93" width="95"> </td>
        <td align="left" valign="top" width="701">
            <table width="303">
                <tbody><tr>
                  <td align="left" height="22" valign="top" width="295"><h3><strong>Thredds Data Server </strong></h3></td>
                </tr>
            </tbody></table>
        </td>
    </tr>
</tbody></table>

<div class="head">
  <h1>TDS Configuration Reference </h1>
  <address>
  last update: April 4, 2006 
  </address>
  <hr>
  <div class="head"></div>
  <h2>Quick Reference </h2>
  <p>Follow
these simple rules when forming catalog URLS. Read the rest of this
page (and the other TDS web pages) to understand this in more depth.</p>
  <p><strong>Rule 1<a name="Rule1"></a></strong>. Always use the  <em>context name</em> (eg &quot;thredds&quot;) and the <em>servlet name</em> (eg &quot;dodsC&quot;) for the base attributes in the service elements. For the  integrated TDS data servers use:</p>
  <ul>
    <li><strong>OpenDAP server</strong>:  &lt;<strong>service</strong> name="ncdods" serviceType="OpenDAP" base="<strong>/thredds/dodsC/</strong>" &gt;</li>
    <li><strong>HTTP  bulk file server </strong>: &lt;<strong>service</strong> name="fileServer" serviceType="HTTPServer" base="<strong>/thredds/fileServer/"</strong> &gt;</li>
    <li><strong>WCS Server </strong>: &lt;<strong>service</strong> name="wcsServer" serviceType="WCS" base="<strong>/thredds/wcs/</strong>" &gt;</li>
  </ul>
  <p>Note
that these base URLs are relative, so your catalogs are independent of
your server hostname and port. </p>
  <p><strong>Rule 2</strong><a name="Rule2"></a>. For each set of files that you want to serve, name them with a unique<em><strong> path</strong></em>. The path becomes part of the externally visable URL for those files. Choose something that you will easily remember and associate with those files. <em>Make sure that the path is unique for the entire TDS server.</em> </p>
  <p>Each set of files must be contained under a single file directory (and
  its subdirectories). A directory can be associated with more than one path,
  but each path must be associated with only one directory. Associate the
  directory with the path either through a datasetScan element or a
  datasetRoot element:</p>
  <blockquote>
    <p><strong>Rule 2.1</strong> <a href="datasetScan/index.html">Use a datasetScan element</a>
in the TDS catalog to dynamically generate the catalogs based on whats
in the directory. The works best when all the files are the same data
type, format etc, especially if they only differ by their time range. </p>
    <p><strong>Rule 2.2 </strong><a href="#datasetRoot">Use a datasetRoot element</a> when you need to generate all the catalogs yourself. </p>
  </blockquote>
  <p><strong>Rule 3<a name="Rule3"></a></strong>:
Each complete dataset URL must start with the hostname and port,
followed by the service base, followed by the path, followed by a real
filename rooted at the directory corresponding to the path. </p>
  <p><strong>Example</strong>:</p>
  <blockquote>
    <pre><strong>http://hostname:8080/thredds/dodsC/model/ncep/run0023/mydata.nc</strong></pre>
  </blockquote>
  <p>has 4 parts:</p>
  <ol>
    <li><strong>http://hostname:8080</strong> is the server's hostname and port. By using reletive URLs as shown here, you never have to specify this explicitly in your catalogs. This means you can change hosts or ports without having to rewrite your catalogs. </li>
    <li><strong>/thredds/dodsC</strong>/ is the TDS service base</li>
    <li><strong>model/ncep</strong> is the path, associated with a directory by a datasetScan or datasetRoot element. </li>
    <li>  <strong>run0023/mydata.nc</strong> is the filename, reletive to the directory associated with <strong>model/ncep</strong>.</li>
  </ol>
  <p>You might create this in your catalog like this: </p>
  <blockquote>
    <pre>&lt;service name="ncdods" serviceType="OpenDAP" base="<strong>/thredds/dodsC/</strong>"&gt;<br>  <strong>&lt;datasetRoot </strong>path<strong>="model/ncep" </strong>location<strong>="C:/data/ncep/" /&gt;</strong>
&lt;/service&gt;

&lt;dataset name="Model Data" serviceName="ncdods" urlPath="<strong>model/ncep/run0023/mydata.nc</strong>" /&gt;</pre>
  </blockquote>
  <p> A THREDDS client forms the dataset URL by concatenating the service base with the dataset urlPath, getting:</p>
  <blockquote>
    <pre><strong>/thredds/dodsC/model/ncep/run0023/mydata.nc</strong>
</pre>
  </blockquote>
  <p>This is a URL reletive to the catalog in which it lives, lets say the catalog URL is <strong>http://hostname:8080/thredds/any/thing/catalog.xml</strong>. The rules for resolving a reletive URL that starts with a "/" would then make the absolute path </p>
  <blockquote>
    <pre><strong>http://hostname:8080/thredds/dodsC/model/ncep/run0023/mydata.nc</strong>
</pre>
  </blockquote>
  <p>When the TDS receives this URL, it skips the <strong>/thredds/dodsC/</strong> part, and looks for a data root that matches the remaining <strong>model/ncep/run0023/mydata.nc. </strong>It will find the <strong>model/ncep</strong> root, and substitute the location for it, yielding the file <strong>C:/data/ncep/run0023/mydata.nc</strong>.<br>
  </p>
  <h2><a name="datasetRoot"></a>Configuring Dataset Roots
  </h2>
  <p>Configuring
a Thredds Data Server (TDS) mostly involves creating Catalogs that
describe the data to be served. However, there are a few subtle issues
that can be confusing. Its best to think of a Catalog as an XML
document that a <em>client</em> uses to access remote data. A TDS
needs to augment these client side catalogs with information needed
only on the server, in order to associate local file directories with
dataset URL paths.</p>
  <p>A <em><strong>datasetRoot</strong></em> element is a subelement of a service, for example </p>
  <pre>&lt;service name="ncdods" serviceType="OpenDAP" base="<strong>/thredds/dodsC/</strong>"&gt;<br>  <strong>&lt;datasetRoot </strong>path<strong>="model" </strong>location<strong>="C:/data/ncep/" /&gt;</strong>
&lt;/service&gt;
</pre>
  <p>This associates all datasets that start with <strong>/thredds/dodsC/model/</strong> with the local directory <strong>C:/data/ncep/</strong>, so a dataset using that service, for example </p>
  <pre>  &lt;dataset name="Model Data" serviceName="ncdods" urlPath="<strong>model/run0023/mydata.nc</strong>" /&gt;</pre>
  <p>refers to the file <strong>C:/data/ncep/run0023/mydata.nc. </strong>Note that the <strong>location</strong> is substituted for the <strong>path</strong> when forming the file location on the server. The client does not deal with that - it just uses the dataset URL. </p>
  <p>You can have as many datasetRoot elements as you want in a service element:</p>
  <pre>&lt;service name="ncdods" base="/thredds/dodsC/"&gt;<br>  <strong>&lt;datasetRoot </strong>path<strong>="model" </strong>location<strong>="/data/ncep/" /&gt;</strong><strong></strong>
  <strong>&lt;datasetRoot </strong>path<strong>="obs" </strong>location<strong>="/data/raw/metars/" /&gt;<br></strong><strong></strong>  <strong>&lt;datasetRoot </strong>path<strong>="cases/001" </strong>location<strong>="/casestudy/data/001/" /&gt;</strong><strong></strong>
&lt;/service&gt;</pre>
  <p>A <strong><em>datasetScan</em></strong>
element is a kind of dataset that automatically scans a local directory
and generates datasets for some or all files in it. It contains the
same attributes as a datasetRoot element, and acts exactly like a
datasetRoot element applied to its default service, for example </p>
  <pre> &lt;service name="myserver" serviceType="OpenDAP" base="<strong>/thredds/dodsC</strong>" /&gt;<strong>
 &lt;datasetScan </strong>name="My Data"<strong> </strong>path<strong>="myData" </strong>location<strong>="c:/my/data/" </strong>serviceName<strong>="</strong>myserver<strong>" /&gt;</strong></pre>
  <p>The TDS will scan <strong>c:/my/data/</strong> and generate a dataset for each file. These generated datasets will start with <strong>/thredds/dodsC/myData/</strong> and get mapped back to <strong>c:/my/data/</strong>. See <a href="datasetScan/index.html">here</a> for more details and options on datasetScan elements. </p>
  <p>You
must use datasetRoot and/or datasetScan elements to associate local
file directories with dataset URL paths, in order for TDS to work. When
TDS starts up, it will read the <em>top-level catalog</em> at <strong>${tomcat_home}/content/thredds/catalog.xml, </strong>and recursively read all catalogs that are linked to it through a relative <em>CatalogRef</em> element (i.e. a catalog that lives somewhere under <strong>${tomcat_home}/content/thredds/</strong>), and determine the dataset roots. You must make sure that these dataset paths are unique for the entire set of catalogs.</p>
  <p>The directory pointed to by <strong>location</strong> should be absolute. The one exception is that if location starts with <em><strong>content/ </strong></em>then the directory <strong>${tomcat_home}/content/thredds/</strong> is substituted for it. However, in general, you should keep your data separate and not use this option. </p>
  <h2>Serving the same Dataset in different ways </h2>
  <p>Since
adding metadata to catalogs can be time-consuming, it is convenient to
do this in only one place while specifying more than one way to serve
the same dataset. TDS currently has several services that might be used
in this way: <strong>OpenDAP </strong> allows sophisticated file subsetting.<strong> HTTPServer</strong> does bulk file transfer using the HTTP protocol. <strong>WCS</strong> also allows file subsetting but is only useful for gridded data. New services are in the process of being added. </p>
  <p>To specify  more than one  way to serve the same dataset, create a <em><strong>Compound</strong></em> service like this: </p>
  <pre> &lt;service name="<strong>multiple</strong>" serviceType="<strong>Compound</strong>" base="" &gt;<br>  &lt;service name="ncdods" serviceType="<strong>OpenDAP</strong>" base="<strong>/thredds/dodsC/</strong>" /&gt;<br>  &lt;service name="HTTPServer" serviceType="<strong>HTTPServer</strong>" base="<strong>/thredds/fileServer/</strong>" /&gt;<br>  &lt;service name="WCS" serviceType="<strong>WCS</strong>" base="<strong>/thredds/wcs/</strong>" /&gt;<br> &lt;/service&gt;</pre>
  <p>This defines a compound service with three nested services. Any dataset using this
service will have three access URLs, corresponding to the three nested
services. (Note that according to <a href="#Rule1">Rule 1</a>, the service base values must be done exactly as
shown, since they define the servlet paths used by the TDS). For
example: </p>
  <pre> &lt;dataset name="Model Data" serviceName="<strong>multiple</strong>" urlPath="<strong>models/aug/mydata.nc</strong>" /&gt;</pre>
  <p>then the access URLs for it will be, according to <a href="#Rule3">Rule 3</a>:</p>
  <pre><strong>  /thredds/dodsC/models/aug/mydata.nc <br>  /thredds/fileServer/models/aug/mydata.nc <br>  /thredds/wcs/models/aug/mydata.nc </strong></pre>    
  <p><strong>  </strong>When specifying dataset roots, only put them in the Compound service, not in the nested services:</p>
  <pre> &lt;service name="multiple" serviceType="Compound" base="" &gt;<br>  &lt;service name="ncdods" serviceType="OpenDAP" base="/thredds/dodsC/" /&gt;<br>  &lt;service name="HTTPServer" serviceType="HTTPServer" base="/thredds/fileServer/" /&gt;<br>  &lt;service name="WCS" serviceType="WCS" base="/thredds/wcs/" /&gt;<br><strong>  &lt;datasetRoot </strong>path<strong>="models" </strong>location<strong>="/data/ncep/" /&gt;</strong><strong></strong>
 &lt;/service&gt;</pre>
</div>
Note that the service base and the datasetRoot path are replaced by the
datasetRoot directory, so the local file will be the same for all three
services, namely:
<pre><strong>  /data/ncep/aug/mydata.nc</strong></pre>
<p> You can use compound services with datasetScan elements also, and
it works exactly the same. Note in that case, you don't have to add a <strong>datasetRoot</strong> element, as the <strong>datasetScan</strong> element is equivalent to adding a <strong>datasetRoot</strong> element to the <strong>datasetScan's</strong> default service. </p>
<h2>Multiple Top Catalogs</h2>
<p>The TDS processes catalog files in various special ways, and needs
to have a list of all the catalogs it will serve when it starts up. By
default, it reads the<em><strong> top-level catalog</strong></em> at <strong>${tomcat_home}/content/thredds/catalog.xml</strong> and recursively follows all relative <strong>catalogRefs</strong>,
in order to construct the list of catalogs. If you want to serve other
catalogs that are not linked to the top-level catalog, then list them
in <strong>${tomcat_home}/content/thredds/extraCatalogs.txt</strong>. </p>
<p>An example <strong>extraCatalogs.txt</strong>:</p>
<pre>topcatalog.xml<br>idv/rt-models.1.0.xml<br>idv/rt-models.xml<br>cataloggen/catalogs/idv-rt-models.InvCat1.0.xml<br>cataloggen/catalogs/idv-rt-models.xml<br>cataloggen/catalogs/uniModelsInvCat1.0en.xml</pre>
<p>Note that all catalog filenames must be relative to the <strong>${tomcat_home}/content/thredds/ </strong>directory. Any line starting with a pound sign ("#") is considered a comment.<br>
</p>
<div class="head"></div>
<h2> Links</h2>
<ul>
  <li>The catalog <a href="http://www.unidata.ucar.edu/schemas/thredds/InvCatalog.1.0.1.xsd">schema</a>, version 1.0.1</li>
</ul>
<hr width="100%">
<p align="left"> <i><span class="head">Comments to <a href="mailto:thredds@unidata.ucar.edu">THREDDS mailgroup</a> or <a href="mailto:support-thredds@unidata.ucar.edu">THREDDS support</a>  </span></i></p>
<p><i>Go to: <a href="http://www.unidata.ucar.edu/projects/THREDDS/tech/index.html">THREDDS Tech Page</a></i> or <i> <a href="http://www.unidata.ucar.edu/projects/THREDDS/">THREDDS Home Page</a></i> <img src="../thredds.jpg" height="79" width="95"><br>
</p>
</body></html>