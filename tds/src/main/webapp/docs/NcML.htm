<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Untitled Document</title>
  <link rel='stylesheet' href='/thredds/upc.css' type='text/css' />  

</head>

<body>
<table width="100%">
  <tbody>
    <tr>
      <td align="left" height="95" width="95"><img src="../unidataLogo.gif" height="93" width="95"> </td>
      <td align="left" valign="top" width="701"><table width="303">
          <tbody>
            <tr>
              <td align="left" height="22" valign="top" width="295"><h3><strong>Thredds Data Server</strong></h3></td>
            </tr>
          </tbody>
      </table></td>
    </tr>
  </tbody>
</table>
<div class="head">
  <h1>Using NcML-2.2 in TDS</h1>
  <address>
  last update: May 04, 2006 
  </address>
  <hr>
  <p>An <em><strong>NcML document</strong></em> is an XML document that uses the <a href="http://www.unidata.ucar.edu/software/netcdf/ncml/">NetCDF Markup Language</a> to define a netCDF dataset.  If you add an <em><strong>NcML</strong></em> element to a THREDDS <strong>dataset</strong> element, the dataset element then refers to the NcML dataset. This works for serviceTypes <em><strong>OPENDAP</strong></em> or <em><strong>WCS</strong></em>.</p>
  <p>Here is an example that defines a dataset using NcML aggregation:.</p>
  <pre>&lt;catalog xmlns=&quot;http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0&quot; 
         xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; 
         name=&quot;THREDDS-IDD OPeNDAP Data Server&quot; version=&quot;1.0.1&quot;&gt;

(1)&lt;service name=&quot;ncdods&quot; serviceType=&quot;OPENDAP&quot; base=&quot;/thredds/dodsC/&quot; /&gt;

(2)&lt;dataset name=&quot;WEST-CONUS_4km Aggregation&quot; ID=&quot;SSEC/IDD-Satellite/3.9/WEST-CONUS_4km-Agg&quot; <strong>urlPath</strong>=&quot;satellite/3.9/WEST-CONUS_4km&quot;&gt;
(3)  &lt;serviceName&gt;ncdods&lt;/serviceName&gt;

(4)  &lt;<strong>netcdf</strong> xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;
(5)   &lt;<strong>aggregation</strong> dimName=&quot;time&quot; type=&quot;<strong>joinNew</strong>&quot;&gt;
(6)     &lt;<strong>variableAgg</strong> name=&quot;IR&quot; /&gt;
(7)     &lt;<strong>scan</strong> dateFormatMark=&quot;WEST-CONUS_4km_3.9_#yyyyMMdd_HHmm&quot; location=&quot;/data/ldm/pub/native/satellite/3.9/WEST-CONUS_4km/&quot; suffix=&quot;.gini&quot; /&gt;
      &lt;/<strong>aggregation</strong>&gt;
     &lt;/<strong>netcdf</strong>&gt;

   &lt;/dataset&gt;
&lt;/catalog&gt;</pre>
  <ol>
    <li>An OPENDAP service is defined called <strong><em>ncdods</em></strong>. </li>
    <li>A THREDDS dataset is defined, which must have a <strong>urlPath</strong> that is unique within the TDS, in this case <em><strong>satellite/3.9/WEST-CONUS_4km. </strong></em></li>
    <li>The dataset uses the <em><strong>ncdods</strong></em> service.</li>
    <li>An <strong>NcML</strong> <strong>netcdf</strong> element is embedded inside the THREDDS dataset element. Note that you must declare the NcML namespace exactly as <em><strong>http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2</strong></em>.</li>
    <li>An NcML <strong>aggregation</strong> of type <strong>joinNew</strong> is declared, using a new dimension called time.</li>
    <li>The variable named <em><strong>IR</strong></em> will be aggregated.</li>
    <li>All the files in the directory <em><strong>/data/ldm/pub/native/satellite/3.9/WEST-CONUS_4km/ </strong></em>that end with <em><strong>.gini</strong></em> will be scanned to create the aggregation.</li>
  </ol>
  <p>&nbsp;</p>
  <p>The above example creates a <em>virtual dataset</em> through aggregation. You can use also use NcML to modify an existing NetCDF dataset:</p>
  <pre>&lt;catalog xmlns=&quot;http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0&quot; 
         xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; 
         name=&quot;THREDDS-IDD OPeNDAP Data Server&quot; version=&quot;1.0.1&quot;&gt;

(1)&lt;service name=&quot;all&quot; <strong>serviceType=&quot;Compound&quot;</strong> base=&quot;&quot;&gt;     <br>     &lt;service name=&quot;ncdods&quot; serviceType=&quot;<strong>OPENDAP</strong>&quot; <strong>base</strong>=&quot;/thredds/dodsC/&quot;/&gt;<br>     &lt;service name=&quot;WCSServer&quot; serviceType=&quot;<strong>WCS</strong>&quot; <strong>base</strong>=&quot;/thredds/wcs/&quot; /&gt;<br>   &lt;/service&gt;

(2)&lt;dataset name=&quot;Example NcML Modified&quot; <strong>ID</strong>=&quot;ExampleNcMLModified&quot; <strong>urlPath</strong>=&quot;ExampleNcML/Modified.nc&quot;&gt;
     &lt;serviceName&gt;all&lt;/serviceName&gt;

(3)  &lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot; <strong>location=&quot;/data/nc/example.nc&quot;</strong>&gt;<br>(4)    &lt;variable name=&quot;Temperature&quot; <strong>orgName</strong>=&quot;T&quot;/&gt;
(5)    &lt;variable name=&quot;ReletiveHumidity&quot; <strong>orgName</strong>=&quot;rh&quot;&gt;
(6)      &lt;attribute name=&quot;<strong>long_name</strong>&quot; value=&quot;relatively humid&quot;/&gt;
         &lt;attribute name=&quot;<strong>units</strong>&quot; value=&quot;percent (%)&quot;/&gt;
(7)      &lt;remove type=&quot;attribute&quot; name=&quot;<strong>description</strong>&quot;/&gt;
       &lt;/variable &gt;
     &lt;/netcdf&gt;

  &lt;/dataset&gt;
&lt;/catalog&gt;</pre>
  <ol>
    <li>A compound service is defined that allows the dataset to be served through  both <em><strong>OPENDAP</strong></em> and <em><strong>WCS</strong></em>. Make sure that the <strong>base</strong> attributes are exactly as shown </li>
    <li>The dataset is given a <strong>urlPath</strong> of &quot;ExampleNcML/Modified.nc&quot;. Its important to also give the dataset a unique <strong>ID</strong>.</li>
    <li>An NcML dataset is defined which references the netCDF file at <strong>/data/nc/example.nc</strong>.</li>
    <li>The variable named <strong>T</strong> in the original file is renamed Temperature.</li>
    <li>The variable named <strong>rh</strong> in the original file is renamed ReletiveHumidity.</li>
    <li>Two attributes of <strong>rh</strong> are defined, <strong>long_name</strong> and <strong>units</strong>. If these already exist, they are replaced.</li>
    <li>The attribute of <strong>rh</strong> called <strong>description</strong> is removed.</li>
  </ol>
  <p>&nbsp;</p>
  <p>If an NcML element is added to a <a href="datasetScan/index.html">DatasetScan</a>, it will modify all of the datasets contained within the DatasetScan: </p>
  <pre>(1)&lt;datasetScan name=&quot;testAddRecords&quot; ID=&quot;testAddRecords&quot; path=&quot;testAddRecords&quot; dirLocation=&quot;R:/testdata/tds/netcdf/&quot; filter=&quot;.*\.nc$&quot;&gt;<br>(2)  &lt;metadata <strong>inherited</strong>=&quot;true&quot;&gt;<br>       &lt;serviceName&gt;ncdods&lt;/serviceName&gt;<br>       &lt;dataType&gt;Grid&lt;/dataType&gt;<br>     &lt;/metadata&gt;<br>(3)  &lt;<strong>netcdf</strong> xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot; <strong>enhance</strong>=&quot;true&quot; /&gt;<br>(4)  &lt;addID /&gt;<br>   &lt;/datasetScan&gt;</pre>
  <ol>
    <li>A datasetScan element is created whose contained datasets start with URL path <strong>testAddRecords</strong>, and whose contents are all the files in the directory <strong>R:/testdata/tds/netcdf/</strong> which end in <strong>.nc</strong>. </li>
    <li>All contained datasets <em>inherit</em> metadata indicating they use the <strong>ncdods</strong> service and are of type <strong>Grid</strong>. </li>
    <li>All contained datasets are <em>wrapped</em> by this ncml element. In this case, they are <em>enhanced</em> by calling NetcdfDataset.enhance(), which identifies coordinate systems,  deals with packed values, etc. Note that there is no <strong>location</strong> attribute, which is implicitly supplied by the contained datasets.</li>
    <li>This element causes <strong>ID</strong> attributes to be added to each of the datasets contained in the DatasetScan. <br>
    </li>
  </ol>
  <h3>Related Documents:</h3>
  <ul>
    <li><a href="http://www.unidata.ucar.edu/software/netcdf/ncml/">NetCDF Markup Language</a></li>
    <li><a href="http://www.unidata.ucar.edu/software/netcdf/ncml/v2.2/Aggregation.html">NcML Aggregation </a></li>
    <li><a href="datasetScan/index.html">DatasetScan</a></li>
  </ul>
  <p></p>
</div>
<hr width="100%">
<p align="left"> <i><span class="head">Comments to <a href="mailto:thredds@unidata.ucar.edu">THREDDS mailgroup</a> or <a href="mailto:support-thredds@support.unidata.ucar.edu">THREDDS support</a>  </span></i></p>
<p><i>Go to: <a href="http://www.unidata.ucar.edu/projects/THREDDS/tech/index.html">THREDDS Tech Page</a></i> or <i> <a href="http://www.unidata.ucar.edu/projects/THREDDS/">THREDDS Home Page</a></i> <img src="../thredds.jpg" height="79" width="95"><br>
</p>
</body>
</html>
