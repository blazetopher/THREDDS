<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Untitled Document</title>
</head>

<body>
<h1>BUFR Decoding Issues</h1>
<hr width="100%" />
<h2>1. Errors in the <a href="http://www.wmo.int/pages/prog/www/WMOCodes/Operational/BUFR/BufrTabB-11-2007.pdf">WMO Master Table  version 13</a></h2>
<h3><strong>0-22-39</strong> </h3>
<p>has bit width 13, apparently it should be bit width 12. </p>
<h3 wrap="">3 02 044</h3>
<pre wrap="">3 02 044 (Evaporation data)  
   0 04 024 Time period in hours
   0 02 004 Type of instrument for evaporation or crop type for evapotranspiration
   0 13 003 Relative humidity 
</pre>
<p wrap=""> however it should be: </p>
<pre wrap="">
   0 04 024 Time period in hours
   0 02 004 Type of instrument for evaporation or crop type for evapotranspiration
   <strong>0 13 033 Evaporation /evapotranspiration</strong></pre>
<hr width="100%" />
<h2>2. Use of BUFR Tables </h2>
<h3>1. Use of <strong>standard WMO data descriptor ranges in local tables </strong></h3>
<p>For both table B and table D, the areas x &lt; 48, and y &lt; 192 are reserved for  standard WMO tables. We sometimes see local tables using descriptors in this range. We assume that this is incorrect, and BUFR records that rely on this kind of <em>local override</em> will fail, at least in the CDM BUFR library.</p>
<h3>2.  Incorrect use of master table version numbers </h3>
<p>We sometimes see BUFR records where the  version number of the master table is incorrectly specified, typically assuming elements from a later version of the master table. We assume that all versions of the master table are backwards compatible up to version 13. Therefore, we use version 13 table no matter what the BUFR record says, and so we tolerate the incorrect encoding of the master table version.</p>
<p>Starting with version 14, master tables will no longer be backwards compatible, therefore data providers must correctly encode the master table version for versions 14 and greater.</p>
<hr width="100%" />
<h2 wrap="">3. BUFR Record encoding ambiguities</h2>
<h3 wrap="">1.Compression with delayed replication</h3>
<p wrap="">From <a href="http://www.wmo.int/pages/prog/www/WMOCodes/Operational/BUFR/FM94REG-11-2007.pdf">FM94REG-11-2007.pdf</a>:  </p>
<p wrap="">&quot;The binary data in compressed form may be described as follows:</p>
<pre wrap="">
   Ro1, NBINC1, I11, I12, . . . I1n
   Ro2, NBINC2, I21, I22, . . . I2n
   ... 
   Ros, NBINCs, Is1, Is2, . . . Isn
</pre>
<p wrap="">  where Ro1, Ro2, . . . Ros are local reference values for the set of values for each data element (number of bits as Table B). NBINC1 . . . NBINCs contain, as 6-bit quantities, the number of bits occupied by the increments (I11 . . . I1n) . . . (Is1 . . . Isn). s is the number of data elements per data subset and n is the number of data subsets per BUFR message.&quot;    </p>
<p wrap="">What happens if we combine compression with replication?</p>
<p wrap="">Let C be the entire compressed block for one dataset, as above. Then regular replication just repeats C for each dataset in the replication:</p>
<pre wrap="">  C1, C2,... Cm</pre>
<p wrap="">One might guess that delayed replication would look just like regular replication preceded by the replication count, that is:</p>
<pre wrap="">  m, C1, C2,... Cm</pre>
<p wrap="">where m is the replication count using the number of bits specified in the replication descriptor element. However, for some BUFR records, I am seeing an extra 6 bits, that is:</p>
<pre wrap="">  m, x, C1, C2,... Cm</pre>
<p wrap="">Where x appears to be 6 zero bits. </p>
<p wrap="">There is no description of how compression with delayed replication is encoded in <a href="http://www.wmo.int/pages/prog/www/WMOCodes/Operational/BUFR/FM94REG-11-2007.pdf">FM94REG-11-2007.pdf</a>. The <a href="http://www.ecmwf.int/products/data/d/check/">ECMWF BUFR/CREX format checker</a> decodes <a href="bufrData/LNDSYN.bufr">this example of compression with delayed replication</a> correctly, so it must be assuming the extra 6 bits. Do other decoders? This should be clarified in the official documentation.</p>
<p wrap="">&nbsp;</p>
<h2 wrap="">4. BUFR  encoding complexities</h2>
<p wrap="">&quot;Table C operator descriptors 2 22 000 through 2 37 255 provide a more sophisticated method of including quality assessment information in BUFR&quot;. These methods are so badly done as to warp the very fabric of space-time. Therefore, they should be avoided by writers. However, it should be noted that decoding them produces a not-unpleasant feeling of disembodiment and lightheadedness, and deep compassion for tortured minds, and incurable insanity wherever it is found. </p>
<hr width="100%" />
<p><a href="index.html">BUFR Tables Home page</a></p>
<p>&nbsp;</p>
<address>
<a href="NetcdfUsers.htm"><img src="nc.gif" alt="vv" width="64" height="64" border="0" /></a> This document is maintained by <a href="mailto:caron@unidata.ucar.edu">John Caron</a> and was last updated on Oct 26, 2008
</address>
</body>
</html>
