<html>
<head>
<title>NcML Tutorial</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<h1>NcML Tutorial </h1>
<h2>Introduction</h2>
<p>A <em><strong>netCDF-3 file</strong></em> is a physical file that uses the netCDF file format (version 1). A <em><strong>netCDF-4 file</strong></em> is a physical file that uses a specialized version of the HDF-5 file format, called the netCDF-4 file format. The NetCDF-Java library can read a number of other binary file formats, such as GRIB and NEXRAD radar files, and make the data accessible through the standard netCDF API. A <b><i>netCDF dataset</i></b>, then, is any scientific data collection which is accessible through the  netCDF API. </p>
<p>The <em><strong>NetCDF Markup Language (NcML)</strong></em> is an XML dialect that allows you to create netCDF datasets. An <em><strong>NcML document</strong></em> is an XML document that uses NcML, and defines a netCDF dataset. Commonly, the NcML document refers  to another netCDF dataset called the <em><strong>referenced netCDF dataset</strong></em>. The purpose of NcML is to allow: </p>
<ol>
  <li>Metadata to be added, deleted, changed and in general redefined.</li>
  <li>Variables to be renamed, added, deleted and restructured.</li>
  <li>Data from multiple NetCDF files to be combined.</li>
</ol>
<p>See also: <a href="AnnotatedSchema.html">Annotated NcML Schema</a> </p>
<h2><b>1. Completely specify the NetCDF Dataset Metadata</b></h2>
<p>In this example, the use of the <strong>&lt;explicit/&gt;</strong> element means that all of the metadata is specified in the XML, and the referenced dataset is used only for data access. If there are any other attributes, variables 
  or dimensions in the referenced dataset, they are ignored.</p>
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot; 
     location=&quot;file:/dev/netcdf-java-2.2/test/data/example1.nc&quot;&gt;

  &lt;explicit/&gt;
<br>  &lt;dimension name=&quot;time&quot; length=&quot;2&quot; isUnlimited=&quot;true&quot; /&gt;<br>  &lt;dimension name=&quot;lat&quot; length=&quot;3&quot; /&gt;<br>  &lt;dimension name=&quot;lon&quot; length=&quot;4&quot; /&gt;
<br>  &lt;attribute name=&quot;title&quot; type=&quot;String&quot; value=&quot;Example Data&quot; /&gt;
<br>  &lt;variable name=&quot;rh&quot; shape=&quot;time lat lon&quot; type=&quot;int&quot;&gt;<br>    &lt;attribute name=&quot;long_name&quot; type=&quot;String&quot; value=&quot;relative humidity&quot; /&gt;<br>    &lt;attribute name=&quot;units&quot; type=&quot;String&quot; value=&quot;percent&quot; /&gt;<br>  &lt;/variable&gt;
<br>  &lt;variable name=&quot;T&quot; shape=&quot;time lat lon&quot; type=&quot;double&quot;&gt;<br>    &lt;attribute name=&quot;long_name&quot; type=&quot;String&quot; value=&quot;surface temperature&quot; /&gt;<br>    &lt;attribute name=&quot;units&quot; type=&quot;String&quot; value=&quot;C&quot; /&gt;<br>  &lt;/variable&gt;
<br>  &lt;variable name=&quot;lat&quot; shape=&quot;lat&quot; type=&quot;float&quot;&gt;<br>    &lt;attribute name=&quot;units&quot; type=&quot;String&quot; value=&quot;degrees_north&quot; /&gt;
    &lt;values&gt;41.0 40.0 39.0&lt;/values&gt;<br>  &lt;/variable&gt;
<br>  &lt;variable name=&quot;lon&quot; shape=&quot;lon&quot; type=&quot;float&quot;&gt;<br>    &lt;attribute name=&quot;units&quot; type=&quot;String&quot; value=&quot;degrees_east&quot; /&gt;
    &lt;values&gt;-109.0 -107.0 -105.0 -103.0&lt;/values&gt;<br>  &lt;/variable&gt;
<br>  &lt;variable name=&quot;time&quot; shape=&quot;time&quot; type=&quot;int&quot;&gt;<br>    &lt;attribute name=&quot;units&quot; type=&quot;String&quot; value=&quot;hours&quot; /&gt;
    &lt;values&gt;6 18&lt;/values&gt;<br>  &lt;/variable&gt;<br>&lt;/netcdf&gt;
</pre>
  
<p>Data for the <b>lat</b>, <b>lon</b> and <b>time</b> coordinate variables comes 
    from the NcML document, while the data for the <b>rh</b> and <b>T</b> variables 
    will be obtained from the referenced dataset at URL <i>file:/dev/netcdf-java-2.2/test/data/example1.nc.</i> Note that this is a URL that uses the <em><strong>file:</strong></em> scheme. It is allowable to omit the <em>file:</em> prefix, but for clarity we recommend that you use it. </p>
<p>This creates the following NetCDF Dataset, in CDL notation:</p>
<pre>netcdf testRead.ncml {<br>
 dimensions:<br>  time = UNLIMITED;   // (2 currently)   // (has coord.var)<br>  lat = 3;   // (has coord.var)<br>  lon = 4;   // (has coord.var)<br>
 variables:<br>  int rh(time, lat, lon);<br>   :long_name = &quot;relative humidity&quot;;<br>   :units = &quot;percent&quot;;<br>  double T(time, lat, lon);<br>   :long_name = &quot;surface temperature&quot;;<br>   :units = &quot;C&quot;;<br>  float lat(lat);<br>   :units = &quot;degrees_north&quot;;<br>  float lon(lon);<br>   :units = &quot;degrees_east&quot;;<br>  int time(time);<br>   :units = &quot;hours&quot;;<p> // Global Attributes:<br>  :title = &quot;Example Data&quot;;</p><p> data:<br>  lat = 41.0, 40.0, 39.0;<br>  lon = -109.0, -107.0, -105.0, -103.0;<br>  time = 6, 18;
}</pre> 
Note that the name of the netCDF dataset is  the name of the NcML file, not the referenced dataset.
<p>Allowable forms of the  referenced dataset location  are: </p>
<ul>
  <li>an absolute HTTP URL (eg <strong>http://server/myfile.nc</strong>)</li>
  <li>An absolute file URL with an absolute path (eg <strong>file:/usr/local/data/mine.nc</strong>). You can sometimes omit the <strong>file:</strong> prefix, but not always, so we recommend using the <strong>file:</strong> prefix. </li>
  <li>An absolute file URL with a relative path (eg <strong>file:data/mine.nc</strong>). The file will be opened reletive to the working directory. </li>
  <li> A relative URL resolved against the NcML location (eg <strong>subdir/mydata.nc</strong>). You must <strong>not</strong> use a <em>file:</em> prefix in this case. </li>
</ul>
<h2><b>2. Use the metadata in the existing file</b>
</h2>
<p>In this example, all of the metadata is read in from the underlying file. </p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;
  location=&quot;file:/dev/NCdataset/example.nc&quot;&gt;

  &lt;readMetadata/&gt;
&lt;/netcdf&gt;
</pre>
<p>Here, the <i>&lt;readMetadata/&gt;</i> element causes all of the metadata from 
the netCDF file to be read in. In this case, the NcML dataset and the referenced dataset are identical. </p>
<p>Since <i>&lt;readMetadata/&gt;</i> is the default, you can leave it out: </p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;
  location=&quot;file:/dev/NCdataset/example.nc&quot; /&gt;
</pre>
<p>You must declare the ncml namespace in the top netcdf element. You can use a namespace prefix like <strong>nc </strong>or not:</p>
<ol>
  <li><strong>No prefix: </strong><i>xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot; </i></li>
  <li><strong>Use &quot;nc&quot; prefix<em>: </em></strong><i> xmlns:nc=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;</i><br>
</li>
</ol>
<h2><b>3. Read in metadata from existing NetCDF file and modify:</b> </h2>
<p>In this example, we read in all of the metadata from the underlying file, and modify it 
  through elements in the NcML.</p>
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot; 
      location=&quot;file:C:/dev/netcdf-java-2.2/test/data/example1.nc&quot;&gt;
<br><strong>(1)</strong>&lt;attribute name=&quot;title&quot; type=&quot;String&quot; value=&quot;Example Data using CF&quot; /&gt;
<strong>(2)</strong>&lt;attribute name=&quot;Conventions&quot; value=&quot;CF-1.0&quot; /&gt;
<br><strong>(3)</strong>&lt;variable name=&quot;ReletiveHumidity&quot; orgName=&quot;rh&quot;&gt;<br>(<strong>4)</strong>  &lt;attribute name=&quot;standard_name&quot; type=&quot;String&quot; value=&quot;relative humidity&quot; /&gt;<br>   &lt;/variable&gt;
<br>   &lt;variable name=&quot;T&quot;&gt;<br><strong>(5) </strong> &lt;attribute name=&quot;standard_name&quot; type=&quot;String&quot; value=&quot;temperature&quot; /&gt;<br><strong>(6) </strong> &lt;attribute name=&quot;units&quot; type=&quot;String&quot; value=&quot;degreesC&quot; /&gt;<br>   &lt;/variable&gt;

<strong>(7)</strong>&lt;variable name=&quot;deltaLat&quot; type=&quot;double&quot; shape=&quot;lat&quot;&gt;
     &lt;values&gt;.1 .1 .01&lt;/values&gt;
   &lt;/variable&gt;
<br>&lt;/netcdf&gt;
</pre>
<p>The absence of the <strong>&lt;explicit/&gt;</strong> element means that all the metadata in the referenced dataset is read in. Then:</p>
<ol>
  <li>The global attribute named &quot;title&quot; is given a new value.</li>
  <li> 
  A global attribute named &quot;Conventions&quot; is added.</li>
  <li>The variable &quot;rh&quot; is renamed to &quot;ReletiveHumidity&quot;</li>
  <li>A variable attribute  &quot;standard_name&quot; is added</li>
  <li>A variable attribute &quot;standard_name&quot; is added</li>
  <li>The variable attribute &quot;units&quot; is given a new value.</li>
  <li>A new variable is &quot;deltaLat&quot; added. Since it doesnt exist in the referenced dataset, you must also define its data values.</li>
</ol>
<p>This creates the following NetCDF Dataset. </p>
<pre>netcdf replace.xml {
  dimensions:
    time = UNLIMITED;   // (2 currently)   // (has coord.var)
    lat = 3;   // (has coord.var)
    lon = 4;   // (has coord.var)

  variables:
    double deltaLat(lat);
    int ReletiveHumidity(time, lat, lon);
      :long_name = &quot;relative humidity&quot;;
      :standard_name = &quot;relative humidity&quot;;
      :units = &quot;percent&quot;;
    double T(time, lat, lon);
      :long_name = &quot;surface temperature&quot;;
      :standard_name = &quot;temperature&quot;; 
      :units = &quot;degreesC&quot;;
    float lat(lat);
      :units = &quot;degrees_north&quot;;
    float lon(lon);
      :units = &quot;degrees_east&quot;;
    int time(time);
      :units = &quot;hours&quot;;
	  
  // Global Attributes:
  :Conventions = &quot;CF-1.0&quot;;
  :title = &quot;Example Data using CF&quot;;

  data:
    deltaLat = 0.1, 0.1, 0.01;
}

</pre>
<h2><br>
  Using  ToolsUI to generate NcML</h2>
<p>You can use  the ToolsUI NcML Tab to generate NcML from a CDM file (enter a dataset URL or browse for a local file). You can save the NcML to disk <img src="TUIncmlSaveButton.jpg" width="30" height="27">. </p>
<p><img src="TUIncml.jpg" width="1082" height="559"></p>
<h3>Writing out  files modified with NcML</h3>
<p>You can also generate a NetCDF-3 file from the NcML <img src="TUIncmlSaveAsNetcdf.jpg" width="30" height="27">, and the equivalent binary NetCDF file will be created corresponding to the NcML dataset, and all the original data will be copied to it. Since the binary data is taken from the original file, this is efficient for even large files. </p>
<p>This works as long as you are using only netCDF-3 compatible features. In practice this means no Structures or Groups. Strings are ok, and are converted to type char. The equivilent Java code to do this is:</p>
<pre>    NetcdfDataset ncd = NcMLReader.readNcML (ncml_filename, null);<br>    NetcdfFile ncdnew = <strong>ucar.nc2.FileWriter.writeToFile</strong>(ncd, fileout_name, true);
    ncd.close();
    ncdnew.close();</pre>
<p>&nbsp;</p>
<p>Next: <a href="Aggregation.html">Aggregation</a> </p>
<hr WIDTH="100%">
<address>
<img src="../nc.gif" width="64" height="64"> This document is maintained by <a href="mailto:caron@unidata.ucar.edu">John Caron</a> and was last updated on Jun 03, 2008 
</address>
<p>&nbsp;</p>
</body>
</html>
