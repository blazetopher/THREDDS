<html>
<head>
<title>Aggregating netCDF files with netCDF Datasets</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<h1> NcML Aggregation</h1>
<h2>Introduction</h2>
<p>Multiple NetCDF files 
  can be aggregated into a single, logical NetCDF dataset. This is done with the <em><strong>aggregation</strong></em> NcML element. There are several types of aggregation:</p>
<ol>
  <li><strong>Union</strong>: The union of all the dimensions, attributes, and variables in multiple NetCDF files.</li>
  <li><strong>JoinExisting</strong>: Variables of the same name (in different files) are connected  along their existing, outer dimension, called the <em>aggregation dimension</em>. A coordinate variable must exist for the dimension.</li>
  <li><strong>JoinNew</strong>: Variables of the same name (in different files) are connected  along a new outer dimension. Each file becomes one . A new coordinate variable is created for the dimension. </li>
</ol>
<p>See also: <a href="AnnotatedSchema.html">Annotated NcML Schema</a> </p>
<h2>Union of NetCDF files</h2>
<p>The following NcML constructs a dataset by creating the union of two netCDF files (note there is no <em>location</em> attribute in the outer netcdf element).</p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;
  &lt;<strong>aggregation</strong> type=&quot;<strong>union</strong>&quot;&gt;
    &lt;<strong>netcdf</strong> location=&quot;file:C:/test/path/rh.nc&quot; /&gt;     
    &lt;<strong>netcdf</strong> location=&quot;file:C:/test/path/temp.nc&quot; /&gt;
  &lt;/aggregation&gt; 
&lt;/netcdf&gt;</pre>
<p>Supposing that the nested files look like: </p>
<pre>
netcdf rh.nc {
 dimensions:
  time = 12;   
  lat = 64;   
  lon = 128; 
 variables:  
  float rh(time, lat, lon);  
 }


netcdf temp.nc {
 dimensions:
  time = 12;   
  lat = 64;   
  lon = 128; 

 variables:  
  float rh(time, lat, lon);  
 }
</pre>
<p>Then the aggregation dataset looks like:</p>
<pre>
netcdf TestUnion.ncml {
 dimensions:
  time = 12;   
  lat = 64;   
  lon = 128; 

 variables:  
  float rh(time, lat, lon);  
  float Temperature(time, lat, lon);
 }</pre>
 
<p>The <b>rh</b> variable will be read from <em>C:/test/path/rh.nc</em>, while 
  the <b>Temperature</b> variable will be read from <i>C:/test/path/temp.nc. </i></p>
<p><i>A <strong>Union</strong> dataset is constructed by transferring objects (dimensions, attributes, groups, and variables) from the nested datasets in the order the nested datasets are listed. If an object with the same name already exists, it is skipped. </i><strong><em>You need to pay close attention to  dimensions and coordinate variables, which must match exactly across nested files. </em></strong></p>
<p><strong>Example file </strong>: <a href="examples/aggUnionSimple.ncml.txt">aggUnionSimple.ncml</a></p>
<h2> <a name="joinExisting"></a>Aggregation on an existing dimension</h2>
<p>The following NcML constructs a dataset by declaring &quot;time&quot; an <strong><em>aggregation 
  dimension</em></strong>. Any variable that has that dimension as its outer dimension is an <strong><i>aggregation variable</i></strong>. 
  The dimension must be the outer (slowest varying) dimension. There must be an existing coordinate variable named time. </p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;<br>  &lt;<strong>aggregation</strong> dimName=&quot;time&quot; type=&quot;<strong>joinExisting</strong>&quot;&gt;
    &lt;<strong>netcdf</strong> location=&quot;file:/test/temperature/jan.nc&quot; /&gt;
    &lt;<strong>netcdf</strong> location=&quot;file:/test/temperature/feb.nc&quot; /&gt;
  &lt;/aggregation&gt;<br>&lt;/netcdf&gt;</pre>
<p> The variable <b>T</b> is an aggregation variable with the first data values taken from the file <i>jan.nc</i> and the next data values are taken from <i>feb.nc</i>. The dataset CDL will look like this to the client:</p>
<pre>netcdf aggExisting.ncml {<br> dimensions:<br>  lat = 64;<br>  lon = 128;<br>  time = 59;
 variables:
  float T(time, lat, lon);
}</pre>
<p>When the library opens the above NcML dataset, it has to read through all nested datasets, in order to find out the length of the time dimension. For large aggregations, this can be slow. In the example below, we have added the optional <em>ncoords</em> attribute on the nested datasets. In this case, only one dataset has to be opened immediatley, and the others as needed for a data read request.</p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;<br>  &lt;aggregation dimName=&quot;time&quot; type=&quot;joinExisting&quot;&gt;
    &lt;netcdf location=&quot;file:/test/temperature/jan.nc&quot; <strong>ncoords=&quot;31&quot;</strong>/&gt;
    &lt;netcdf location=&quot;file:/test/temperature/feb.nc&quot; <strong>ncoords=&quot;28&quot;</strong>/&gt;
  &lt;/aggregation&gt;<br>&lt;/netcdf&gt;
</pre>
<p><i>A <strong>JoinExisting</strong> dataset is constructed by transferring objects (dimensions, attributes, groups, and variables) from the nested datasets in the order the nested datasets are listed. All variables that use the aggregation dimension are logically concatenated, in the order of the nested datasets. Variables that don't use the aggregation dimension are treated as in a Union dataset, i.e. skipped if one of that name already exists.</i></p>
<p><strong>Example file </strong>: <a href="examples/aggExisting.ncml.txt">aggExisting.ncml</a></p>
<h3>Defining coordinates on a JoinExisting aggregation </h3>
<p>Typically the coordinates for a <em><strong>JoinExisting</strong></em> aggregation are taken from the existing coordinate variables, as in the above example. If it is missing, you must define it in the NcML: </p>
<pre> &lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;</pre>
<pre><strong>(1)</strong>&lt;variable name=&quot;time&quot; shape=&quot;time&quot; type=&quot;int&quot;&gt;
     &lt;attribute name=&quot;units&quot; value=&quot;days since 2000-01-01&quot;/&gt;
     &lt;attribute name=&quot;_CoordinateAxisType&quot; value=&quot;Time&quot; /&gt;
<strong>(2)</strong>  &lt;values start=&quot;0&quot; increment=&quot;1&quot; /&gt;
   &lt;/variable&gt;
<br>  &lt;aggregation dimName=&quot;time&quot; type=&quot;joinExisting&quot;&gt;
    &lt;netcdf location=&quot;file:/test/temperature/jan.nc&quot; ncoords=&quot;31&quot;/&gt;
    &lt;netcdf location=&quot;file:/test/temperature/feb.nc&quot; ncoords=&quot;28&quot;/&gt;
  &lt;/aggregation&gt;<br> &lt;/netcdf&gt;</pre>
<ol>
  <li>A coordinate variable is defined for the aggregation dimension. If it doesn't exist in the nested datasets, you must define its shape and type. </li>
  <li>The values are specified as regularly spaced. </li>
</ol>
<p>These are the ways that coordinate values are assigned to a <strong>JoinExisting</strong><a name="JoinExistingTypes"></a> coordinate: </p>
<ol>
  <li>You may explicitly define the coordinate variable in the NcML, and assign coordinate values to it, as in this example. These will override anything in the nested datasets. If you explicitly list the values, you must know the exact number of them. If you use the start and increment values, as in this example, you don't have to know the exact number, but the values must be evenly spaced. </li>
  <li>You may specify the coordinate values through the <em>coordValue</em> attributes on the individual <em>netcdf</em> elements, with the correct number of space-delimited coordinate values, eg:
    <pre>&lt;aggregation dimName=&quot;time&quot; type=&quot;joinExisting&quot;&gt;
  &lt;netcdf location=&quot;file:/test/temperature/janAvgWeek.nc&quot; <em>coordValue</em>=&quot;1038 7823 12983 43400&quot;/&gt;
  &lt;netcdf location=&quot;file:/test/temperature/febAvgWeek.nc&quot; <em>coordValue</em>=&quot;66234 89237 108736 123494&quot;/&gt;
&lt;/aggregation&gt;</pre>
  </li>
  <li>You may explicitly define the coordinate variable, but not specify its values, so that you can  define attributes for it. The coordinate values will be read from the the nested <strong>netcdf</strong> dataset coordinate variables</li>
  <li>If you do not specify a coordinate variable, one must exist in each of the nested datasets, and the coordinate values will be read from it, just like any other aggregation variable. </li>
</ol>
<h2><a name="joinNew"></a>Aggregation on a new dimension</h2>
<p>The previous example &quot;joined&quot; variables along their existing outer dimension. Another common case is to aggregate variables by creating a new outer dimension. Each existing variable becomes one &quot;slice&quot; of the compound variable (a <i>slice</i> holds the index of one dimension constant, e.g. <b>humidity(3, *, *, *)</b>). The following NcML joins variables from three separate files into a single variable, by creating a new dimension of length 3:</p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;</pre>
<pre><strong>(1)</strong>&lt;aggregation dimName=&quot;time&quot; type=&quot;joinNew&quot;&gt;
<strong>(2)</strong>  &lt;variableAgg name=&quot;T&quot;/&gt;
     &lt;variableAgg name=&quot;RH&quot;/&gt;
<strong>(3)</strong>  &lt;netcdf location=&quot;file:/test/data/ncml/nc/time0.nc&quot; coordValue=&quot;0&quot;/&gt;
     &lt;netcdf location=&quot;file:/test/data/ncml/nc/time1.nc&quot; coordValue=&quot;1&quot;/&gt;
     &lt;netcdf location=&quot;file:/test/data/ncml/nc/time2.nc&quot; coordValue=&quot;2&quot;/&gt;
   &lt;/aggregation&gt;</pre>
<pre>&lt;/netcdf&gt;</pre>
<ol>
  <li>The aggregation is defined as type <em><strong>joinNew</strong></em> on the time dimension. </li>
  <li>The variables named <em><strong>T</strong></em> and <em><strong>RH</strong></em> will be made into aggregation variables; you can list as many variables as needed.</li>
  <li>The list of files to use, in order. Each one has a coordinate value assigned to it, whose type must be compatible with the coordinate variable type, if you have created one. </li>
</ol>
<p>This will create the following dataset:</p>
<pre>netcdf aggSynthetic.xml {<br> dimensions:<br>   time = 3;   // (has coord.var)<br>   lat = 3;   // (has coord.var)<br>   lon = 4;   // (has coord.var)<br> variables:<br>   double time(time);<br>   float lat(lat);<br>     :units = &quot;degrees_north&quot;;<br>   float lon(lon);<br>     :units = &quot;degrees_east&quot;;<br>   double T(time, lat, lon);<br>     :long_name = &quot;surface temperature&quot;;<br>     :units = &quot;degC&quot;;</pre>
<pre> :title = &quot;Example Data - Type 1 aggregation&quot;;
}
</pre>
<p><i>A <strong>JoinNew</strong> dataset is constructed by transferring objects (dimensions, attributes, groups, and variables) from the nested datasets in the order the nested datasets are listed. All variables that are listed as aggregation variables are logically concatenated along a new dimension, in the order of the nested datasets. A coordinate Variable is created for the new dimension. Non-aggregation variables are treated as in a Union dataset, i.e. skipped if one of that name already exists.</i> </p>
<p><strong>Example file </strong>: <a href="examples/aggSynthetic.ncml.txt">aggSynthetic.ncml</a></p>
<h3>Defining coordinates on a JoinNew aggregation </h3>
<p>A <em><strong>JoinNew</strong></em> aggregation has to create a new coordinate variable. In the above example, one was automatically created with type double, to match the coordValues specified on the netcdf elements. However, it has no units or other attributes. To specify attibutes on the coordinate system, you can use the following:</p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;</pre>
<pre><strong>(1)</strong>&lt;variable name=&quot;time&quot;&gt;
     &lt;attribute name=&quot;units&quot; value=&quot;months since 2000-6-16 6:00&quot;/&gt;
     &lt;attribute name=&quot;_CoordinateAxisType&quot; value=&quot;Time&quot; /&gt;
     &lt;values&gt;0 1 2&lt;/values&gt;
   &lt;/variable&gt;</pre>
<pre><strong>(2)</strong>&lt;aggregation dimName=&quot;time&quot; type=&quot;joinNew&quot;&gt;
<strong>  </strong>  &lt;variableAgg name=&quot;T&quot;/&gt;
<strong>  </strong>  &lt;netcdf location=&quot;file:/test/data/ncml/nc/time0.nc&quot; /&gt;
    &lt;netcdf location=&quot;file:/test/data/ncml/nc/time1.nc&quot; /&gt;
    &lt;netcdf location=&quot;file:/test/data/ncml/nc/time2.nc&quot; /&gt;
   &lt;/aggregation&gt;

&lt;/netcdf</pre>
<p>Its not obvious from the NcML, but the aggregation element <strong>(2)</strong> is processed first, so that all of the objects of the aggregated datasets are available to be modified by  other NcML elements, for example by <strong>(1)</strong>.  </p>
<p>There are 4 ways that  coordinate values are assigned to a JoinNew coordinate: </p>
<ol>
  <li>You may explicitly specify the coordinate variable, and  assign coordinate values to it, as in this example.</li>
  <li>You may explicitly specify the coordinate variable, and specify the coordinate values  through the <em>coordValue</em> attributes on the individual <em>netcdf</em> elements.</li>
  <li>If you do not specify a coordinate variable, but you add <em>coordValue</em> attributes to the individual <em>netcdf</em> elements, then a coordinate variable of type double or String will be added. </li>
  <li>If you do not specify a coordinate variable, and you do not add <em>coordValue</em> attributes, then a coordinate variable of type String will be added whose values are the names of the files. </li>
</ol>
<p>Note that you must explicitly specify the coordinate variable in order to assign attributes to it, which is something you are likely to need to do, for example defining a units attribute is usually necessary. Assigning the <strong>_CoordinateAxisType</strong> type is a recommended way to make sure that the <a href="http://www.unidata.ucar.edu/software/netcdf-java/CoordinateAttributes3.html#CoordinateAttributes">nj22 Coordinate layer</a> correctly identifies the coordinate type.</p>
<p>Also note that, contrary to previous versions of NcML aggregation, you do <strong>not</strong> need to define a dimension element for the aggregation dimension (e.g. &lt;dimension name=&quot;time&quot;&gt; and <strong>must not</strong> use the old form     <em><strong>&lt;dimension name=&quot;time&quot; length=&quot;0&quot; /&gt;</strong></em> as it will override the dimension created by the aggregation. </p>
<p><i>For all aggregations, the aggregation element is processed first, so that the objects (dimensions, attributes, groups, and variables) from the nested datasets exist and can be modified by other NcML elements.</i> </p>
<h2>Aggregation by scanning  a directory</h2>
<p>Its often convenient to indicate that all the files in some directory should be aggregated. This can be done for <strong>joinExisting</strong> and <strong>joinNew</strong> (not <strong>union</strong>) types. The following  example scans all of the files in the directory <strong>/data/model </strong> (and its subdirectories) which end in <strong>&quot;.nc&quot;.</strong> By default, the files are ordered by sorting on the filename. </p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;
  &lt;aggregation dimName=&quot;time&quot; type=&quot;<strong>joinExisting</strong>&quot;&gt;
<strong>    &lt;scan location=&quot;/data/model/&quot; suffix=&quot;.nc&quot; /&gt;</strong>
  &lt;/aggregation&gt;
&lt;/netcdf&gt;</pre>
<p>When opening a <strong>joinExisting</strong> aggregation using a <strong>scan </strong>element, each matching file must be opened in order to determine its size. This can be slow if there are a large number of files. In the case where you specifiy the files individually, you could add the <strong>ncoords</strong> attribute for speed. In the THREDDS Data Server, the information is cached, so that subsequent requests do not need to open each file until data is requested. However, see the section on <a href="#caching">caching</a>.</p>
<p>A <strong>joinNew</strong> type aggregation does not incur this expense, since there is always exactly one step per file: </p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;
  &lt;aggregation dimName=&quot;time&quot; type=&quot;<strong>joinNew</strong>&quot;&gt;
    &lt;variableAgg name=&quot;T&quot;/&gt;
<strong>    &lt;scan location=&quot;/data/goes/&quot; suffix=&quot;.gini&quot; /&gt;</strong>
  &lt;/aggregation&gt;
&lt;/netcdf&gt;</pre>
<p>  However, here the problem is how do you assign coordinate values to each step? If you do nothing, a String-valued coordinate variable will be defined, whose values are the filenames. If you know the number of files, you can specifiy the coordinate variable yourself and  assign it values: </p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;</pre>
<pre><strong>  </strong>&lt;dimension name=&quot;time&quot; length=&quot;48&quot;/&gt;
  &lt;variable name=&quot;time&quot; type=&quot;int&quot; shape=&quot;time&quot;&gt;
    &lt;attribute name=&quot;units&quot; value=&quot;hours since 2000-01-01 00:00&quot;/&gt;
    &lt;attribute name=&quot;_CoordinateAxisType&quot; value=&quot;Time&quot; /&gt;
<strong>	  &lt;values start=&quot;0&quot; increment=&quot;1&quot; npts=&quot;48&quot; /&gt;</strong>
  &lt;/variable&gt;</pre>
<pre><strong>  </strong>&lt;aggregation dimName=&quot;time&quot; type=&quot;joinNew&quot;&gt;
    &lt;variableAgg name=&quot;T&quot;/&gt;
    &lt;scan location=&quot;/data/goes/&quot; suffix=&quot;.gini&quot; /&gt;<strong>
</strong>  &lt;/aggregation&gt;</pre>
<pre>&lt;/netcdf&gt;</pre>
<p>You can also explicitly list the values:</p>
<pre><strong>  &lt;values&gt;12.0 25.2 37.9 77.12&lt;/values&gt;</strong> </pre>
<h3>Extracting date coordinates from the filename (joinNew) </h3>
<p>For the common case that you want to assign a date/time coordinate by parsing the filename, you can use the <strong>dateFormatMark</strong> attribute:</p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;
  &lt;aggregation dimName=&quot;time&quot; type=&quot;joinNew&quot;&gt;
    &lt;variableAgg name=&quot;T&quot;/&gt;
<strong>    </strong>&lt;scan location=&quot;/data/goes/&quot; suffix=&quot;.gini&quot; <strong>dateFormatMark=&quot;SUPER-NATIONAL_1km_SFC-T_#yyyyMMdd_HHmm&quot;</strong> /&gt;
  &lt;/aggregation&gt;
&lt;/netcdf&gt; 
</pre>
<p>The <em><strong>dateFormatMark</strong></em><a name="dateFormatMark"></a> attribute is used on <strong>joinNew</strong> types to create date coordinate values out of the filename. It consists of a section of text, a '#' marking character, then a <a href="AnnotatedSchema.html#SimpleDataFormat"><strong>java.text.SimpleDataFormat</strong></a> string. The number of characters before the # is skipped in the filename, then the next part of the filename must match the SimpleDataFormat string, then it ignores any trailing text. For example: </p>
<pre>      Filename: SUPER-NATIONAL_1km_SFC-T_20051206_2300.gini 
DateFormatMark: SUPER-NATIONAL_1km_SFC-T_#yyyyMMdd_HHmm</pre>
<p>The net effect is to add a coordinate variable, whose values are ISO 8601 formatted date/time Strings, with a <strong>_CoordinateAxisType</strong> of &quot;Time&quot;, for example: </p>
<pre>   &lt;variable name=&quot;time&quot; type=&quot;String&quot; shape=&quot;time&quot;&gt;
	   &lt;attribute name=&quot;_CoordinateAxisType&quot; value=&quot;Time&quot; /&gt;
     <strong>&lt;values&gt;2005-11-28T21:00:00Z 2005-11-28T21:15:00Z 2005-11-28T21:30:00Z&lt;/values&gt;</strong>
   &lt;/variable&gt;</pre>
<p><em>The <strong>scan</strong> element allows you to specify that all of the files in a directory (and its subdirectories, with an optional suffix filter) are included in the aggregation. The files are sorted alphabetically on the filename, unless you specify a <strong>dateFormatMark</strong> attribute, in which case they are sorted by the Date derived from the filename, which is also used for the coordinate values. </em><br>
</p>
<h2>Aggregation on dynamic<a name="dynamic"></a> sets of files</h2>
<p>When you use a scan element to define a collection of files, the case where the set of files may change as new files are added or deleted requires special attention. </p>
<ol>
  <li>Each time you open the NcML dataset, a &quot;snapshot&quot; of the directory is made, and the dataset will not change for the lifetime of the NetcdfDataset object, that is, until you close it. If component files are deleted, and you try to access their data, you will get a <em>java.io.FileNotFoundException</em>. Files that are added will not be seen.</li>
</ol>
<p>There are situations where you need to indicate  how often the directories should be rescanned.</p>
<ol>
  <li>If you have enabled caching (using <strong>NetcdfFileCache</strong> and <strong>NetcdfDatasetCache</strong>), and you are getting the dataset through NetcdfDataset.acquire(), then when the NcML file is acquired, the directories will be re-scanned if <strong>recheckEvery</strong> time has passed since it was last scanned. </li>
  <li>The TDS Server uses caching, so when defining aggregations, you should always include a <strong>recheckEvery</strong> time for any dataset that can change. </li>
</ol>
<p>You indicate how often the directories should be rescanned using the <strong>recheckEvery</strong> attribute:</p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;
  &lt;aggregation dimName=&quot;time&quot; type=&quot;joinNew&quot; <strong>recheckEvery=&quot;15 min&quot;</strong> &gt;
    &lt;variableAgg name=&quot;T&quot;/&gt;
<strong>    </strong>&lt;scan location=&quot;/data/goes/&quot; suffix=&quot;.gini&quot; /&gt;
  &lt;/aggregation&gt;
&lt;/netcdf&gt; 
</pre>
<p>The value of  <strong>recheckEvery</strong> must be a <a href="http://www.unidata.ucar.edu/software/udunits/">udunit</a> time unit, e.g. uses units of <em>sec, min, hour, day</em>, etc. If you do not specify a recheckEvery attribute, the collection will be assumed to be non-changing. </p>
<p><em>When using the <strong>scan</strong> element on directories whose contents may change, you must use  a <strong>recheckEvery</strong> attribute. It effectively specifies the maximum time before changes will be detected by a newly opened NcML dataset. An existing NcML dataset will not notice the changes, and you can get FileNotFoundException if the component files are deleted.</em></p>
<h2>Aggregation Caching<a name="caching"></a></h2>
<p>For large collection of files, one wants to avoid opening every single file each time the dataset is accessed. Instead we only want to open the files that are actually needed to fulfill a data request. Generally this is straightforward, except for discovering the number and values of the aggregation coordinate variable for type <strong>joinExisting. </strong>This is because we have to know the size of the aggregation dimension when we open the dataset, even before we read any data. For practical purposes, we  often need to know the coordinate values immediately also. </p>
<p>To help solve this problem, you should enable Aggregation Caching in your application, by telling the ucar.nc2.ncml.Aggregation class where it can cache information, by calling the static method (see javadoc for more details): </p>
<pre><strong>    // Enable Aggregation caching. Every hour, delete stuff older than 30 days<br>    Aggregation.setPersistenceCache( new DiskCache2(&quot;/.nj22/cachePersist&quot;, true, 60 * 24 * 30, 60));</strong></pre>
<p>When this is enabled, <strong>joinExisting</strong> aggregations will save  information to special XML files in the specified directory, in order to avoid opening every file to obtain its coordinate values, each time the dataset is opened. Instead, the first time it is opened, the values are read, then subsequent opens will use the cached values. </p>
<p>If using a <strong>scan</strong> element on changing directories, be sure to specify the <strong>recheckEvery</strong> attribute to make sure that the cached information gets updated.</p>
<p>&nbsp; </p>
<h2>Nested Aggregation<a name="nested"></a></h2>
<p>One can nest netcdf elements </p>
<pre>&lt;netcdf xmlns=&quot;http://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;</pre>
<pre> &lt;aggregation dimName=&quot;time&quot; type=&quot;joinExisting&quot;&gt;</pre>
<pre>  &lt;netcdf&gt;
   &lt;aggregation type=&quot;union&quot;&gt;
    &lt;netcdf location=&quot;file:C:/test/path/temperature_20080101.nc&quot; /&gt; 
    &lt;netcdf location=&quot;file:C:/test/path/salinity_20080101.nc&quot; /&gt;
   &lt;/aggregation&gt;
  &lt;/netcdf&gt;</pre>
<pre>  &lt;netcdf&gt;
   &lt;aggregation type=&quot;union&quot;&gt;
    &lt;netcdf location=&quot;file:C:/test/path/temperature_20080102.nc&quot; /&gt; 
    &lt;netcdf location=&quot;file:C:/test/path/salinity_20080102.nc&quot; /&gt;
   &lt;/aggregation&gt;
  &lt;/netcdf&gt; </pre>
<pre> &lt;/aggregation&gt; </pre>
<pre>&lt;/netcdf&gt;</pre>
<p></p>
<p>Next: <a href="FmrcAggregation.html">FMRC Aggregation</a> </p>
<hr WIDTH="100%">
<address>
<img src="../nc.gif" width="64" height="64"> This document is maintained by <a href="mailto:caron@unidata.ucar.edu">John Caron</a> and was last updated on April 14, 2008
</address>
<p>&nbsp;</p>
</body>
</html>
