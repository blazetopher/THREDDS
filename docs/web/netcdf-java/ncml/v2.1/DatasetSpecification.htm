<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>NcML Dataset Specification</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body>
<h1>NcML Dataset XML Specification</h1>
<p><i>John Caron</i></p>
<p><i>last changed: Sep 22, 2003</i></p>
<hr>
<h3>1. Overview</h3>
<p>NcML Dataset uses the same object model as the <a href="ObjectModel.htm">core 
  schema object model.</a> The NcML elements allow you to define new objects, 
  as well as change, aggregate, and subset objects in other netCDF datasets. NcML 
  Dataset XML is essentially a declarative language for defining netCDF datasets. 
  Certain elements, like <em>readMetadata</em> and <em>aggregation</em>, dynamically 
  add objects at runtime.</p>
<p>To summarize, the core <em><strong>netCDF objects</strong></em> are:</p>
<ul>
  <li><strong><em>Dimension</em></strong>: a named array index.</li>
  <li><strong><em>Attribute</em></strong>: a name/value pair.</li>
  <li><strong><em>Variable</em></strong>: a multidimensional array of primitive 
    data values, indexed by 0 or more Dimensions.</li>
  <li><strong><em>NetCDF dataset</em></strong>: a set of netCDF objects available 
    through the netCDF API. This may be accessible for example via HTTP, OpenDAP, 
    as a file on disk in any valid netCDF file format, or as described through 
    an NcML Dataset document. </li>
</ul>
<p>The NcML Dataset XML <em><strong>elements </strong></em>are </p>
<ul>
  <li><strong><em>netcdf</em></strong> : a container for <em>netcdf, dimension</em>, 
    <em>attribute</em>, and <em>variable</em> elements.</li>
  <li><strong><em>dimension</em></strong>: corresponds to a Dimension object</li>
  <li><strong><em>attribute</em></strong>: corresponds to an Attribute object</li>
  <li><strong><em>variable</em></strong>: corresponds to a Variable object</li>
  <li><strong><em>values</em></strong>: defines data values</li>
  <li><strong><em>readMetadata</em></strong>: an instruction for importing objects 
    from another netCDF dataset at runtime.</li>
  <li><strong><em>aggregation</em></strong>: an instruction for creating an aggregation 
    dimension and variables from nested netcdf elements</li>
</ul>
<h3>2. Connection to other netCDF datasets</h3>
<p>An NcML Dataset might be completely self contained, but it is more often the 
  case that it refers to one or more other netCDF datasets, either to get data 
  from, or to import its objects from. The NcML Dataset itself is called the <em><strong>target</strong></em> 
  dataset, while the datasets that are referred to are called the <em><strong>source</strong></em> 
  datasets.</p>
<blockquote> 
  <p>1. A <em><strong>readMetadata</strong></em> element imports <strong><em>dimension</em></strong>, 
    <strong> <em>attribute</em></strong>, and <strong><em>variable</em></strong> 
    objects from a source dataset named by the <em><strong>uri</strong></em> attribute 
    of the enclosing <em> <strong>netcdf</strong></em> element. The imported objects 
    are added only if there does not already exist an object of the same name 
    and type in the target dataset.</p>
  <p>2. <strong><em>attribute</em></strong> and <em><strong>dimension</strong></em> 
    elements are either self-contained in the NcML document, or are imported from 
    a source dataset.</p>
  <p>3. A <strong><em>variable</em></strong> may be self contained, may refer 
    to a Variable object in another netCDF dataset, or may be synthetic.</p>
  <blockquote> 
    <p>3.1 A variable is <em><strong>self contained</strong></em> when its data 
      are specified in a values element. The number of values in the values element 
      must be equal to the size of the variable, as determined by its shape, with 
      the rightmost dimensions varying the fastest.</p>
    <p>3.2 A variable may get its data from a Variable in a source netCDF dataset, 
      called the <em><strong>source variable</strong></em>. The source dataset 
      is specified by the <em><strong>uri</strong></em> attribute of the target 
      variable's enclosing netcdf element. The variables' names must match, or 
      the <em><strong>nameInFile</strong></em> attribute must be used to specify 
      the source variable's name. The shape of the target variable must match 
      the shape of the source variable, although the dimension names do not have 
      to match.</p>
    <p>3.3 A variable is <em><strong>synthetic</strong></em> if it is an aggregation 
      of other variables (see below).</p>
  </blockquote>
</blockquote>
<h3>3. Nested netcdf containers</h3>
<p><em><strong>Netcdf</strong></em> elements can be nested inside of each other, 
  to any depth. <em><strong>Nested</strong></em> or <em><strong>inner netcdf </strong></em>objects 
  express internal implementation details that are not visible to the user. The 
  <em><strong>outer netcdf</strong></em> element contains the publically accessible 
  objects.</p>
<blockquote> 
  <p> 1. The contents of a <em><strong>netcdf</strong></em> element are the union 
    of its own elements and the contents of its child <em><strong>netcdf</strong></em> 
    elements. </p>
  <p>2. When an element with the same name and type (dimension, attribute, or 
    variable) appears in multiple child netcdf elements, the first one to appear 
    is used in the parent. </p>
</blockquote>
<h3>4. Aggregation elements</h3>
<p>An aggregation element defines <em><strong>aggregation dimensions</strong></em> 
  and <em><strong>aggregation variables</strong></em>, using nested netcdf elements.</p>
<blockquote> 
  <p>1. A <em><strong>JoinExisting</strong></em> aggregation makes an existing 
    dimension into an aggregation dimension, and creates synthetic variables by 
    &quot;joining&quot; nested variables that use that dimension.</p>
  <pre>
    &lt;aggregation dimName=&quot;time&quot; type=&quot;joinExisting&quot;/&gt;</pre>
  <p> This is equivalent to declaring a dimension of that name whose length is 
    calculated, plus creating a synthetic variable for each nested variable that 
    uses that dimension:</p>
  <pre>    &lt;dimension name=&quot;time&quot; length=&quot;calculated&quot; /&gt;
    &lt;variable name=&quot;v1&quot; shape=&quot;time dim1 ...&quot; /&gt;
    &lt;variable name=&quot;v2&quot; shape=&quot;time dim2 ...&quot; /&gt;
    &lt;variable name=&quot;v3&quot; shape=&quot;time dim2 ...&quot; /&gt;
    ....
</pre>
  <p> If you have already declared a variable in the target netcdf, your declaration 
    will be used (eg for attributes), otherwise the first declaration in a nested 
    dataset will be used. If you declare a variable in the target netcdf with 
    a values element, then the values will be taken from your declaration. However 
    the dimension length will still be calculated from the lengths of the dimensions 
    in the nested datasets.</p>
  <p>2. A <em><strong>JoinNew</strong></em> aggregation creates a new dimension 
    into an aggregation dimension, and creates synthetic variables by &quot;joining&quot; 
    nested variables that use that dimension.</p>
  <pre>  &lt;aggregation dimName=&quot;time&quot; type=&quot;joinNew&quot;&gt;
    &lt;variableAgg name=&quot;T&quot;/&gt;
    &lt;variableAgg name=&quot;P&quot;/&gt;
  &lt;/aggregation&gt;
</pre>
  <p> is equivalent to declaring a dimension of that name whose length is calculated, 
    plus creating a synthetic variable for each variable explicitly declared in 
    a <em><strong>variableAgg</strong></em> element.</p>
  <pre>    &lt;dimension name=&quot;time&quot; length=&quot;*&quot; /&gt;
    &lt;variable name=&quot;T&quot; shape=&quot;time dim1 ...&quot; /&gt;
    &lt;variable name=&quot;P&quot; shape=&quot;time dim2 ...&quot; /&gt;
</pre>
</blockquote>
<h3>5. Order of processing</h3>
<blockquote> 
  <p>1. Explicit <strong><em>dimension</em></strong>, <strong> <em>attribute</em></strong>, 
    and <strong><em>variable</em></strong> elements are processed and added to 
    the container.</p>
  <p>2. The <em><strong>readMetadata</strong></em> elements are processed to import 
    <strong><em>dimension</em></strong>, <strong> <em>attribute</em></strong>, 
    and <strong><em>variable</em></strong> elements from a source dataset, if 
    an element of the same name and type doesnt already exist in the target dataset. 
  </p>
  <p>3. Nested <em><strong>netcdf</strong></em> elements are processed. The <strong><em>dimension</em></strong>, 
    <strong> <em>attribute</em></strong>, and <strong><em>variable</em></strong> 
    elements from the <em><strong>child</strong></em> <em><strong>netcdf</strong></em> 
    elements are copied into the parent if an element of the same name and type 
    doesnt already exist in the parent.</p>
</blockquote>
</body>
</html>
