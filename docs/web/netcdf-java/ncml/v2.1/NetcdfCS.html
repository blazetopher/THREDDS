<html>
<head>
<title>Netcdf dataset</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<h1>NetCDF Coordinate Systems</h1>
<p>last changed: Feb 03, 2003</p>
<hr>
<p>This is a proposed extension to the core netCDF Markup language (NcML), see<a href="http://www.unidata.ucar.edu/schemas/netcdf.xsd"> 
  <i>netcdf.xsd</i></a> schema.</p>
<p>The latest NcML Coordinate System <a href="http://www.unidata.ucar.edu/schemas/netcdf-cs.xsd">schema</a>.</p>
<h3><b>Summary</b></h3>
<ol>
  <li> netcdf is redefined to allow coordinateSystem, referenceSystem, horizReference 
    and vertReference elements. variable is redefined to allow the coordinateSystems 
    attribute, which lists the coordinate systems for this variable.</li>
  <li> coordinateAxis extends Variable, adding an optional &quot;axisType&quot; 
    attribute which is X, Y, Z, or Time. (this was called coordinateVariable, 
    but it makes the documentation too confusing to explain how it differs from 
    the traditional &quot;coordinate variable&quot;.</li>
  <li> coordinateSystem is a list of coordinateAxis elements, and an optional 
    referenceSystem.</li>
  <li> a referenceSystem is a minimalist implementation of Stefano's work. it 
    contains (optional) horizontal reference system and vertical reference system 
    elements, both of which are very minimal. I would expect that we would add 
    stafano's full-blown work in a seperate namespace that uses a substitution 
    group on the referenceSystem element.</li>
</ol>
<p></p>
<h3>ucar.nc2.dataset prototype</h3>
<p>I have implemented a prototype that reads netCDF files and using netCDF Conventions, 
  constructs coordinate systems. So far i have encoded only COARDS and NUWG. This 
  is part of a proposed ucar.nc2.dataset package that will part of a new netcdf-java 
  release someday. I have some documentation written, see chapter 3 of the following 
  doc:</p>
<blockquote>
  <p><a href="ftp://ftp.unidata.ucar.edu/pub/caron/manual.doc">ftp://ftp.unidata.ucar.edu/pub/caron/manual.doc</a><br>
    <a href="ftp://ftp.unidata.ucar.edu/pub/caron/manual.pdf">ftp://ftp.unidata.ucar.edu/pub/caron/manual.pdf</a></p>
</blockquote>
<p>javadoc:</p>
<blockquote>
  <p><a href="http://www.unidata.ucar.edu/packages/netcdf-java/v2.1/javadoc/index.html">http://www.unidata.ucar.edu/packages/netcdf-java/v2.1/javadoc/index.html</a></p>
</blockquote>
<p>source:</p>
<blockquote>
  <p><a href="ftp://ftp.unidata.ucar.edu/pub/caron/nc2.1_src.jar">ftp://ftp.unidata.ucar.edu/pub/caron/nc2.1_src.jar</a></p>
</blockquote>
<p>library:</p>
<blockquote>
  <p><a href="ftp://ftp.unidata.ucar.edu/pub/caron/nc2.1.jar">ftp://ftp.unidata.ucar.edu/pub/caron/nc2.1.jar</a></p>
</blockquote>
<h3><br>
  Example NUWG</h3>
<p>Here is <a href="examples/nuwg.xml">sample 
  XML</a> generated by ucar.nc2.datset for an ETA model dataset coming through 
  gribtonc using the NUWG Conventions.</p>
<p>It is fairly complicated:</p>
<ul>
  <li> 16 dimensions</li>
  <li>17 coordinate axes</li>
  <li>55 variables (not coordinate axes)</li>
  <li>10 coordinate systems</li>
  <li>3 reference systems</li>
</ul>
<p>There is one horiz projection, two types of vertical coordinates (altitude 
  and pressure), and 8 vertical coordinates, 5 of which have upper/lower bounds.</p>
<p>I did not get the coordinate bounds encoded. In the example dataset, the upper 
  and lower bounds are specified in separate variables, not in a variable like 
  &quot;float bounds( dim, 2)&quot; as in the CF convention. Ithink it would be 
  useful to revisit the bounds specification, and try to get something that works 
  for our existing datasets.</p>
<p>&nbsp;</p>
<h3>Example CF-1.0</h3>
<p>Here is <a href="examples/cf.xml">sample 
  XML</a> generated by ucar.nc2.datset for a CCSM model run using CF-1 conventions</p>
<p>It has:.</p>
<ul>
  <li> 7 dimensions</li>
  <li>11 coordinate axes</li>
  <li>127 variables (not coordinate axes)</li>
  <li>7 coordinate systems</li>
  <li>2 reference systems</li>
</ul>
<p>The hybrid sigma-pressure vertical coordinate system used by this dataset is 
  an interesting and complicated example of a coordinate axis. The 3D variables 
  look like eg:</p>
<pre> float DTCOND(time, lev, lat, lon) ;
   DTCOND:units = &quot;K/s&quot; ;
   DTCOND:long_name = &quot;T tendency - convective adjustment&quot; ;
   DTCOND:cell_method = &quot;time: mean&quot; ;</pre>
<p>where lat/lon/time are simple coordinate variables, but lev is:</p>
<pre> double lev(lev) ;
   lev:long_name = &quot;hybrid level at midpoints (1000*(A+B))&quot; ;
   lev:units = &quot;level&quot; ;
   lev:positive = &quot;down&quot; ;
   lev:standard_name = &quot;atmosphere_hybrid_sigma_pressure_coordinate&quot;    ;
   lev:formula_terms = &quot;a: hyam b: hybm p0: P0 ps: PS&quot; ;</pre>
<p>lev is a dimensionless parameter. The formula given indicates how to calculate 
  the pressure from these variables in the file:</p>
<pre>
   double P0 ;
   P0:long_name = &quot;reference pressure&quot; ;
   P0:units = &quot;Pa&quot; ;
   double hyam(lev) ;
   hyam:long_name = &quot;hybrid A coefficient at layer midpoints&quot; ;
   double hybm(lev) ;
   hybm:long_name = &quot;hybrid B coefficient at layer midpoints&quot; ;
   float PS(time, lat, lon) ;
   PS:units = &quot;Pa&quot; ;
   PS:long_name = &quot;surface pressure&quot; ;
   PS:cell_method = &quot;time: mean&quot; ;</pre>
<p>So I interpret this as having two vertical coordinate axes, one is dimensionless 
  and is not georeferencing per se, the other is a multidimensional, calculated 
  variable:</p>
<pre> pressure_lev(time,lev,lat,lon) = hyam(lev)*P0 + hybm(lev) * PS(time,lat,lon)</pre>
<p>And so there are two coordinate systems in the attached NcML, one has a vertical 
  reference system, the other not. Comments on this interpretation are welcome.</p>
<p>While the NcML was generated though the ucar.nc2.dataset package, there is 
  not yet support for calculated variables. However, its nice to have a concrete 
  example of a real calculation that we want to support. Once we get that done, 
  these kinds of model coordinate systems should me easier to access through a 
  standard netcdf API.</p>
<p>There are still many details of CF-1 not yet parsed. I would esp. like to try 
  real datasets that use auxiliary coordinates, or any other unusual files, to 
  see if they fit ok with our encoding.<br>
</p>
<p><br>
</p>
</body>
</html>
