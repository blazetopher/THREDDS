<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>FAQ</title>
</head>

<body>
<h1>Netcdf-Java FAQ</h1>
<hr />
<h3>Caching</h3>
<p><strong>Q: How do I use NetcdfFile object caching</strong>?</p>
<blockquote>
  <p>Initialize the object cache by calling <strong>NetcdfDataset.initNetcdfFileCache()</strong>, then open files through <strong>NetcdfDataset.acquireFile() </strong>and<strong> NetcdfDataset.acquireDataset()</strong>. Note that you always close a file in the normal way, ie through <strong>NetcdfFile.close()</strong>. See the javadoc for those methods for more details. </p>
  <p>The main reason to use object caching is in a high performance server application.</p>
</blockquote>
<p><strong>Q: How do I control where temporary files are placed (Disk Caching)</strong>?</p>
<blockquote>
  <p>See <a href="Caching.html">Disk Caching</a>.</p>
</blockquote>
</blockquote> 
<h3>I/O Service Provider<a name="IOSP" id="IOSP"></a></h3>
<p><strong>Q: I have lots of data in a proprietary format. How do I  read it into the CDM?</strong></p>
<blockquote>
  <p>You write a class that implements the IO Service Provider interface. See section 4 of the <a href="http://www.unidata.ucar.edu/software/netcdf-java/tutorial/index.html">tutorial</a>.</p>
</blockquote>
<p><strong>Q: I want to create a NetcdfFile  from some other source than a file. But an IOSP is designed to get data from a RandomAccessFile. So what do I do?</strong></p>
<blockquote>
  <p>An IOSP just has to satisfy the contract of IOServiceProvider. It doesnt matter how it gets satisfied. You can create an IOSP any way you want - its an interface. If you don't need the RandomAccessFile, you can ignore it. Use memory-resident data, a random-number generator, or any other way to satisfy a data request.</p>
  <p>You can create a NetcdfFile with the protected constructor, and pass in your IOSP:</p>
  <pre>  <strong>protected NetcdfFile(IOServiceProvider spi, RandomAccessFile raf, String location, CancelTask cancelTask)</strong>;</pre>
  <pre> // need access to protected constructor
 class <strong>MyNetcdfFile</strong> extends NetcdfFile {
   MyNetcdfFile (IOServiceProvider spi, String name) {
     <strong>super(spi, null, name, null)</strong>;
   }
 }</pre>
  <p>Once you have a NetcdfFile, you can wrap it with a NetcdfDataset,  a GridDataset, a PointFeatureDataset, etc, and use all the mechanism of subsetting already in those classes. Ultimately those call your IOSP for data, and you must return the data correctly, according to the interface contract.<br />
  </p>
</blockquote>
<p>&nbsp; </p>
<h3>Logging</h3>
<p><strong>Q: How do I get rid of the message &quot;log4j:WARN No appenders could be found for logger (ucar.nc2.NetcdfFile).  log4j:WARN Please initialize the log4j system properly&quot; ?</strong></p>
<blockquote>
  <p>Add the following to your startup code:</p>
  <pre wrap="">
    org.apache.log4j.BasicConfigurator.configure();
    org.apache.log4j.Logger logger = org.apache.log4j.Logger.getRootLogger();
    logger.setLevel(org.apache.log4j.Level.OFF)</pre>
</blockquote>
<h3>Multithreading</h3>
<p><strong>Q: Is the Netcdf-Java library thread-safe?</strong></p>
<blockquote>
  <p> Underneath a <strong>Variable/NetcdfFile</strong> is (usually) a <strong>java.io.RandomAccessFile</strong> object, which is not thread-safe, because  it keeps the state of the file position. So even if all you want to do is read data in multiple threads, you need to synchronize, typically on the <strong>NetcdFile</strong> object. Alternatively, open a new <strong>NetcdfFile</strong> for each thread. The THREDDS Data Server (TDS) uses a cache of open <strong>NetcdfFile</strong> files by using the <strong>NetcdfDataset.acquireFile() </strong>method, which allows stateless handling of data requests minimizing file opening and closing.</p>
</blockquote>
<p><strong>Q: Do I need to synchronize if I use NetcdfDataset.acquireFile()?</strong></p>
<blockquote>
  <p wrap="">The way that the cache is designed to work is that you get back a NetcdfFile object, which should then be used only in a single thread so that you dont need synchronization (&quot;thread-confinement&quot;), eg to answer a single request in a server. Until you release that NetcdfFile object, no one else can get it from the cache. If another request is made for that same NetcdfFile while its locked, a new NetcdfFile is opened.     And of course, the cache itself is thread-safe. So if you use it properly, you never have to do synchronization yourself.</p>
</blockquote>
<h3>NcML</h3>
<p><strong>Q<a name="ncml" id="ncml"></a>: The NcML in my TDS is not working. What should I do?</strong></p>
<blockquote>
  <p>Generally its much easier to debug NcML outside of the TDS. Here are some guidelines on how to do that.</p>
  <ol>
      <li>Go to the TDS configuration catalog and extract the NcML:
        <ol>
          <li>Find the problem dataset. Inside the &lt;dataset&gt; element will be a &lt;netcdf&gt; element, that is the NcML aggregation. Cut and paste into a file, say its called <strong>test.ncml</strong> (it must have suffix <strong>ncml</strong> or <strong>xml</strong>).</li>
          <li>Add the XML header to the top of it: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</li>
          <li>Remove the <strong>recheckEvery</strong> attribute if present on the &lt;scan&gt; element.</li>
          <li>Make sure the datasets are available. If its an aggregation, a simple thing to do is to copy two or more of the files and put them in the same directory as test.ncml. Use a scan element or explicitly list them in a &lt;netcdf&gt; element, with the location attribute being the reletive path name.</li>
        </ol>
    </li>
      <li>Open test.ncml in the viewer tab of ToolsUI, to check for NcML errors. You  now see directly what the modified dataset looks like. Modify test.ncml and ropen it until you get it right.</li>
      <li>If its a grid dataset,open it in FeatureTypes/Grid tab to make sure you see grids, to check for complete coordinate system. If you dont see the grids you expect, the CoordSys tab might be helpful. It takes some expertise to understand <a href="../CDM/index.html">how Coordinate systems work</a>. When all else fails, follow the <a href="http://cf-pcmdi.llnl.gov/documents/cf-conventions/">CF specification</a>.</li>
      <li>Now put your changes back into TDS catalog and restart the server </li>
      <li>Open your TDS catalog in ToolsUI/Thredds. Navigate to the dataset, and &quot;open as file&quot; or &quot;open as dataset&quot; (at bottom). You should see the same results as in steps 2 or 3, except with all of the files.</li>
  </ol>
</blockquote>
<h3>Writing</h3>
<p><strong>Q: Ok, so you read a lot of files, what about writing?</strong></p>
<blockquote>
  <p>Netcdf-Java library has very limited  support for writing files.. The only supported <em>output</em> format is the netCDF-3 &quot;classic&quot; file format. See the <strong>ucar.nc2.NetcdfFileWriteable</strong> javadoc.</p>
  <p><strong>ucar.nc2.FileWriter </strong>writes CDM files to netCDF-3 format. However, currently it does not try very hard to capture new features in this limited format. <strong>ucar.nc2.dataset.NetcdfDataset</strong>.<strong>main</strong>() is a cover for <strong>FileWriter</strong>, but you can also open NcML, OPeNDAP, and other datasets accessible with NetcdfDataset.openFile().</p>
</blockquote>
<p><strong>Q: What about writing Netcdf-4 format?</strong></p>
<blockquote>
  <p>NetCDF-4 format is built on top of the <a href="http://www.hdfgroup.org/HDF5/">HDF5 file format</a>. It adds shared dimensions, so it is unfortunately not a strict subset of HDF5. HDF5 is a very complicated format, and at this time we do not have resources to write a 100% Java version for writing (we do have a 100% Java version for reading). We are considering a <a href="http://en.wikipedia.org/wiki/Java_Native_Interface">JNI</a> interface to the NetCDF-4 C library, but there is no current timeline for that. </p>
</blockquote>
<p><strong>Q: <a name="writeGuide" id="writeGuide"></a>What kind of information should I put into my netCDF file to help others read it? </strong></p>
<blockquote>
  <p>Thank you for asking, See: </p>
  <ul>
    <li> General Guildelines:<a href="http://www.unidata.ucar.edu/software/netcdf/docs/BestPractices.html"> http://www.unidata.ucar.edu/software/netcdf/docs/BestPractices.html</a></li>
    <li>Recommended Conventions: <a href="http://cf-pcmdi.llnl.gov/">CF Conventions  </a></li>
    <li>Proposed <a href="http://cf-pcmdi.llnl.gov/trac/wiki/PointObservationConventions">Conventions for Point Observations </a></li>
  </ul>
</blockquote>
<hr />
<address>
<img src="../nc.gif" alt="" width="64" height="64" /> This document is maintained by <a href="mailto:caron@unidata.ucar.edu">John Caron</a> and was last updated on Feb 13, 2009
</address>
</body>
</html>
