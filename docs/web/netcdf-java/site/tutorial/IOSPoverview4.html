<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>IOSP Overview 4</title>
<style type="text/css">
<!--
.style3 {color: #CC0000}
-->
</style>
</head>

<body>
<h1><img src="../netcdfBig.gif" width="100" height="55">Writing an IOSP for Netdf-Java version 4</h1>
<p>Version 4.0 of Netcdf-Java has two new methods (in red), and one method has been removed. It also uses <strong>Section</strong> objects instead of <strong>List&lt;Range&gt;</strong>. </p>
<pre>public interface <strong>ucar.nc2.IOServiceProvider</strong> {</pre>
<pre>  // Check if this is a valid file for this IOServiceProvider.
  public boolean <strong>isValidFile</strong>( ucar.unidata.io.RandomAccessFile raf) throws IOException;</pre>
<pre>  // Open existing file, and populate ncfile with it.
  public void <strong>open</strong>(ucar.unidata.io.RandomAccessFile raf, NetcdfFile ncfile, CancelTask cancelTask) throws IOException;</pre>
<pre>  // Read data from a top level Variable and return a memory resident Array.
  public ucar.ma2.Array <strong>readData</strong>(ucar.nc2.Variable v2, <span class="style3">Section section</span>) throws java.io.IOException, ucar.ma2.InvalidRangeException;

<span class="style3">  // Read data from a top level Variable and send data to a WritableByteChannel.
  public long <strong>readData</strong>(ucar.nc2.Variable v2, Section section, WritableByteChannel channel)<br>         throws java.io.IOException, ucar.ma2.InvalidRangeException;</span></pre>
<pre>  // Read data from a Variable that is nested in one or more Structures.
  // If there are no Structures in the file, this will never be called.
  public ucar.ma2.Array <strong>readNestedData</strong>(ucar.nc2.Variable v2, <span class="style3">Section section</span>) throws IOException, ucar.ma2.InvalidRangeException;</pre>
<pre>  // Close the file.
  public void <strong>close</strong>() throws IOException;</pre>
<pre>  // Extend the file if needed in a way that is compatible with the current metadata.
  public boolean <strong>syncExtend</strong>() throws IOException;</pre>
<pre>  // Check if file has changed, and reread metadata if needed.
  public boolean <strong>sync</strong>() throws IOException;</pre>
<pre>  // A way to communicate arbitrary information to an iosp.
<span class="style3">  public Object sendIospMessage( Object message);</span>
<s>  public void <strong>setSpecial</strong>( Object special);</s></pre>
<pre>  // print Debug info for this object.
  public String <strong>toStringDebug</strong>(Object o);</pre>
<pre>  // Show debug / underlying implementation details
  public String <strong>getDetailInfo</strong>();</pre>
<pre>}
</pre>
<p>A <strong>Section</strong> is a container for a <strong>List</strong> of <strong>Range</strong> objects:</p>
<pre> public class <strong>ucar.ma2.Section</strong> {
   public List&lt;Range&gt; <strong>getRanges</strong>();
   public int[] <strong>getOrigin</strong>();<br>   public int[] <strong>getShape</strong>();<br>   public int[] <strong>getStride</strong>();
   ...
 }
</pre>
<p>Its best to extend <strong>ucar.nc2.iosp.AbstractIOServiceProvider. </strong>In the simplest case, you only have to implement 4 methods.</p>
<pre>public class Example <strong>extends</strong> <strong>AbstractIOServiceProvider</strong> {
<br>  public boolean <strong>isValidFile</strong>(RandomAccessFile raf) throws IOException {}</pre>
<pre>  public void <strong>open</strong>(RandomAccessFile raf, NetcdfFile ncfile, CancelTask cancelTask) throws IOException {}</pre>
<pre>  public Array <strong>readData</strong>(Variable v2, Section wantSection) throws IOException, InvalidRangeException {}</pre>
<pre>  public void <strong>close</strong>() throws IOException {}
}</pre>
<hr WIDTH="100%">
<address>
<img src="../nc.gif" width="64" height="64"> This document is maintained by John Caron and was last updated on Aug 3, 2007
</address>
<p>&nbsp;</p>
</body>
</html>
