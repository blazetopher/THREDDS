<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>NetcdfFileWriteable</title>
</head>

<body>
<h1><span style=""><span style=""><span style=""><span style=""><span style=""><a> Tutorial: Working with NetcdfFileWriteable</a></span></span></span></span></span><span style=""><span style=""><span style=""><o:p></o:p></span></span></span></h1>
<p><span style=""><span style=""><span style=""><b><i>NetcdfFileWriteable</i></b> allows you to create new netCDF-3 files and to write data to new or existing <span style=""><span style=""><span style="">netCDF-3 files</span></span></span>.</span></span></span></p>
<h3 class="MsoNormal">Creating a new <span style=""><span style=""><span style=""><span style=""><span style=""><a></a><span style=""><span style=""><span style="">netCDF-3 file</span></span></span></span></span></span></span></span> </h3>
<pre class="MsoNormal">   String filename = &quot;testWrite.nc&quot;;<br><strong>1)</strong> NetcdfFileWriteable ncfile = <strong>NetcdfFileWriteable</strong>.<strong>createNew</strong>(filename, false);</pre>
<pre>   // add dimensions
<strong>2)</strong> Dimension latDim = ncfile.<strong>addDimension</strong>(&quot;lat&quot;, 64);
   Dimension lonDim = ncfile.<strong>addDimension</strong>(&quot;lon&quot;, 128);</pre>
<pre>   // define Variable
   ArrayList dims = new ArrayList();
   dims.add( latDim);
   dims.add( lonDim);
<strong>3)</strong> ncfile.<strong>addVariable</strong>(&quot;temperature&quot;, DataType.DOUBLE, dims);
<strong>4)</strong> ncfile.<strong>addVariableAttribute</strong>(&quot;temperature&quot;, &quot;units&quot;, &quot;K&quot;);</pre>
<pre>   // add a 1D attribute of length 3
<strong>5)</strong> Array data = Array.factory( int.class, new int [] {3}, new int[] {1,2,3});<br><strong>6)</strong> ncfile.<strong>addVariableAttribute</strong>(&quot;temperature&quot;, &quot;scale&quot;, data);
</pre>
<pre>   // add a string-valued variable: char svar(80)
   Dimension svar_len = ncfile.<strong>addDimension</strong>(&quot;svar_len&quot;, 80);
   dims = new ArrayList();
   dims.add( svar_len);
<strong>7)</strong> ncfile.<strong>addVariable</strong>(&quot;svar&quot;, DataType.CHAR, dims);
</pre>
<pre>   // string array: char names(3, 80)
   Dimension names = ncfile.<strong>addDimension</strong>(&quot;names&quot;, 3);
   ArrayList dima = new ArrayList();
   dima.add(names);
   dima.add(svar_len);
<strong>8)</strong> ncfile.<strong>addVariable</strong>(&quot;names&quot;, DataType.CHAR, dima);
</pre>
<pre>   // how about a scalar variable?
<strong>9)</strong> ncfile.<strong>addVariable</strong>(&quot;scalar&quot;, DataType.DOUBLE, new ArrayList());</pre>
<pre>   // add global attributes
<strong>10)</strong>ncfile.<strong>addGlobalAttribute</strong>(&quot;yo&quot;, &quot;face&quot;);
   ncfile.<strong>addGlobalAttribute</strong>(&quot;versionD&quot;, new Double(1.2));
   ncfile.<strong>addGlobalAttribute</strong>(&quot;versionF&quot;, new Float(1.2));
   ncfile.<strong>addGlobalAttribute</strong>(&quot;versionI&quot;, new Integer(1));
   ncfile.<strong>addGlobalAttribute</strong>(&quot;versionS&quot;, new Short((short)2));
   ncfile.<strong>addGlobalAttribute</strong>(&quot;versionB&quot;, new Byte((byte)3));</pre>
<pre>   // create the file
   try {
<strong>11)</strong>  ncfile.<strong>create</strong>();
   } catch (IOException e) {
<strong>10)</strong>  System.err.println(&quot;ERROR creating file &quot;+ncfile.<strong>getLocation</strong>()+&quot;\n&quot;+e);
   }
</pre>
<ol>
  <li>Create new netcdf-3 file with the given filename, with no <em>fill</em>. Fill = true causes everything to be written twice: first with the fill value, then with the data values. If you know you will write all the data, you dont need to use fill. If you don't know if all the data will be written, turning fill on ensures that any values not written will have the fill value. Otherwise those values will be undefined: possible zero, or possibly garbage. </li>
  <li>Create two <strong>Dimensions</strong>, named <em>lat</em> and <em>lon</em>, of lengths 64 and 128 respectively, and add them to the file. </li>
  <li>Create a list consisting of the two Dimension, and create a <strong>Variable</strong> named <em>temperature</em>, of type <strong>double</strong>, with shape (lat, lon)  .</li>
  <li>Add an <strong>Attribute</strong> to the <em>temperature</em> Variable, with name <em>units</em> and value <em>K</em>.  </li>
  <li>Create a 1D <strong>Array</strong> of length 3, whose values are {1,2,3}. Attributes can be scalars or 1D arrays of any type and length. </li>
  <li>Add an attribute  to the <em>temperature</em> Variable, with name scale and value (1,2,3).</li>
  <li>Create a   Variable named <em>svar</em> of type <em>character</em> with length 80. </li>
  <li>Create a 2D Variable named <em>names</em> of type <em>character</em> with shape (3,80).</li>
  <li> Create a   scalar Variable named <em>scalar</em> of type <em>double</em>. Note that the empty ArrayList means that it is a scalar, ie has no Dimensions.</li>
  <li>Create various global Attributes of different types. </li>
  <li>Create the file. At this point the (empty) file will be written to disk, and the metadata (Dimensions, Variables and Atributes) is fixed and cannot be changed or added.</li>
  <li>The <strong>ncfile.getLocation()</strong> method will return the filename. <br>
  </li>
</ol>
<h3 class="MsoNormal">Writing data to a new or existing file</h3>
<p class="MsoNormal">You can now start writing data to the new file. Or you can open an existing file for example: </p>
<pre class="MsoNormal">  NetcdfFileWriteable ncfile = <strong>NetcdfFileWriteable.openExisting</strong>(location, fill);</pre>
<p class="MsoNormal">In both cases the data writing is the same, for example: </p>
<pre class="MsoNormal">   // create some data<br><strong>1)</strong> ArrayDouble A = new ArrayDouble.D2(latDim.getLength(), lonDim.getLength());<br>   int i,j;<br>   Index ima = A.getIndex();<br>   for (i=0; i&lt;latDim.getLength(); i++) {<br>     for (j=0; j&lt;lonDim.getLength(); j++) {<br>       A.setDouble(ima.set(i,j), (double) (i*1000000+j*1000));<br>     }<br>   }</pre>
<pre><strong>2)</strong> int[] origin = new int[2];
   try {
<strong>3)</strong>   ncfile.<strong>write</strong>(&quot;temperature&quot;, origin, A);
   } catch (IOException e) {
     System.err.println(&quot;ERROR writing file&quot;);
   } catch (InvalidRangeException e) {
     e.printStackTrace();
   }
 </pre>
<pre>   // write char variable as String
   try {
<strong>4)</strong>   ArrayChar ac2 = new <strong>ArrayChar.D1</strong>(svar_len.getLength());
     ac2.<strong>setString</strong>( &quot;Two pairs of ladies stockings!&quot;);
<strong>5)</strong>   ncfile.<strong>write</strong>(&quot;svar2&quot;, ac2);
   } catch (IOException e) {
     System.err.println(&quot;ERROR writing Achar2&quot;);
   } catch (InvalidRangeException e) {
     e.printStackTrace();
   }
 </pre>
<pre> // write String array
   try {
<strong>6)</strong>   ArrayChar ac2 = new <strong>ArrayChar.D2</strong>(names.getLength(), svar_len.getLength());
     ac2.<strong>setString</strong>( 0, &quot;0 pairs of ladies stockings!&quot;);
     ac2.<strong>setString</strong>( 1, &quot;1 pair of ladies stockings!&quot;);
     ac2.<strong>setString</strong>( 2, &quot;2 pairs of ladies stockings!&quot;);
     ncfile.<strong>write</strong>(&quot;names2&quot;, ac2);
   } catch (IOException e) {
     System.err.println(&quot;ERROR writing Achar4&quot;);
   } catch (InvalidRangeException e) {
     e.printStackTrace();
   }</pre>
<pre>   // write scalar data
   try {
<strong>7)</strong>   <strong>ArrayDouble.D0</strong> datas = new <strong>ArrayDouble.D0</strong>();
     datas.<strong>set</strong>(222.333);
     ncfile.<strong>write</strong>(&quot;scalar&quot;, datas);
   } catch (IOException e) {
     System.err.println(&quot;ERROR writing scalar&quot;);
   } catch (InvalidRangeException e) {
     e.printStackTrace();
   }</pre>
<pre>   try {
<strong>8)</strong>   ncfile.close();
   } catch (IOException e) {
     e.printStackTrace();
   }
</pre>
<ol>
  <li>Much of the work of writing is constructing the data Arrays. Here we create a 2D Array of shape (lat, lon) and fill it with some values.</li>
  <li>A newly created Java integer array is guarenteed to be initialized to zeros.</li>
  <li>We write the data to the <em>temperature</em> Variable, with <strong>origin</strong> all zeros. The <strong>shape</strong> is taken from the data Array.</li>
  <li> The <strong>ArrayChar</strong> class has special methods to make it convenient to work with Strings. Note that we use the <em>type and rank specific constructor</em> <strong>ArrayChar.D1</strong>. The <strong>setString</strong>(String val) method is for rank one ArrayChar objects. </li>
  <li>Write the data. Since we dont pass in an origin parameter, it is assumed to be all zeroes. </li>
  <li> The <strong>setString</strong>(int index, String val) method is for rank two ArrayChar objects. </li>
  <li>Working with  <em>type and rank specific </em>Array objects provides convenient <strong>set</strong>() methods. Here, we have a rank-0 (scalar) double Array, whose set() methods sets the scalar value.</li>
  <li> You must close the file when you are done, else you risk not writing the data to disk. <span class="MsoNormal"><strong>NetcdfFileWriteable</strong></span>.flush() will flush to disk without closing. <br>
  </li>
</ol>
<pre class="MsoNormal">&nbsp;
</pre>
<pre class="MsoNormal">&nbsp; </pre>
<pre class="MsoNormal"><span style=""><span style=""><span style=""><span class="CODE"><span style="font-size: 8pt;"><o:p></o:p></span></span></span></span></span></pre>
</body>
</html>
