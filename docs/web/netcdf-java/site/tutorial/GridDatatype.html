<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>The Grid Scientific Datatype</title>
</head>

<body>
<h1>Tutorial: The Grid Scientific Datatype</h1>
<h3>Scientific Datatypes</h3>
<p>The Common Data Model<em><strong> Scientific Datatype layer</strong></em> adds another layer of functionality on top of NetcdfDataset, by specializing in various kinds of data that are common in Earth Science. The abstract concepts and concrete classes are continually evolving, and we have concentrated on, for obvious reasons, the types of datasets and data that Unidata is  most familiar with, mainly from the Atmospheric and Ocean sciences.</p>
<p> All Scientific Datatypes have <strong>georeferencing coordinate systems</strong>, from which a location in real physical space and time can be found, usually with reference to the Earth. Each adds special <em>data subsetting</em> methods which cannot be done efficiently or at all in the general case of NetcdfDataset objects. </p>
<h3>The Grid Datatype</h3>
<p>A <em><strong>Grid Coordinate System</strong></em> at the minimum has a <strong>Lat</strong> and <strong>Lon</strong> coordinate axis, or a <strong>GeoX</strong> and <strong>GeoY</strong> coordinate axis plus a <strong>Projection</strong> that maps x, y to lat, lon. It usually has a <strong>time</strong> coordinate axis. It may optionally have a <strong>vertical</strong> coordinate axis, classified as <strong>Height</strong>, <strong>Pressure</strong>, or <strong>GeoZ. </strong>If it is a GeoZ axis, it may have a <strong>Vertical Transform</strong> that maps GeoZ to height or pressure. A special kind of Grid called Forecast Model Run Collection (FMRC) may optionally have a <strong>Runtime</strong> and/or <strong>Ensemble</strong> coordinate axis. </p>
<p>A <em><strong>Grid Datatype</strong></em> (aka <em><strong>Grid</strong></em> or <em><strong>GeoGrid</strong></em>) is <span class="MsoNormal"><span style=""><span style=""><span style="">a  special kind of <em>Variable</em> that has a Grid Coordinate System, and whose dimensions are all <em><strong>connected</strong></em>, meaning that n</span></span></span></span>eighbors in index space are connected neighbors in coordinate space. This means that data values that are close to each other in the real world (coordinate space) are close to each other in the data array, and are usually stored close to each other on disk, making coordinate subsetting easy and efficient. </p>
<p>A <em><strong>Grid Dataset</strong></em> is a <em>NetcdfDataset</em> whose <em>Grids</em> have been identified and grouped into <em><strong>Gridsets</strong></em> based on common Grid Coordinate Systems. Here is the UML for the <em>Grid</em> interface classes, found in the <strong>ucar.nc2.dt</strong> package: </p>
<p>&nbsp;</p>
<h3><img src="../images/Grid.png" width="693" height="284"></h3>
<h3>&nbsp;</h3>
<h3>Opening a GridDataset</h3>
<p class="MsoNormal"><span style=""><span style=""><span style="">The correct way to open a <span style=""><span style=""><span style=""><strong>GridDataset</strong></span></span></span></span> is to use the <strong>TypedDatasetFactory</strong></span> class. This allows third parties to plug-in alternative imlpementations of <span style=""><span style=""><span style=""><span style=""><span style=""><span style=""><strong>GridDataset</strong></span></span></span></span></span></span></span> at runtime. For example: </p>
<pre class="MsoNormal"><strong>  </strong>StringBuffer errlog = new StringBuffer();<br>  <strong>ucar.nc2.dt.GridDataset</strong> gds = (<strong>ucar.nc2.dt.GridDataset</strong>) <strong>
		ucar.nc2.dt.TypedDatasetFactory.open( </strong>thredds.catalog.DataType.<strong>GRID, </strong>location, cancelTask, errlog<strong>);
  </strong>if (null == gds) 
    throw Exception(&quot;Cant open GRID at location= &quot;+location+&quot;; error message= &quot;+errlog);</pre>
<p class="MsoNormal">Note that <strong><strong>ucar.nc2.dt.GridDataset</strong></strong> is a subclass of <strong><strong><strong>ucar.nc2.dt.TypedDataset</strong></strong></strong>, and is new as of version 2.2.17. This superceeds the old <strong> <strong><strong>ucar.nc2.dataset.grid.GridDataset</strong></strong>. </strong>If you need a drop-in replacement for that older class, you can use <span style=""><span style=""><span style=""><o:p></o:p></span></span></span></p>
<pre class="MsoNormal"><span style=""><span class="CODE"><span style="">&nbsp; </span>GridDataset gds = <strong>ucar.nc2.dataset.grid.GridDataset.open</strong>(uriString);<o:p></o:p></span></span><span style=""><span style=""><span style=""><o:p></o:p></span></span></span><span style=""><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;;"><o:p></o:p></span></span></span></span></pre>
<p class="MsoNormal"><span style=""><span style=""><span style="">But this will not see any classes loaded at runtime. It will see CoordSysBuilder and CoordTransBuilder plug-ins, however. </span></span></span></p>
<h3 class="MsoNormal"><span style=""><span style=""><span style="">Using a GridDataset</span></span></span></h3>
<p class="MsoNormal"><span style=""><span style=""><span style="">A <b>GridCoordSys</b> wraps a georeferencing coordinate system. It always has 1D or 2D <i>XHoriz</i> and <i>YHoriz</i> axes, and optionally 1D vertical and time axes. The XHoriz/YHoriz axes will be lat/lon if <i>isLatLon()</i> is true, otherwise they will be GeoX,GeoY with an appropriate Projection. The <i>getBoundingBox()</i> method returns a bounding box from the XHoriz/YHoriz corner points. The <i>getLatLonBoundingBox() </i>method returns the smallest lat/lon bounding box that contains <i>getBoundingBox()</i>.</span></span></span><span style=""><span style=""><span style=""><o:p></o:p></span></span></span></p>
<p class="MsoNormal"><span style=""><span style=""><span style="">If there is a vertical axis, <i>isZPositive() </i>is true if increasing values of the vertical axis should be displayed<span style="">&nbsp; </span>&ldquo;up&rdquo;. The <i>getLevels()</i> and <i>getTimes()</i> returns the list of levels and times, if they exist, as lists of <i>NamedObjects</i> that are convenient for display. If there is a time axis, and it can be converted (via ucar.units) into a Date, <i>isDate()</i> is true, and <i>getTimeDates()</i> returns the time coordinates as Date objects. The <i>findTimeCoordElement</i>() method does a reverse lookup, finding the time index that corresponds to a given Date.</span></span></span><span style=""><span style=""><span style=""><span style="font-size: 9pt; font-family: &quot;Courier New&quot;;"><o:p></o:p></span></span></span></span><span style=""><span style=""><span style=""><span class="CODE"><span style="font-size: 8pt;"><o:p></o:p></span></span></span></span></span><span style=""><span style=""><span style=""><o:p></o:p></span></span></span></p>
<p class="MsoNormal"><span style=""><span style=""><span style="">A <b><i>GeoGrid</i></b> wraps a <i>VariableDS </i>in a<i> VariableStandarized</i>, and also has a <i>GridCoordSys</i>. You can think of it as a specialized Variable that explicitly handles X,Y,Z,T dimensions, which are put into canonical order: (t, z, y, x). It has various convenience routines that expose methods from the <i>GridCoordSys </i>and<i> VariableDS </i>objects<i>.</i><span style=""> The main data access method </span>is <i style="">readDataSlice</i>, <span style="">&nbsp;</span>where you can fix an index on any Dimension, or use a -1 t oget all the data in that Dimension. The subset method allows you to create a logical subset of a GeoGrid using index Ranges. <o:p></o:p></span></span></span><span style=""><span style=""><span style=""><o:p></o:p></span></span></span></p>
<h3 class="MsoNormal">Using ToolsUI to look at Grids</h3>
<p class="MsoNormal">You can use ToolsUI <strong>Grid</strong> Tab to view Grid Datasets very similar to the  Coordinate Systems Tab.  This consists of 3 tables that show the Grid DataTypes, the Grid Coordinate systems, and the coordinate axes. </p>
<p class="MsoNormal"><img src="TUIgrids.jpg" width="1046" height="754"></p>
<p class="MsoNormal"><span style=""><span style=""><span style=""><o:p>Use the <img src="redrawButton.jpg" width="31" height="29"> button to display the grids in the Grid Viewer. </o:p></span></span></span></p>
<p class="MsoNormal"><span style=""><span style=""><span style=""><o:p><img src="TUIgridViewer.jpg" width="1009" height="756"></o:p></span></span></span></p>
</body>
</html>
