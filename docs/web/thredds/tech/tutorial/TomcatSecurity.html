<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en"><html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.76 [en] (Windows NT 5.0; U) [Netscape]">
   <meta name="Author" content="John Caron">
   <title>THREDDS Security</title>
  <link rel='stylesheet' href='/thredds/upc.css' type='text/css' />  

</head>

<body>

<h1><img src="../THREDDSlogo.jpg" width="67" height="54">Tomcat Security Tutorial</h1>
<div class="head">
  <address>
  </address>

<hr></div>

<h2>Tomcat</h2>
<p>We believe Tomcat to be secure enough for typical scientific uses. There are no known security exploits or weaknesses. However, the  Internet is a wild place, and we are not security experts so <em>caveat emptor</em>. These are  best practices for running Tomcat. </p>
<h3>Run as Unprivileged User </h3>
<p>By default, Tomcat runs on port 8080 and therefore does not require root to run. Its important not to run as root. Create a special user, e.g. named &quot;tomcat&quot;, which owns everything under <strong>${tomcat_home}</strong>, and change to that user to run Tomcat. This special user will need read/write access to <strong>${tomcat_home}</strong> and its subdirectories, and read access to your data directories. <em>Don't give the tomcat user any rights in any other directories</em>. If your operating system allows it (e.g. Unix, Linux), you might also not allow the tomcat user to log in, requiring instead that you log in as yourself, then switch to being the tomcat user. </p>
<h3> Restrict access to critical files</h3>
<p>Make sure that everything under <strong>${tomcat_home}/conf/</strong> can be read  only by the tomcat user. Typically you would also give write access to the tomcat user. </p>
<h3>Use a Firewall</h3>
<p>Unless you are on a private network, you need a firewall. A firewall restricts who is allowed to access network ports. Make the default setting to disallow all accesses, then enable just the ones that are needed. </p>
<ul>
  <li>Port <strong>8080</strong>  should have unrestricted access. </li>
  <li>If you are allowing <a href="RemoteManagement.html">remote management</a>, you must also open up port <strong>8443</strong>. </li>
  <li>Tomcat also uses port <strong>8005</strong> to enable shutdown. However, shutdown can only be run from the same machine as Tomcat is running from. As long as untrusted users aren't running on your server machine, you shouldn't have to worry about this port being open. However, you might want to restrict public access to it so hackers aren't tempted. </li>
  <li>If you are also using Tomcat in conjunction with another web server like Apache to handle servlet/JSP requests, you need to allow that server access to port <strong>8009</strong>, but typically that can be restricted to accesses on the same machine or at least on your subnet. If you are running Tomcat only standalone (e.g. only running the THREDDS data server) then disable port 8009 in  <strong>${tomcat_home}/conf/server.xml file.</strong></li>
</ul>
<h3><strong>Default Tomcat Applications</strong></h3>
<p>Tomcat ships with several default web applications, found in the <strong>${tomcat_home}/webapps</strong> directory. These defaults depend on the version of Tomcat and which installer you use. </p>
<ul>
  <li>The <strong>ROOT</strong> application contains the server's main page. Any file that you add under <strong>${tomcat_home}/webapps/ROOT</strong> will be served.</li>
  <li> The <strong>admin</strong> and <strong>manager</strong> applications are used for remote management. To use these applications, you must add users with roles <strong>admin</strong> and <strong>manager</strong>, respectively. The applications are then accessible from the main page, and can be used to add further users, start and stop webapps, etc. You should restrict the IP addresses that are allowed to run these applications by editing the files <strong>admin.xml</strong> and <strong>manager.xml</strong> in the <strong>${tomcat_home}/conf/Catalina/localhost/ </strong>directory. Follow<a href="RemoteManagement.html#tomcat"> these directions</a>. </li>
  <li>The <strong>servlets-examples</strong> and <strong>jsp-examples</strong> should probably be removed from a production server, to minimize security exposure. You can do this from the manager application or by deleting those directories from <strong>${tomcat_home}/webapps</strong>.</li>
  <li>The <strong>tomcat-docs, balancer </strong> and <strong>webdav</strong> applications are probably harmless, but can also be removed if you want. </li>
</ul>
<h3>Store Passwords as Digest<a name="Digest"></a></h3>
<p>The file <strong>${tomcat_home}/conf/tomcat-users.xml </strong> stores user names and passwords. By default the passwords are in clear text, e.g.: </p>
<pre>&lt;?xml version='1.0' encoding='utf-8'?&gt;<br>&lt;tomcat-users&gt;<br>  &lt;role rolename=&quot;config&quot;/&gt;<br>  &lt;role rolename=&quot;manager&quot;/&gt;<br>  &lt;role rolename=&quot;admin&quot;/&gt;<br>  &lt;user username=&quot;sysadmin&quot; password=&quot;yrPassword&quot; roles=&quot;manager,admin&quot;/&gt;
  &lt;user username=&quot;cataloger&quot; password=&quot;myPassword&quot; roles=&quot;config&quot;/&gt;<br>&lt;/tomcat-users&gt;</pre>
<p>Store them instead in digested form. First generate the digest (do this for each user): </p>
<pre>  &gt; cd  <strong>${tomcat_home}/</strong>bin
  &gt; ./digest.sh -a SHA yrPassword
  &gt; yrPassword:aa01ea2afaae56c2b7da5e25ec18c505e58f12d7</pre>
<p>Then cut and paste the digested passwords into the <strong>tomcat-users.xml</strong>:</p>
<pre>&lt;?xml version='1.0' encoding='utf-8'?&gt;<br>&lt;tomcat-users&gt;<br>  &lt;role rolename=&quot;config&quot;/&gt;<br>  &lt;role rolename=&quot;manager&quot;/&gt;<br>  &lt;role rolename=&quot;admin&quot;/&gt;<br>  &lt;user username=&quot;sysadmin&quot; password=&quot;aa01ea2afaae56c2b7da5e25ec18c505e58f12d7&quot; roles=&quot;manager,admin&quot;/&gt;
  &lt;user username=&quot;cataloger&quot; password=&quot;5413ee24723bba2c5a6ba2d0196c78b3ee4628d1&quot; roles=&quot;config&quot;/&gt;<br>&lt;/tomcat-users&gt;</pre>
<p>Then change the <strong>server.xml</strong> file to tell it to use digested passwords, by adding this &lt;Realm&gt; element to the &lt;Host&gt; element named <strong>localhost</strong>:</p>
<pre>&lt;Host name=&quot;localhost&quot; debug=&quot;0&quot; appBase=&quot;/opt/tomcat/webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot; 
     xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;
  &lt;Realm className=&quot;org.apache.catalina.realm.MemoryRealm&quot; digest=&quot;SHA&quot; /&gt;
  ...
&lt;/Host&gt;</pre>
<h3><br>
Java Security Manager</h3>
<p>An additional level of security can be provided by running Tomcat with the Java Security Manager turned on. This can provide fine-grained security policies, at the cost of complexity in understanding what rights are needed to do any useful work, and how to grant them. This is needed if you allow untrusted servlets or JSPs to execute on your machine. If you are running just the THREDDS Data Server, you probably don't need to deal with this. </p>
<h3>Resources</h3>
<ul>
  <li><a href="http://jakarta.apache.org/tomcat/faq/security.html">Tomcat Security FAQ</a> </li>
  <li><a href="http://www.amazon.com/exec/obidos/tg/detail/-/0672326361/qid=1119911434/sr=8-1/ref=sr_8_xs_ap_i1_xgl14/102-3771289-9904123?v=glance&s=books&n=507846">Tomcat 5 Unleashed </a>is a recent book about all aspects of Tomcat. </li>
  <li> <a href="http://www.amazon.com/exec/obidos/tg/detail/-/1861008309/ref%3Dpd%5Fsl%5Faw%5Falx-jeb-7-1%5Fbook%5F2595022%5F1/102-3771289-9904123">Apache Tomcat Security Handbook</a> dated but still useful, e.g. to use the Java Security Manager. Chapter 1 is online <a href="http://www.theserverside.com/articles/content/TomcatSecurity/TomcatSecurity.pdf">here</a>. </li>
  <li> <span name="intelliTxt" id="intelliTxt"><a href="http://www.oreilly.com/catalog/tomcat/">Tomcat: The Definitive Guide (O'Reilly)</a></span> also dated but  useful.The Security chapter is online <a href="http://www.oreilly.com/catalog/tomcat/chapter/ch06.pdf">here</a>. </li>
</ul>
<hr WIDTH="100%">
<address>
<img src="../images/thread.png" width="110" height="108">This document is maintained by <a href="mailto:caron@unidata.ucar.edu">John Caron</a> and was last updated on Oct 24, 2006
</address>
<p>&nbsp;</p>
</body></html>