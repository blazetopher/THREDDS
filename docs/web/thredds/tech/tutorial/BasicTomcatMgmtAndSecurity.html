<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <title>Basic Tomcat Management and Security</title>
</head>

<body>

<h1><img src="../THREDDSlogo.jpg" height="54" width="67">Basic Tomcat Management and Security </h1>
<hr>

At this point we assume that Tomcat is installed in
<code> /home/workshop/tds/apache-tomcat-6.0.13 </code>
and that you have an environment variable TOMCAT_HOME set to this value.
<p>
    Check that this variable is set by with this command:
<p>
    <code> echo $TOMCAT_HOME</code>
<p>

    If the system indicates that the variable is not set, recall that you can
    set this variable in any window at any time by executing the command:
<p>
<code> set TOMCAT_HOME /home/workshop/tds/apache-tomcat-6.0.13  </code>
<p>
(This command works under the UNIX bash shell, which is the shell running on
our workshop machines.  You may need to use a different command if running
under some other shell.)


<a name="ImportantDirs" />
<h2>Important Tomcat Directories </h2>

<h3> The <code> webapps </code> Directory </h3>
<p>
    The <code> webapps </code> directory is where web applications are placed to be
    run by Tomcat.  Tomcat automatically monitors this directory and when it finds
    a new
    <code>.war</code> file it will attempt to install it as an application.  If
    there is an error in the deployment, such as a problem with the file, it will report
    that in the the log file <code> catalina.out</code>.
<p>
    Do this:
<p>
<code>ls $TOMCAT_HOME/webapps</code>
<p>
    Among other things, you should see the <code> thredds.war </code> file that was previously installed,
    and a directory called <code> thredds</code>.  This is the TDS code.
    Tomcat installed the TDS automatically in a directory named
    <code>thredds</code>when the <code>thredds.war</code> file was placed there.
<p>
    You will also see a file here called <code>manager</code>.  This is the Manager
    application that we will visit soon.

<p>
<h3> The <code> logs </code> Directory    </h3>
<p>
    Once Tomcat has been started it will generate some log files and put them in
    the <code>logs </code> directory.  The files
    that are generated depends on how the server is configured.  Here is an
    example from one recent Tomcat installation using the default configuration:
<pre>
[tomcat@lead3 ~/logs]$ ls -lt
total 12
-rw-r--r-- 1 tomcat leadstaff  234 Jul 26 11:49 localhost.2007-07-26.log
-rw-r--r-- 1 tomcat leadstaff 1597 Jul 26 11:49 catalina.2007-07-26.log
-rw-r--r-- 1 tomcat leadstaff 1710 Jul 26 11:49 catalina.out
-rw-r--r-- 1 tomcat leadstaff    0 Jul 26 11:49 localhost_access_log.2007-07-26.txt
-rw-r--r-- 1 tomcat leadstaff    0 Jul 26 11:49 admin.2007-07-26.log
-rw-r--r-- 1 tomcat leadstaff    0 Jul 26 11:49 host-manager.2007-07-26.log
-rw-r--r-- 1 tomcat leadstaff    0 Jul 26 11:49 manager.2007-07-26.log
</pre>

The <code> logs </code> directory contains Tomcat log files.  Do this:
<p>
    <code> ls $TOMCAT_HOME/logs </code>
</p>
<p> The log file <code> <b>catalina.out</b> </code> is Tomcat's main log file and can be worth
    watching when
    Tomcat is started or when an web application is placed in the <code> webabbs </code> directory
    to ensure that no errors occurred.  A successful launch of Tomcat generates lots of entries
    in <code>catalina.out</code>, but that stream of entries generally ends with a line
    like this, which indicates a successful start up:
<pre>
Jul 26, 2007 11:49:09 AM org.apache.catalina.startup.Catalina start
INFO: Server startup in 5080 ms
</pre>

<p>
    Similarly, if there seems to a problem in the execution of Tomcat
    or a web application, <code> catalina.out </code> is good place to look for an error.  Or, just check the
    <code>logs </code> directory for the file most recently written and see if any errors are reported
    there.</p>
<p>
    The <code> <b>localhost_access_log </b></code> file (such as
    <code>localhost_access_log.2007-07-26.txt </code> in the example above)
    is useful in both Tomcat and TDS administration because it tracks all requests made to the Tomcat
    server and the response given by the server.   For example, this lines:
<pre>
128.117.156.28 - - [26/Jul/2007:11:59:54 -0700] "GET /thredds/tdr/storm/catalog.html HTTP/1.1" 200 2139
</pre>
shows that a request arrived from a host with the IP address 128.117.156.28
on July 26 to retrieve the document
/thredds/tdr/storm/catalog.html (relative to the Tomcat
<code> content </code> directory, described below) using HTTP protocol
version 1.1.  It also shows that the server returned the HTTP status code 200, which means <q>OK</q> and
that the request succeeded, and the number of bytes sent.
(See <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">HTTP Status Code Definitions </a>
for the meaning of response codes returned by HTTP.)


<h3> The <code> content </code> Directory   </h3>
The <code><b>content</b></code> directory is the place to put documents to
be served by tomcat.  This includes TDS catalogs.  


<h3> The <code> conf </code> Directory   </h3>
The <code><b>conf</b></code> directory holds files used to configure Tomcat.
In this document we will focus on the files <code>tomcat-users.xml</code> and <code>server.xml</code>.
<p>
<code>tomcat-users.xml</code> contains information about users of the application served by
tomcat.  It holds user names, passwords, and defines user <q>roles</q>, which can used
to limit access to various pieces of functionality of a application.  It is discussed
further <a href="#Tomcat Manager"> below</a>.
<p>



<h3> The Configuration File <code>conf/server.xml</code> </h3>

The file <code>server.xml</code> is used to configure Tomcat.  It is an XML file that contains
elements to configure various aspects of Tomcat.
See <a href="http://tomcat.apache.org/tomcat-5.0-doc/config/">Tomcat Server Configuration Reference </a>
    for more information about <code>server.xml</code>.
Here we will focus on a few select concepts and XML elements relevant to setting up a TDS.
<p>
The outermost element of <code>server.xml</code>  is a <code>Server</code> element,
which represents the entire Tomcat servlet container and defines its
    characteristics as a whole.
<p>
A <code>Service</code> element is a nested element with the <code>Server</code>
    element.  It represents the combination of one or more <code>Connector</code>
    components that share a single <code>Engine</code> component.
    (An <code>Engine</code> represents the entire request processing machinery
    associated with a <code>Service</code>.)
    The <q>top</q> Tomcat service is named <q>Catalina</q>. (Hence the log
file name of <q>catalina.out</q>.)


<h4> Ports, Configured Via the Server and Connector Elements </h4>

Tomcat listens for requests on port 8080 (which is why your local Tomcat
splash page can be reached via
<a href="http://locahost:8080/"> http://locahost:8080/</a>).  This is set
via a <q>Connector</q> element in <code>server.xml</code>.  A Connector element
represents the interface between external clients sending requests to
and receiving responses from Tomcat.  This element can
take additional attributes for further configuration.  Here is an example
that came with a recent Tomcat installation:
<pre>
       &lt;Connector port="8080"
               maxThreads="150" minSpareThreads="25" maxSpareThreads="75"
               enableLookups="false" redirectPort="8443" acceptCount="100"
               debug="0" connectionTimeout="20000"
               disableUploadTimeout="true" /&gt;
</pre>

<p>
Tomcat listens for a shutdown command on port 8005.  Keeping
the shutdown functionality on a separate port provides enhanced security in that
shutdown commands can't be received externally.  This port is defined in
the main <q>Server</q> element.  Here is the first line
of that element, illustrating the shutdown port 8005:
<pre>
&lt;Server port="8005" shutdown="SHUTDOWN" debug="0"&gt;
</pre>

<p>

The other important port for secure Tomcat and TDS management is port 8443, which
    is the port
on which Tomcat listens for secure connections.   Like port 8080, this
is defined via a Connector attribute.   This particular connector may
be commented out in a default installation.  We will make sure it is
enabled when we configure Tomcat to use SSL encryption, below.  For
illustration, here is an example of a Connector for port 8443:
    <pre>
    &lt;Connector port="8443"
               maxThreads="150" minSpareThreads="25" maxSpareThreads="75"
               enableLookups="false" disableUploadTimeout="true"
               acceptCount="100" debug="0" scheme="https" secure="true"
               keystoreFile="/opt/tomcatlead2/jakarta-tomcat-5.0.28/conf/keystore-tomcat"
               clientAuth="false" sslProtocol="TLS" /&gt;
</pre>

<h4> Access Logging, Configured Valve Elements </h4>

A <code>Valve</code> element is a way to preprocess requests sent to Tomcat.
Of particular interest here is the Access Log Valve, which creates log files
to track client access information, as we saw in the access_log file above.
As we saw, this valve can be used to a variety of information, including 
page hit counts, user session activity, user authentication
information, and other information.
<p>
Attributes to this valve are used to configure the information reported
in the log file.  Here is an example of a simple Access Log Valve that came
    with a recent Tomcat distribution:
    <pre>
&lt;Valve className="org.apache.catalina.valves.AccessLogValve"
                 directory="logs"  prefix="localhost_access_log." suffix=".txt"
                 pattern="common" resolveHosts="false"/&gt;
</pre>
This is the valve that produced the log entries we saw above.  The <code>pattern</code> attribute of this element defines a formatting layout.
<q>common</q> is a standard format.  But these a pattern can also be defined as
a literal text string.
Here is an example of the version of the Access Log Valve used on our TDS
server:
<pre>
&lt;Valve className="org.apache.catalina.valves.AccessLogValve"
                 directory="logs"  prefix="access." suffix=".log"
                 pattern="%h %l %u %t &quot;%r&quot; %s %b &quot;%{Referer}i&quot; &quot;%{User-Agent}i&quot; %D"
                 resolveHosts="false"/>
</pre>
This produces log entries that look like this:
<pre>
 128.117.126.9 - - [23/Jun/2007:23:52:42 -0600] "GET /thredds/catalog/fmrc/NCEP/GFS/Global_2p5deg/catalog.html HTTP/1.0" 200 4014 "null" "www.dlese.org,support@dlese.org" 30463
</pre>

<p>
    For more  information about the pattern codes supported by the Access Log Valve, see
<a href="http://tomcat.apache.org/tomcat-5.0-doc/config/valve.html"> The Valve Component </a>.


 <h4> User Names and Passwords, Configured Via Realm Elements </h4>

Realms allow the protected resources on a server to be partitioned into a set of 
protection spaces, each with its own authentication scheme and/or authorization
database.
A Tomcat <code>Realm</code> is implemented as a <q>database</q> of usernames and
    passwords that identify valid users of a web application or set of web
    applications. </p>
<p>
We will use <code>Realm</code> elements below in configuring Tomcat to
use digested passwords.




<h2>Tomcat Security</h2>

We believe Tomcat to be secure enough for typical scientific uses. There are no known security
exploits or weaknesses. However, the Internet is a wild place, and we are not security experts so caveat emptor.

<p>
In this section we introduce Tomcat security by enabling authentication in order
    to use the Tomcat Manager application, and also by enabling Secure Socket Layer
    (SSL) encryption of requests to the TDS <q>debug</q> application.  The Tomcat Manager is
    an application that is distributed with the Tomcat distribution, which provides a graphical user
interface to manage Tomcat.  The TDS <q>debug</q> application provides an interface to manage
the TDS remotely.  Because each application provides access to sensitive functionality,
it is necessary to secure them by requiring users to authenticate to Tomcat and by requiring
    SSL encryption of the information that is sent to Tomcat.


<h3> Using Authentication to Restrict Access to Tomcat Applications</h3>

Although by default Tomcat does not require authentication to access the resources
it controls, it can be configured to do so.   From a TDS perspective, authentication
is required to 1) get access to the tomcat manager application, and 2) enable remote
TDS management.
<p>
    This section introduces the Tomcat authentication mechanism by describing how to
    enable authentication in order to use the Tomcat manager.   (Enabling remote
    TDS management is described under <q>Tools for Managing TDS, Using Remote Management</q>.)






<a name="Tomcat Manager" /><h3> The Tomcat Manager </h3>

The Tomcat Manager is an application that allows users to deploy, undeploy, or
reload an application such as the TDS without having to shut down and restart tomcat.
The tomcat distribution contains this application, but for security reasons it is
disabled by default.

<p>
    Execution of the tomcat manager requires that users authenticate themselves and
    be associated with the predefined role <q>manager</q>.  That is, users must provide
    a user name and password, and their user name must be associated with the
    manager role.  By default, this information is stored in the file
    <code>${TOMCAT_)HOME}/conf/tomcat-users.xml</code>.





<h3> tomcat-users.xml</h3>

Here is an example of a very simple <code>tomcat-users.xml</code> file:

<pre>
&lt;tomcat-users&gt;
    &lt;role rolename="tdsConfig /&gt;
    &lt;user name="Anne" password="secret" roles="tdsConfig" />
&lt;/tomcat-users>
</pre>

There must be an entry in the file for each user that is required to authenticate.
Each <code>&lt;user&gt;</code> entry defines the user name, password, and roles that are assigned to
that user. In this example there is one role defined, <q>tdsConfig</q>.  There
is also one user, <q>Anne</q>, with the password <q>secret</q> and she is
assigned the role <q>tdsConfig</q>.
<p>
    You can think of roles as similar
to groups in Unix-like operating systems, because access to specific web
application resources is granted to all users possessing a particular role
(rather than enumerating the list of associated usernames). A particular user
can have any number of roles associated with their username.
</p>
<p>
    When a user
    attempts to access a protected resource for the first time, Tomcat will challenge
    the user for a user name and password.  Once the user has been authenticated, the
    relevant information, including the roles to which the user was assigned, is
    cached for the duration of the user&#146;s login.
<p>
    <code>tomcat-users.xml</code> is read once when Tomcat is started.  For this reason, changes to
    <code>tomcat-users.xml</code> will not be recognized until Tomcat is restarted.








<h3> Configuring tomcat-users.xml to Allow a User to Execute the Manager </h3>

In order to allow a user to execute the manager, the user's name and password must
be added to the <code>tomcat-users.xml</code> file, and the user must be assigned the <q>manager</q>
role, which is a predefined role in Tomcat.

<p>
    Role names such as <code> manager </code> should be added to the <q>role</q>
    attribute of a
    <code> &lt;user&gt; </code>
    element.  The value of the role attribute can be a single value or a comma separated
    list of values.  For example, to add the manager role to the user <q>Anne</q> in the above
    example, the result would look like this:
<pre>
    &lt;code&gt;
        &lt;role rolename="tdsConfig /&gt;
        &lt;role rolename="manager" /&gt;
        &lt;user name="Anne" password="secret" roles="tdsConfig,manager" /&gt;
    &lt;/code&gt;
</pre>
    <b>Exercise:</b>  Modify the default <code> tomcat-users.xml</code> to add yourself as a user and give
    yourself the role of <q>manager</q>.  Start (or restart) Tomcat, and ensure that you can
    access the manager application.

<p>
    Test this change by pointing your browser to <a href="http://localhost:8080"> http://localhost:8080 </a>
    and then click
    on the <q>Manager</q> link in the left hand column.  You&#146;ll see that you will not be
    challenged on getting the Tomcat splash page, but you will be challenged when you
    try to access the manager.

<p>
    <b>TODO: move this to the server.xml section </b>
<br>
    Go to the directory <code>~tomcat/logs</code> and list the files.  You might? Should? see a file
    called something like localhost_accessLog.  Is this enabled on the machines?
    Tail the log (run “tail –f localhost_accessLog) and try to access the manager
    again.  This log will show you the HTTP status codes returned by tomcat.  You’ll
    see …

<p>
    <b>TODO: skip? </b>
<br>
    <b>Exercise:</b> This exercise is to help you learn to debug tomcat problems.
    Modify tomcat-users.xml, but make sure there&#146;s some problem with the XML format.
    For example, leave off a closing angle bracket.  In the logs directory
    (~tomcat/logs) tail the file catalina.out as you restart Tomcat.  The log
    file should report some kind of error that would, in theory, lead you to
    reexamine tomcat-users.xml and help you find the error.





<h3> Using Digested Passwords </h3>

By default, Tomcat expects user passwords to be stored in clear text.  As you can
imagine, this is not very secure.  Tomcat also supports digested passwords, a type
of encoding, but it must configured to use them.  Then, when a
client (like Firefox) makes a request, Tomcat will tell the client that a digested
    password is required. Based on this dialog, the client
    will automatically digest the password entered by the user.
<p>
    There are several digest algorithms.  Here we will use the SHA (Secure Hash
    Algorithm) algorithm.




<h3> Configuring Tomcat to Use Digested Passwords </h3>
There are three steps to configuring Tomcat use digested passwords:
<ol>
    <li> Configure <code>server.xml</code> to use digested passwords</li>
    <li> Create the digested passwords and put them in <code>tomcat-users.xml</code></li>
    <li> Restart Tomcat</li>
</ol>
<h4> Configure <code>server.xml</code> to Use Digested Passwords</h4>

    The Tomcat distribution comes with this Realm enabled in <code>server.xml</code>:
<pre>

      &lt;!-- This Realm uses the UserDatabase configured in the global JNDI
      resources under the key "UserDatabase".  Any edits
      that are performed against this UserDatabase are immediately
      available for use by the Realm.  --/&gt;
      &lt;Realm className="org.apache.catalina.realm.UserDatabaseRealm"
             resourceName="UserDatabase"&gt;

</pre>
We will not use this Realm and instead create a new one using the Tomcat
<q>MemoryRealm</q>.  Find the above Realm definition in <code>server.xml</code>,
comment it out, and add this new Realm:
<pre>
      &lt;Realm className="org.apache.catalina.realm.MemoryRealm" digest="SHA" /&gt;
</pre>
<p>
The result should look something like this:
<pre>
      &lt;!--Realm className="org.apache.catalina.realm.UserDatabaseRealm"
             resourceName="UserDatabase"/--/&gt;

      &lt;!--  Added by Anne --/&gt;
      &lt;Realm className="org.apache.catalina.realm.MemoryRealm" digest="SHA"/&gt;
</pre>

<h4> Create and Store the Digested Passwords</h4>

Tomcat provides a script, <code>digest.sh</code>, that creates a digested
version of a password.  The script takes an argument that specifies which digest algorithm
to use.  It also takes an argument that is the password to be digested.  Here is
an example of the command usage:

<pre>
    ${TOMCAT_HOME}/bin/digest.sh -a SHA secret
</pre>
This will produce output like this:
<pre>
    secret:e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4
</pre>
which shows the digested form of the password <q>secret</q>.
<p>
If you get output like this:
<pre>
    (anne) lead3: /opt/tomcat 6 % bin/digest.sh -a SHA secret
    /opt/tomcat/bin/setclasspath.sh: line 58: [: =: unary operator expected
    secret:e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4
</pre>
don&#146;t worry about the error.  The digested password is still correct.
<p>
You must the copy the digested password, the part to the right of the colon character,
    into <code>tomcat-users.xml</code> in place of the clear text
    password.

<h4> Restart Tomcat</h4>
    After you have modified <code>server.xml</code> and copied the digested
    password into <code>tomcat-users.xml</code>, restart Tomcat for this change to take effect.
<p>
<b>Exercise:</b> Do the above for the clear text password that you added to
    <code>tomcat-users.xml</code> earlier.  After you&#146;ve made the changes
and restarted Tomcat, test the change by accessing the Manager application.
The behavior of Tomcat should be the same as when you first added your password.
You know, however, that the digested password is being used as that is what
is stored in <code>tomcat-users.xml</code>.


<h2> Enabling Secure Communication to Tomcat Via SSL Encryption </h2>

Using digest passwords eliminates the problem of storing passwords in clear text.
But it does not address the possibility of snooping on a connection to the server.
By enabling SSL on the server we require clients to SSL encode their requests.
This prevents network sniffers from acquiring sensitive information.

<p>
    Besides encoding information sent to the server, the SSL protocol also requires
    that the server authenticate to the client.  This is to prevent a spoof from
    pretending to be a trusted server and fraudulently obtaining sensitive
    information.  For this reason, to enable SSL it is first necessary to create
    an SSL certificate for the server, in this case Tomcat.  This is a credential that is passed to
    the client upon initiating a connection that certifies the server&#146;s identity.
    Among trusted sites, it is sufficient for the server to send a <q>self-signed</q>
    certificate, the creation of which is described here.  A self-signed certificate
    is not considered the most secure because there is no third party
    certificate authority vouching for the site.  If you are interested
    in using more secure certificates, see the subsection called <q>Upgrading SSL
    security level by creating a CA (Certificate Authority) signed key</q> under
    the Section
    <a href="productionAdvanced.html">Production Installation - Advanced</a>.


<p>
    The page <a href="http://tomcat.apache.org/tomcat-4.1-doc/ssl-howto.html">SSL Configuration HOW-TO</a>
    from the Tomcat documentation gives information about Tomcat and SSL. 

<h3>Creating a Self-Signed Certificate </h3>

To create a self-signed certificate, you must first create a <q>keystore</q> file
where certificates are stored.  Java provides a tool, called keytool, that
generates a self-signed certificate and puts in a keystore file.  The default
keystore filename is ${user_home}/.keystore.  However, this example will use
the filename ${TOMCAT_HOME}/conf/keystore-tomcat.

<p>
    To create a self-signed certificate and store it in
    ${TOMCAT_HOME}/conf/keystore-tomcat, execute this command:
<p>
    <code>
        /usr/java/jdk1.5.0_10/bin/keytool -genkey -alias tomcat -keyalg RSA -validity 365 -keystore ${TOMCAT_HOME}/conf/keystore-tomcat
    </code>
<p>
    The arguments to this command tell <code>keytool</code> to generate a key,
    make an entry for the keystore file identified by the alias "tomcat" (the
    alias used by Tomcat),   
    use the RSA encryption algorithm,
    create a certificate valid for 365 days,
    and put it in the keystore file called <code>${TOMCAT_HOME}/conf/keystore-tomcat</code>.

<p>
    This command will generate this series of questions:

<pre>

Enter keystore password:  changeit

What is your first and last name?

  [Unknown]:  localhost

What is the name of your organizational unit?

  [Unknown]:  tomcat server

What is the name of your organization?

  [Unknown]:  Anne&#146;s Home

What is the name of your City or Locality?

  [Unknown]:  Boulder

What is the name of your State or Province?

  [Unknown]:  Colorado

What is the two-letter country code for this unit?

 [Unknown]:  US

Is CN=localhost, OU=tomcat server, O=Anne&#146;s Home, L=Boulder, ST=Colorado, C=US correct?

  [no]:  yes



Enter key password for &lt;Anne&gt;

        (RETURN if same as keystore password):

</pre>

<p>
    The default <code>keytool</code> password is <q>changeit</q>.  You must use this same
    password for both the keystore password and the key password for tomcat.
    Although it's not obvious, the <q>first and last name</q> should be the name of the server host machine.

<p>
    Note: The above output was generated when keytool was run as special user "tomcat".
In the context of this workshop we are running as user "workshop" so your output
will reflect that difference.
</p>
    <p>
    Exercise: Create the keystore file.


<h3> Configure Tomcat to Use SSL Encryption     </h3>

Next, it is necessary to configure the tomcat server to use this new keystore file.
This requires another modification to <code>server.xml</code>.  In
<code>server.xml</code>  we will
<ol>
    <li>Redirect requests to port 8080 to port 8443, the secure port</li>
    <li>Create a Connector for port 8443</li>
</ol>
<p>
    To redirect requests to port 8443, find the Connector that uses port
    8080.

<p>
    In <code>server.xml</code> find the Connector element that uses port 8443,
    the SSL port.  By default is commented out.  In a recent Tomcat installation
    it looked like this:
    <pre>
    <!--Connector port="8080" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443" /-->    
    </pre>


    Ensure that that Connector XML element is
    not commented out.  Also, to that element add the attribute
    <code>keystoreFile</code> and
    optionally the attribute <code>keystorePass</code> if you are no longer
    using the default password so that it looks similar to this:

    <!-- Define a SSL Coyote HTTP/1.1 Connector on port 8443 -->


    <Connector port="8443"

               maxThreads="150" minSpareThreads="25" maxSpareThreads="75"

               enableLookups="false" disableUploadTimeout="true"

               acceptCount="100" debug="0" scheme="https" secure="true"

               clientAuth="false" sslProtocol="TLS"

               keystoreFile="${keystore_filename}"

               keystorePass="mypassword"/>

    from begonia:

    <!-- Define a SSL HTTP/1.1 Connector on port 8443 -->

    <Connector port="8443" maxHttpHeaderSize="8192"

               maxThreads="150" minSpareThreads="25" maxSpareThreads="75"

               enableLookups="false" disableUploadTimeout="true"

               acceptCount="100" scheme="https" secure="true"

               clientAuth="false" sslProtocol="TLS"

               keystoreFile="/opt/tomcat/conf/keystore-tomcat" />

<p>
    Finally, restart the Tomcat server to pick up these changes.

<p>
    Exercise: configure Tomcat to use SSL.  Restart Tomcat, and connect via your browser.


    Other Tomcat Security Resources

<p>
    <pre>
In any case, we strongly recommend that you also read and follow the Tomcat/TDS Security guidelines.

Higher Security: You can also use an LDAP server or a Database to store users and roles, which may give you higher levels of security. Use of this feature is beyond the scope of this documentation, however.
Leftover Stuff To Consider
Checking that the correct ports are enabled

After restarting Tomcat, you can use netstat -an command to check that the ports are correctly configured. You should see lines like:

  TCP    127.0.0.1:8080         0.0.0.0:0              LISTENING

  TCP    127.0.0.1:8443         0.0.0.0:0              LISTENING

You also need to make sure that your firewall is allowing those ports through.
TroubleShooting

    * Connection refused when trying to access a restricted page. The SSL socket is not enabled in the server.xml file, or you didn&#146;t install a certificate in the keystore.
    * What&#146;s in the keystore?
          o Look at the Tomcat Server Status page and check the JVM Version.
          o From command line, make sure that this matches the results of 'java -version'. If not, then your Tomcat server is starting up with a different JVM.
          o From command line, 'keytool -list' will show you what's in the default keystore. Standard is to have password changeit. You need an entry named tomcat.

Running without SSL

If you are on a secure network, and don't want to run with SSL enabled, edit ${TOMCAT_HOME}webapps/thredds/WEB-INF/web.xml and change all instances of CONFIDENTIAL to NONE.

Password authentication will then be done without SSL encryption. You will have to repeat this whenever you reinstall or upgrade thredds.war.
Resources

    * Tomcat SSL Configuration
    * Java Secure Sockets Extension (JSSE) Reference Guide
    * JDK keytool application

 </pre>




<hr width="100%">

<address>
    <img src="../images/thread.png" height="108" width="110">
    This document is maintained by Anne Wilson and was last updated
    on July 26, 2007.
    Send comments to <a href="mailto:support-thredds@unidata.ucar.edu">THREDDS support</a>.
</address>

<p>&nbsp;</p>

</body></html>