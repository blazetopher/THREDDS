<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
 <html>
  <head>
   <title>TDS Tutorial: Getting Started</title>
   <link rel="stylesheet" href="tutorial.css" type="text/css" /> 
   <script language="JavaScript1.2" src="http://www.unidata.ucar.edu/acemenu/last_mod.js"></script>
   <link rel="SHORTCUT ICON" href="http://www.unidata.ucar.edu/favicon.ico" type="image/x-icon" />
  </head>
  <body>

   <h1><img src="../images/THREDDSlogo.jpg" height="54" width="67"> TDS Tutorial: Getting Started</h1>    
   <div id="section">
    <h2><a name="install">Installing Java &amp; Tomcat</a></h2>

     <div id="subsection">
      <h3>System Requirements</h3>

      <div id="info">
       <h4>Installation Help</h4>
       <p>Users of GCJ and OS-provided packages (linux) for Java and/or Tomcat may want to reference the <a href="http://www.unidata.ucar.edu/mailing_lists/archives/thredds/2009/msg00130.html">THREDDS mailing list</a> for installation help.</p>
      </div>




       <ul>        
        <li>Sun Java 1.6</li>       
        <li>Apache Tomcat 5.5 or above         (we recommend the latest version of Tomcat 6.0)</li>  
       </ul>
       <p>While there are different distributors of Java and servlet containers, Unidata develops, uses and tests the THREDDS Data Server using <i>Sun Java</i> and the <i>Apache Tomcat</i> servlet container.</p>



     </div> <!-- end subsection -->



     <div id="subsection">
      <h3>Installing Java</h3>
      <ol>
       <li><a href="http://java.sun.com/javase/downloads/">Download</a> current Java SE Developer Kit (JDK) from Sun.</li>
        <p>We will be using the Linux x32-bit, <i>non-rpm</i>, self-extracting file for this workshop:</p>
        <p><code>jdk-6u14-linux-i586.bin</code></p>
       <li>Install the JDK as per the Sun <a href="http://java.sun.com/javase/6/webnotes/install/">installation instructions</a>.</li>
        <p>Copy the self-extracting file to the installation directory (our home directory is the installation directory in this example):</p>

<pre>
<b>$</b> cp jdk-6u14-linux-i586.bin ~
<b>$</b> cd
</pre>

        <p>Change the permissions on the file to be executable:</p>  

<pre>
<b>$</b> ls -l jdk-6u14-linux-i586.bin
-rw-r--r-- 1 thredds workshop 81771117 2009-07-09 14:54 jdk-6u14-linux-i586.bin

<b>$</b> chmod 755 jdk-6u14-linux-i586.bin  

<b>$</b> ls -l jdk-6u14-linux-i586.bin 
-rwxr-xr-x 1 thredds workshop 81771117 2009-07-09 14:54 jdk-6u14-linux-i586.bin 
</pre>

        <p>Run self-extracting file and agree to the terms of the code license:</p>

<pre>
<b>$</b> ./jdk-6u14-linux-i586.bin
</pre>

       <li>Set the <code>$JAVA_HOME</code> environment variable.</li>
<pre>
<b>$</b> set JAVA_HOME=/home/thredds/jdk1.6.0_14  
<b>$</b> echo $JAVA_HOME 
/home/thredds/jdk1.6.0_14 
</pre>

      </ol>

      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting Tips</h4>
       <ul>
        <li>Check to make sure the JDK self-extracting file has the correct permissions and is executable.</li>
        <li>If you receive an error while running the self-extracting file, you may have downloaded the wrong type of JDK for your machine.</li>
        <li>Depending on your OS (e.g., Solaris), you may need install <i>both</i> the 32-bit and 64-bit self-extracting files.</li>
       </ul>
      </div>




     </div> <!-- end subsection -->


     <div id="subsection">
      <h3>Installing Tomcat</h3>
      <ol>
       <li><a href="http://tomcat.apache.org/">Download</a> current version of the Tomcat servlet container.</li>
        <p>We will be using the core binary tar.gz file for this workshop:</p>
        <p><code>apache-tomcat-6.0.20.tar.gz</code></p>
       <li>Install Tomcat as per the Apache Tomcat <a href="http://tomcat.apache.org/tomcat-6.0-doc/setup.html">installation instructions</a>.</li>
        <p>Copy the binary tar.gz file to the installation directory (our home directory is the installation directory in this example):</p>

<pre>
<b>$</b> cp apache-tomcat-6.0.20.tar.gz ~
<b>$</b> cd
</pre>

        <p>Unpack the archive to create Tomcat directory:</p>  

<pre>
<b>$</b> tar xvzf apache-tomcat-6.0.20.tar.gz

<b>$</b> ls -ld apache-tomcat*
drwxr-xr-x 9 thredds workshop 4096 2009-07-09 15:05 apache-tomcat-6.0.20
</pre>

       <li>Set the <code>$TOMCAT_HOME</code> environment variable.</li>
<pre>
<b>$</b> set TOMCAT_HOME=/home/thredds/apache-tomcat-6.0.20
<b>$</b> echo $TOMCAT_HOME
/home/thredds/apache-tomcat-6.0.20
</pre>

      </ol>


     </div> <!-- end subsection -->
      <div id="subsection" class="exercise">
       <h3>Exercise One: Install Java and Tomcat</h3>
       <ol>
        <li>Using the steps outlined in the above sections, install the JDK and Tomcat in <code>/home/thredds</code>.</li>

       </ol>
      </div>


   </div> <!-- end section -->



   <div id="section">
    <h2><a name="tour">Tomcat Directory Structure: Quick Tour</a></h2>

     <div id="subsection">
      <h3>Exploring <code>$TOMCAT_HOME</code></h3>
      <ol>
       <li>Examine the Tomcat directory structure.</li>
        <p>Move into the new Tomcat directory and do a long listing:</p>
<pre>
<b>$</b> cd apache-tomcat-6.0.20/
<b>$</b>  ls -l 
total 88
drwxr-xr-x 2 thredds workshop  4096 2009-07-09 15:05 bin
drwxr-xr-x 2 thredds workshop  4096 2009-05-13 17:15 conf
drwxr-xr-x 2 thredds workshop  4096 2009-07-09 15:05 lib
-rw-r--r-- 1 thredds workshop 37951 2009-05-13 17:15 LICENSE
drwxr-xr-x 2 thredds workshop  4096 2009-05-13 17:15 logs
-rw-r--r-- 1 thredds workshop   556 2009-05-13 17:15 NOTICE
-rw-r--r-- 1 thredds workshop  7317 2009-05-13 17:15 RELEASE-NOTES
-rw-r--r-- 1 thredds workshop  6368 2009-05-13 17:15 RUNNING.txt
drwxr-xr-x 2 thredds workshop  4096 2009-07-09 15:05 temp
drwxr-xr-x 7 thredds workshop  4096 2009-05-13 17:15 webapps
drwxr-xr-x 2 thredds workshop  4096 2009-05-13 17:15 work
</pre>

       <li>Familiarize yourself with the following important directories.</li>

        <p><code>$TOMCAT_HOME/bin/</code></p>
         <ul class="little">
          <li>Contains <code><small>startup.sh</small></code>, <code><small>shutdown.sh</small></code> and other scripts/programs.</li>
          <li>The <code><small>*.sh files</small></code>  (for Unix systems) are functional duplicates of the <code><small>*.bat</small></code>  files (for Windows systems).</li>
         </ul>
        <p><code>$TOMCAT_HOME/conf/</code></p>
         <ul class="little">
          <li><i>Server-wide</i> Tomcat configuration.</li>
          <li>You will modify <code><small>server.xml</small></code> and <code><small>tomcat-users.xml</small></code> to adjust logging, authentication and access control, enable SSL, etc.</li>
          <li>Web applications can override some server-wide settings in their own configuration files (more about that later).</li>

         </ul>

        <p><code>$TOMCAT_HOME/logs/</code></p>
         <ul class="little">
          <li><i>Tomcat log files</i> are here by default.</li>
          <li>This is one of the directories you will be looking for log files (the TDS logs elsewhere by default).</li>
          <li><i>The log files should be your first stop for troubleshooting Tomcat and TDS issues</i> (Hint. Hint.)</li>
          <li>Logs files may contain useful information for assessing the security of your system.</li>
          <li>You will become very familiar with <code><small>catalina.out</small></code> and <code><small>access.YYYY-MM-DD.log</small></code> by the end of this workshop.</li>
         </ul>

        <p><code>$TOMCAT_HOME/webapps/</code></p>
         <ul class="little">
          <li>Contains web applications directories and WAR files</li>
          <li>This is where we will be putting the TDS web application.</li>
          <li>You will also be using the <code><small>manager</small></code> application that comes with Tomcat during this workshop.</li>
         </ul>

      </ol>

     </div> <!-- end subsection -->


   </div> <!-- end section -->


   <div id="section">
    <h2><a name="running">Running Tomcat</a></h2>

     <div id="subsection">
      <h3>Starting &amp; Stopping Tomcat</h3>
      <ol>
       <li>Tomcat isn't currently running so we need to start it up.</li>
        <p>Move into the <code><small>$TOMCAT_HOME/bin/</small></code> directory and run the <code><small>startup.sh</small></code> script:</p>
<pre>
<b>$</b> cd $TOMCAT_HOME/bin
<b>$</b>  ./startup.sh
</pre>




       <li>Verify Tomcat is running.</li>
        <p>Look and see if you have a Tomcat process running:</p>

<pre>
<b>$</b> ps -ef | grep tomcat
thredds  32018     1  1 15:38 pts/3    00:00:03 /home/thredds/jdk1.6.0_14/bin/java 
-Djava.util.logging.config.file=/home/thredds/apache-tomcat-6.0.20/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.endorsed.dirs=/home/thredds/apache-tomcat-6.0.20/endorsed -classpath :/home/thredds/apache-tomcat-6.0.20/bin/bootstrap.jar -Dcatalina.base=/home/thredds/apache-tomcat-6.0.20 -Dcatalina.home=/home/thredds/apache-tomcat-6.0.20 -Djava.io.tmpdir=/home/thredds/apache-tomcat-6.0.20/temp org.apache.catalina.startup.Bootstrap start 
</pre>




        <p>Open a new browser window/tab and go to <a href="http://localhost:8080/">http://localhost:8080/</a> to verify Tomcat is running:</p>

     <img src="../images/tomcat_default_page.gif" alt="Tomcat Default Home Page" />

       <li>See if you can shutdown Tomcat.</li>
        <p>Run the <code><small>$TOMCAT_HOME/bin/shutdown.sh</small></code> script:</p>
<pre>
<b>$</b> $TOMCAT_HOME/bin/shutdown.sh
</pre>
      </ol>


      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting Tips</h4>
       <ul>
        <li>Check the logs mostly recently generated in <code><small>$TOMCAT_HOME/logs</small></code> for clues about why Tomcat failed to start or stop.</li>
        <li>Pay particular attention to what is being reported in Tomcat's main log file: <code><small>$TOMCAT_HOME/logs/catalina.out</small></code>.</li>
       </ul>
      </div>


     </div> <!-- end subsection -->



     <div id="subsection">
      <h3>Setting <code>$JAVA_HOME</code>, <code>$JAVA_OPTS</code> and <code>$CATALINA_HOME</code></h3>
       <p>We are going to create a file called <code><small>setenv.sh</small></code> in the <code><small>$TOMCAT_HOME/bin</small></code> directory to:</p>
      <ul class="little">
       <li>allow Tomcat to reference/find the location of <code><small>$JAVA_HOME</small></code>  and <code><small>$TOMCAT_HOME</small></code>  (aka <code><small>$CATALINA_HOME</small></code>) during startup and shutdown; and </li>
       <li>increase the amount of memory allocated to the JVM to enhance performance by setting <code><small>$JAVA_OPTS</small>.</code> 
      </ul>

      <div id="expanded" class="question">
       <p>Why are we setting <code><small>$JAVA_HOME</small></code> and <code><small>$CATALINA_HOME</small></code> if we already have set them in our environment? </p>
      </div>
      <div id="expanded" class="question">
       <p> Which Java is Tomcat currently using?  (Hint:  what was sent to <code><small>STDOUT</small></code> when running the <code><small>startup.sh</small></code> and <code><small>shutdown.sh</small></code>?)</p>
      </div>


      <ol>
       <li>Create <code>setenv.sh</code> file.</li>
        <p>Using your favorite text editor (gedit, vi, emacs, nano, etc.), create a new file called <code><small>setenv.sh</small></code> in <code><small>$TOMCAT_HOME/bin</small></code> and add the following information to it:</p>

<pre>
<b>$</b>  pwd 
/home/thredds/apache-tomcat-6.0.20/bin/
<b>$</b> vi setenv.sh
</pre>

        <p>Add the following information and save <code><small>setenv.sh</small></code>:</p>
<pre>
#!/bin/sh
#
# ENVARS for Tomcat and TDS environment
#
JAVA_HOME="/home/thredds/jdk1.6.0_14"
export JAVA_HOME
JAVA_OPTS="-Xmx4080m -Xms512m -server -Djava.awt.headless=true"
export JAVA_OPTS
CATALINA_HOME="/home/thredds/apache-tomcat-6.0.20"
export CATALINA_HOME
</pre>
        <p>The parameters we pass to <code><small>$JAVA_OPTS</small></code>:</p>
        <ul class="little">
         <li><code><small>-Xms</small></code> is the initial allocated memory of the JVM (for performance).</li>
         <li><code><small>-Xmx</small></code> the maximum allocated memory of the JVM (for performance).</li>
         <li><code><small>-server</small></code> tells the Hostspot compiler to run the JVM in "server" mode.</li>
         <li><code><small>-Djava.awt.headless=true</small></code> eis needed to prevent graphics rendering code to assume that a graphics console exists. Without this, WMS code will crash the server in some circumstances.</li>
        </ul>
 
       <li>Restart Tomcat to implement your changes.</li>
        <p>Restart Tomcat and examine the output generated to the terminal window by the startup script:</p>
<pre>
<b>$</b> $TOMCAT_HOME/bin/startup.sh
Using CATALINA_BASE:   /home/thredds/apache-tomcat-6.0.20
Using CATALINA_HOME:   /home/thredds/apache-tomcat-6.0.20
Using CATALINA_TMPDIR: /home/thredds/apache-tomcat-6.0.20/temp
Using JRE_HOME:       /home/thredds/jdk1.6.0_14
</pre>
      <div id="expanded" class="question">
       <p>Did you notice any difference in the what is being reported to <code><small>STDOUT</small></code> during startup?</p>
      </div>
  
        <p>Take a look at the running Tomcat process to see the new <code><small>$JAVA_OPTS</small></code> settings:</p>

<pre>
<b>$</b> ps -ef | grep tomcat
thredds  5623     1  1 15:40 pts/3    00:00:23 /home/thredds/jdk1.6.0_14/bin/java 
-Djava.util.logging.config.file=/home/thredds/apache-tomcat-6.0.20/conf/logging.properties -Xmx4080m -Xms512m Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.endorsed.dirs=/home/thredds/apache-tomcat-6.0.20/endorsed -classpath :/home/thredds/apache-tomcat-6.0.20/bin/bootstrap.jar -Dcatalina.base=/home/thredds/apache-tomcat-6.0.20 -Dcatalina.home=/home/thredds/apache-tomcat-6.0.20 -Djava.io.tmpdir=/home/thredds/apache-tomcat-6.0.20/temp org.apache.catalina.startup.Bootstrap start 
</pre>

      <div id="expanded" class="question">
       <p>What allows us to create the <code><small>setenv.sh</small></code> file and have its contents read?   (Hint: have a look at the <code><small>$TOMCAT_HOME/bin/catalina.sh</small></code> starting around line 110).</p>
      </div>
      </ol>
     </div> <!-- end subsection -->



      <div id="subsection" class="exercise">
       <h3>Exercise Two: Set <code>$JAVA_HOME</code>, <code>$JAVA_OPTS</code> and <code>$CATALINA_HOME</code></h3>
       <ol>
        <li>Create a <code>setenv.sh</code> file in <code>$TOMCAT_HOME/bin/</code> to set <code>$JAVA_HOME</code>, <code>$JAVA_OPTS</code> and <code>$CATALINA_HOME</code>.</li>

       </ol>
      </div>


   </div> <!-- end section -->


   <div id="section">
    <h2><a name="deploying">Deploying the TDS</a></h2>

     <div id="subsection">
      <h3>Downloading &amp; Deploying <code>thredds.war</code></h3>

      <div id="info">
       <h4>Upgrading the TDS</h4>
       <p>The <a href="">reference</a> documentation contains information on <a href="">upgrading</a> the TDS. </p>
      </div>


      <ol>
       <li>Download the TDS WAR file from Unidata's web site.</li>
        <p>We will be using the TDS 4.0 development version for this workshop:</p>
        <p><code>thredds.war</code></p>
       <li>Deploy the TDS in Tomcat.</li>
        <p>Put <code><small>thredds.war</small></code> in the Tomcat <code><small>webapps/</small></code> directory.:</p>

<pre>
<b>$</b> cp thredds.war $TOMCAT_HOME/webapps
<b>$</b> cd $TOMCAT_HOME/webapps

<b>$</b> ls -l
total 10284
drwxr-xr-x 11 thredds workshop     4096 2009-05-13 17:15 docs
drwxr-xr-x  5 thredds workshop     4096 2009-05-13 17:15 examples
drwxr-xr-x  5 thredds workshop     4096 2009-05-13 17:15 host-manager
drwxr-xr-x  5 thredds workshop     4096 2009-05-13 17:15 manager
drwxr-xr-x  3 thredds workshop     4096 2009-05-13 17:15 ROOT
-rw-r--r--  1 thredds workshop 23288479 2009-05-13 17:23 thredds.war
</pre>

        <p>About WAR files:</p>

       <ul class="little">
        <li>WAR is short for Web ARchive</li>
        <li><i>If configured</i> Tomcat will automatically unpack the WAR distribution into directory of the same name upon deployment</li>
        <li>Note: the unpacked directory is overwritten each time a new WAR file is deployed.</li>
        </ul>
       <li>Confirm the TDS has been deployed.</li>
        <p>Restart Tomcat and confirm the <code><small>thredds.war</small></code> file was unpacked in the <code><small>webapps/</small></code> directory:</p>

<pre>
<b>$</b> $TOMCAT_HOME/bin/startup.sh

<b>$</b> ls -l
total 10284
drwxr-xr-x 11 thredds workshop     4096 2009-05-13 17:15 docs
drwxr-xr-x  5 thredds workshop     4096 2009-05-13 17:15 examples
drwxr-xr-x  5 thredds workshop     4096 2009-05-13 17:15 host-manager
drwxr-xr-x  5 thredds workshop     4096 2009-05-13 17:15 manager
drwxr-xr-x  3 thredds workshop     4096 2009-05-13 17:15 ROOT
drwxr-xr-x  7 thredds workshop     4096 2009-05-13 17:23 thredds
-rw-r--r--  1 thredds workshop 23288479 2009-05-13 17:23 thredds.war
</pre>

 <p>Go to <a href="http://localhost:8080/thredds/">http://localhost:8080/thredds/</a> in your browser to verify the TDS has been deployed:</p>

     <img src="../images/distribution_catalog.gif" alt="THREDDS Distribution Catalog" />

      </ol>
      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting Tips</h4>
       <ul>
        <li>Any error in the deployment will be reported in <code><small>$TOMCAT_HOME/logs/catalina.out</small></code>. </li>
        <li>Be sure you have downloaded and deployed the TDS 4.0 development version for this workshop (the version number will appear in the blue bar at the bottom of TDS catalog pages).</li>
       </ul>
      </div>

     </div> <!-- end subsection -->


      <div id="subsection" class="exercise">
       <h3>Exercise Three: Deploy your own instance of the THREDDS Data Server</h3>
       <ol>
        <li>Deploy the TDS in your newly-installed Tomcat.</li>
        <li>Once deployed, browse the test catalogs & datasets that come with the distribution.</li>
        <li>Look at the directory contents of <code>$TOMCAT_HOME</code>.</li>
      <div class="exercise_question">
       <p>Do you notice anything new?</p>
      </div>

       </ol>
      </div>


   </div> <!-- end section -->

 
   <div id="section">

    <h2><a name="deploying">A Cursory Look at Log Files</a></h2>




     <div id="subsection">
      <h3><code>$TOMCAT_HOME/logs/</code></h3>
      <ol>
       <li>Look at the different types of log files being generated in <code>$TOMCAT_HOME/logs/</code>.</li>
        <p>Move into the <code><small>logs</small></code> directory to see the type of information being logged:</p>

<pre>
<b>$</b> cd $TOMCAT_HOME/logs
<b>$</b> ls -l
total 10284
-rw-r--r-- 1 thredds workshop     0 2009-05-13 17:35 admin.2008-11-06.log
-rw-r--r-- 1 thredds workshop 10050 2009-05-13 17:41 catalina.2008-11-06.log
-rw-r--r-- 1 thredds workshop 10610 2009-05-13 17:41 catalina.out
-rw-r--r-- 1 thredds workshop     0 2009-05-13 17:35 host-manager.2008-11-06.log
-rw-r--r-- 1 thredds workshop  2760 2009-05-13 17:41 localhost.2008-11-06.log
-rw-r--r-- 1 thredds workshop     0 2009-05-13 17:35 manager.2008-11-06.log
</pre>

      <div id="expanded" class="question">
       <p>Do you see a correspondence between some of the web applications in the <code><small>$TOMCAT_HOME/webapps/</small></code> directory and the naming of certain log files?</p>
      </div>
      <div id="expanded" class="question">
       <p>Is there a difference in information being logged to <code><small>catalina.out</small></code> verses <code><small>catalina.YYYY-MM-DD.log</small></code>?</p>
      </div>
      <div id="expanded" class="question">
       <p>Are some log files more verbose than others?</p>
      </div>

       <li>Examining <code>catalina.out</code></li>
        <p>Open another terminal window (hereafter refered to as terminal #2) and run the following command in the new terminal:</p>
<pre>
<b>$</b> tail -f /home/thredds/apache-tomcat-6.0.20/logs/catalina.out
</pre>
<p>In your original terminal window, start/stop and start Tomcat and watch what is being logged to <code>catalina.out</code> in the terminal #2 window.</p>
      <div id="expanded" class="question">
       <p>Is it only errors messages being reported to <code><small>catalina.out?</small></code></p>
      </div>
      <div id="expanded" class="question">
       <p>What messages in <code><small>catalina.out</small></code> are from the TDS?</p>
      </div>

      <div id="info">
       <h4>About <code>catalina.out</code></h4>
       <p>The <a href="http://marc.info/?l=tomcat-user&w=2&r=1&s=catalina.out+rotate&q=b">Tomcat Users mailing list</a> has seen a lot of traffic dedicated to <code><small>catalina.out</small></code> logging and rotation.</p>
      </div>

        <p>A few things to know about <code><small>catalina.out</small></code>:</p>

       <ul class="little">
        <li>Tomcat <code><small>System.out</small></code> and <code><small>System.err</small></code> gets appended to <code><small>catalina.out</small></code>.  </li>
        <li><code><small>catalina.out</small></code> can quicly grow large if the hosted web applications are not specifically catching and logging <code><small>System.out</small></code> and <code><small>System.err</small></code> to designated files.</li>
        <li><code><small>catalina.out</small></code> is not automatically rotated in Tomcat.</li>
        <li>You will need to employ an outside log rotation program (e.g., <code><small>logadm</small></code> or <code><small>logrotate</small></code>) to rotate <code><small>catalina.out</small></code>.</li>

        </ul>
     </div> <!-- end subsection -->

   </div> <!-- end section -->










   <p><img src="../images/thread.png" height="60" alt="THREDDS" valign="top" align="left" vspace="0" hspace="10" />  This document is maintained by Unidata and was last updated 
   
<script language="JavaScript" type="text/JavaScript">
    document.write(date_modified);
</script> 
Send comments to <a href="mailto:support-thredds@unidata.ucar.edu">THREDDS support</a>.</p>
  </body>
 </html>   
