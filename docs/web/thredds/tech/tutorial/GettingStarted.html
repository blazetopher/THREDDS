<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
 <html>
  <head>
   <title>TDS Tutorial: Getting Started</title>
    <style type="text/css">
     pre {font-size: 9pt; padding: 10px; background-color: #E7E7E7; border: 1px solid #CFCFCF; width: 60%;}
     code {font-size: 11pt;}
     dl {margin: 10px 5px 5px 15px;)
   </style>

  </head>
  <body>
   <h1><img src="../images/THREDDSlogo.jpg" height="54" width="67">TDS Tutorial: Getting Started</h1>
   <hr>
  
   <h2>Installing Java &amp; Tomcat</h2>

   <dl>
    <dt><h3>System requirements</h3></dt>
     <ul>
       <li>Sun Java 1.5 or above, (we recommend the latest version of Java 1.6)</li>
       <li>Apache Tomcat 5.5 or above, (we recommend the latest version of Tomcat 6.0)</li>
     </ul>
     <p>Note: while there are different distributors of Java and servlet containers, Unidata develops, uses and tests the THREDDS Data Server using Sun Java and the Apache Tomcat servlet container.</p>



    <dt><h3>Installing Java</h3></dt>
     <ol>
      <li><a href="http://java.sun.com/javase/downloads/">Download</a> current Java SE Developer Kit (JDK) from Sun.</li> 
       <ul>
        <li>We will be using the Linux x64-bit, non-rpm, self-extracting file for this workshop:</li>
         <p><code>jdk-6u10-linux-x64.bin</code></p>
       </ul>
      <li>Install the JDK as per the Sun <a href="http://java.sun.com/javase/6/webnotes/install/">installation instructions</a>.</li>      
       <ul>
        <li>Copy the self-extracting file to the installation directory (our home directory is the installation directory in this example):</li>
<pre>
<b>-bash-3.2$</b> cp jdk-6u10-linux-x64.bin ~
<b>-bash-3.2$</b> cd 
</pre>
        <li>If needed, change the permissions on the file to be executable:</li>

<pre>
<b>-bash-3.2$</b> ls -l jdk-6u10-linux-x64.bin
-rw-r--r--  1 thredds Unidata 72753411 2008-10-02 16:39 jdk-6u10-linux-x64.bin

<b>-bash-3.2$</b> chmod 755 jdk-6u10-linux-x64.bin

<b>-bash-3.2$</b> ls -l jdk-6u10-linux-x64.bin
-rwxr-xr-x 1 thredds Unidata 72753411 2008-10-02 16:39 jdk-6u10-linux-x64.bin
</pre>

        <li>Run self-extracting file and agree to the terms of the code license:</li>

<pre>
<b>-bash-3.2$</b> ./jdk-6u10-linux-x64.bin
</pre>
       </ul>
      <li>Set the <code>$JAVA_HOME</code> environment variable.</li>   
<pre>
<b>-bash-3.2$</b> export JAVA_HOME=/home/thredds/jdk1.6.0_10

<b>-bash-3.2$</b> echo $JAVA_HOME
/home/thredds/jdk1.6.0_10
</pre>
     </ol> 
     <p>Troubleshooting:</p>
       <ul>
        <li>Make sure you have the needed permissions to perform the installation.</li>
        <li>Check to make sure the JDK self-extracting file has the correct permissions and is executable.</li>
        <li>Depending on your OS (e.g., Solaris), you may need install <i>both</i> the 32-bit and 64-bit self-extracting files.</li>
       </ul>
     <p>Note: the latest version of the JDK 1.6 has already been installed on your workshop computer at <code>/opt/jdk</code></p>




    <dt><h3>Installing Tomcat</h3></dt>
     <ol>
      <li><a href="http://tomcat.apache.org/">Download</a> current version of the Tomcat servlet container.</li> 
       <ul>
        <li>We will be using the binary tar.gz file for this workshop:</li>
         <p><code>apache-tomcat-6.0.18.tar.gz</code></p>
       </ul>
      <li>Install Tomcat as per the Apache Tomcat <a href="http://tomcat.apache.org/tomcat-6.0-doc/setup.html">installation instructions</a>.</li>    
       <ul>
        <li>Copy the binary tar.gz file to the installation directory (our home directory is the installation directory in this example):</li>
<pre>
<b>-bash-3.2$</b> cp apache-tomcat-6.0.18.tar.gz ~
<b>-bash-3.2$</b> cd 
</pre>
        <li>Unpack the archive to create Tomcat directory:</li>

<pre>
<b>-bash-3.2$</b> tar xvzf apache-tomcat-6.0.18.tar.gz

<b>-bash-3.2$</b> ls -ld apache-tomcat*
drwxr-xr-x  9 thredds Unidata 4096 2008-10-17 16:00 apache-tomcat-6.0.18
-rw-r--r-- 1 thredds Unidata 6142197 2008-07-30 03:51 apache-tomcat-6.0.18.tar.gz
</pre>   
       </ul>

      <li>Set the <code>$TOMCAT_HOME</code> environment variable.</li>   
<pre>
<b>-bash-3.2$</b> export TOMCAT_HOME=/home/thredds/apache-tomcat-6.0.18

<b>-bash-3.2$</b> echo $TOMCAT_HOME
/home/thredds/apache-tomcat-6.0.18
</pre>
     </ol> 
     <p>Note: Tomcat has already been installed on your workshop computer at <code>/opt/apache-tomcat-6.0.18</code></p>


   </dl>



   <h2>Tomcat directory structure: quick tour</h2>
   <dl>
    <dt><h3>Exploring <code>$TOMCAT_HOME</code></h3></dt>
     <p>Move into the new tomcat directory and have a look at the directory structure:</p>
<pre>
<b>-bash-3.2$</b> cd apache-tomcat-6.0.18/
<b>-bash-3.2$</b> ls -l --group-directories-first
total 88
drwxr-xr-x 2 thredds Unidata  4096 2008-10-28 16:45 bin
drwxr-xr-x 2 thredds Unidata  4096 2008-10-28 16:52 conf
drwxr-xr-x 2 thredds Unidata  4096 2008-10-28 16:45 lib
drwxr-xr-x 2 thredds Unidata  4096 2008-10-28 16:47 logs
drwxr-xr-x 2 thredds Unidata  4096 2008-10-28 16:45 temp
drwxr-xr-x 7 thredds Unidata  4096 2008-07-21 18:01 webapps
drwxr-xr-x 3 thredds Unidata  4096 2008-10-28 16:47 work
-rw-r--r-- 1 thredds Unidata 37951 2008-07-21 18:01 LICENSE
-rw-r--r-- 1 thredds Unidata   556 2008-07-21 18:01 NOTICE
-rw-r--r-- 1 thredds Unidata  7317 2008-07-21 18:01 RELEASE-NOTES
-rw-r--r-- 1 thredds Unidata  6587 2008-07-21 18:01 RUNNING.txt
</pre>



    <dt><h3>Noteworthy directories</h3></dt>
    <p><code>bin/</code> - Startup, shutdown, and other scripts.</p> 
        <ul>
         <li>The *.sh files (for Unix systems) are functional duplicates of the *.bat files (for Windows systems).</li>
         <li>We will be examining in further detail:</li>
         <ul>
          <li><code>startup.sh</code></li>
          <li><code>shutdown.sh</code></li>
         </ul>
        </ul>
      <p><code>conf/</code> - Tomcat configuration files.</p> 
        <ul>
         <li><i>Server-wide</i> configuration including logging, authentication and access control, SSL, performance settings, etc.</li>
         <li>We will be examining in further detail:</li>
         <ul>
          <li><code>server.xml</code></li>
          <li><code>tomcat-users.xml</code></li>
         </ul>
        </ul>
      <p><code>logs/</code> - Log files are here by default.</p> 
        <ul>
         <li>Log files are your first stop for troubleshooting tomcat and TDS issues.</li>
         <li>Logs files may contain useful information for assessing the security of your system.</li>
         <li>We will be examining in further detail:</p>
         <ul>
          <li><code>catalina.out</code></li>
          <li><code>access.YYYY-MM-DD.log</code></li>
         </ul>
        </ul>
      <p><code>webapps/</code> - Web applications directories and WAR files.</p>
        <ul>
         <li>We will be examining in further detail:</p>
         <ul>
          <li><code>manager</code> web application that comes with the Tomcat distribution.</li>
         </ul>
         <li>This is where we will be putting the TDS web application.</li>
        </ul>
     </dl>

  
   <h2>Running Tomcat</h2>
   <dl>
    <dt><h3>Starting &amp; Stopping Tomcat</h3></dt>
    <ul>
     <li>Move into the Tomcat bin directory and run the <code>startup.sh</code> script:</li>
<pre>
<b>-bash-3.2$</b> cd $TOMCAT_HOME/bin
<b>-bash-3.2$</b> ./startup.sh
</pre>   
     <li>Go to <a href="http://localhost:8080/">http://localhost:8080/</a> in your browser and verify Tomcat is running:</li>

     <p><img src="../images/tomcat_default_page.gif" height="400" width="400"></p>

     <li>Run the <code>shutdown.sh</code> script to shutdown Tomcat:</li>
<pre>
<b>-bash-3.2$</b> ./shutdown.sh
</pre>   

     </ul>

     <p>Troubleshooting:</p>
       <ul>
        <li>Check the logs generated in <code>$TOMCAT_HOME/logs</code> for clues about why tomcat failed to start.</li>
       </ul>





    <dt><h3>Set the <code>JAVA_HOME</code>, <code>JAVA_OPTS</code> and <code>CATALINA_HOME</code> environment variables</h3></dt>
    <p>We are going to modify the <code>startup.sh</code> and <code>shutdown.sh</code> scripts in the Tomcat <code>/bin</code> directory:</p>
    <ol>
     <li>to allow Tomcat to reference/find the location of <code>$JAVA_HOME</code> and <code>$TOMCAT_HOME</code> (aka <code>$CATALINA_HOME</code>) during startup and shutdown; and </li>
     <li>increase the amount of memory allocated to the JVM to enhance performance by setting <code>$JAVA_OPTS</code>.</li>
    </ol>
    <p></p>
    <ul>
     <li>Using your editor of choice (gedit, vi, emacs, etc.), edit <i>both</i> the <code>startup.sh</code> and <code>shutdown.sh</code> scripts:</li>
<pre>
<b>-bash-3.2$</b> vi startup.sh
</pre>

     <li>Add the following environmental variable declarations immediately after the comments section near the top of each file:</li>
<pre>
# -----------------------------------------------------------------------------
# Start Script for the CATALINA Server
#
# $Id: startup.sh 562770 2007-08-04 22:13:58Z markt $
# -----------------------------------------------------------------------------


JAVA_HOME="/home/thredds/jdk1.6.0_10"
export JAVA_HOME
JAVA_OPTS="-Xmx1024m -Xms512m -server"
export JAVA_OPTS
CATALINA_HOME="/home/thredds/apache-tomcat-6.0.18"
export CATALINA_HOME


# Better OS/400 detection: see Bugzilla 31132
os400=false
darwin=false
case "`uname`" in
CYGWIN*) cygwin=true;;
OS400*) os400=true;;
Darwin*) darwin=true;;
esac

</pre>   
     </ul>
  </dl>


   <h2>Deploying the TDS</h2>
   <dl>
    <dt><h3><code>thredds.war</code></h3></dt>
      <p><a href="/downloads/thredds/index.jsp">Download</a> the TDS WAR file and save it in the Tomcat <code>webapps/</code>  directory.</p>
<pre>
<b>-bash-3.2$</b> cp thredds.war $TOMCAT_HOME/webapps
<b>-bash-3.2$</b> cd $TOMCAT_HOME/webapps

<b>-bash-3.2$</b> ll
total 10284
drwxr-xr-x 11 thredds Unidata     4096 2008-10-28 16:45 docs
drwxr-xr-x  5 thredds Unidata     4096 2008-10-28 16:45 examples
drwxr-xr-x  5 thredds Unidata     4096 2008-10-28 16:45 host-manager
drwxr-xr-x  5 thredds Unidata     4096 2008-10-28 16:45 manager
drwxr-xr-x  3 thredds Unidata     4096 2008-10-28 16:45 ROOT
-rw-r--r--  1 thredds Unidata 10491917 2008-10-28 17:08 thredds.war
</pre>
       <p>About WAR files:</p>
       <ul>
        <li>WAR is short for Web ARchive</li>
        <li><i>If configured</i> Tomcat will automatically unpack the WAR distribution into directory of the same name upon deployment</li>
        <li>Note: the unpacked directory is overwritten each time the application is deployed.</li>
      </ul>



    <dt><h3>Browse distribution test catalogs &amp; datasets</h3></dt>
     <ul>
      <li>Start Tomcat and confirm the <code>thredds.war</code> file was unpacked in the <code>webapps/</code> directory.</li>
<pre>
<b>-bash-3.2$</b> cd $TOMCAT_HOME
<b>-bash-3.2$</b> bin/startup.sh

<b>-bash-3.2$</b> ls -l webapps
total 10288
drwxr-xr-x 11 thredds Unidata     4096 2008-10-28 16:45 docs
drwxr-xr-x  5 thredds Unidata     4096 2008-10-28 16:45 examples
drwxr-xr-x  5 thredds Unidata     4096 2008-10-28 16:45 host-manager
drwxr-xr-x  5 thredds Unidata     4096 2008-10-28 16:45 manager
drwxr-xr-x  3 thredds Unidata     4096 2008-10-28 16:45 ROOT
drwxr-xr-x  7 thredds Unidata     4096 2008-10-28 17:15 thredds
-rw-r--r--  1 thredds Unidata 10491917 2008-10-28 17:08 thredds.war
</pre>   

      <li>Go to <a href="http://localhost:8080/thredds/">http://localhost:8080/thredds/</a> in your browser to verify the TDS has been deployed.</li>
     </ul>

   </dl>



   <h2>Exercises</h2>
   <dl>
    <dt><h3>Exercise 1. Deploy your own instance of the THREDDS Data Server</h3></dt>
     <ol>
      <li>Using the outline above, install the JDK, Tomcat, and the TDS in <code>/home/thredds</code></li>
      <li>Once deployed, browse the test catalogs &amp; datasets that come with the distribution.</li>
     </ol>

    <dt><h3>Extra credit: Have a look at the log files generated by Tomcat</h3></dt>
     <ol>
      <li>Poke around <code>$TOMCAT_HOME/logs</code> and see the type of information that is being logged.</li>
     </ol>


    <dt><h3>Extra credit: Who is running Tomcat?</h3></dt>
    <ol>
     <li>Using the <code>ps</code> command, look to see what user is running the Tomcat process after it has been started.</li>
<pre>
<b>-bash-3.2$</b> ps -ef | grep tomcat
</pre>   
     If unfamiliar with the <code>ps</code> command, look at the man page for <code>ps</code>: 
<pre>
<b>-bash-3.2$</b> man ps
</pre>   
     <li>Why would we want to run Tomcat as an <a href="../reference/TomcatUserAndGroup.html">unprivileged user</a>?</li>

    </ol>
     

   </dl>


<p>&nbsp;<p>
   <hr>
   <address>
    <img src="../images/thread.png" height="108" width="110">
    This document is maintained by Unidata and was last updated on October 28, 2008. Send comments to <a href="mailto:support-thredds@unidata.ucar.edu">THREDDS support</a>.
   </address>

  </body>
 </html>


