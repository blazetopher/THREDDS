<title>Security Steps </title>
<h3>- Run as unprivileged user</h3>  (discussed in first time Tomcat installation)

<h3>- Use a Firewall</h3> (discussed in first time Tomcat installation)

<h3>- Critical files to restrict access</h3>

Make sure that everything under ${tomcat_home}/conf can be read only by the 
tomcat user. Typically you would also give write access to the tomcat user.

<!--

<h3><strong>- Enable Secure Sockets Layer (SSL)</h3></strong>

<p>We  ensure that no one can intercept and read sensitive information to and from the server (through doing what's called <em>network sniffing</em>) by encrypting the information using SSL. To enable this, do the following: </p>
<ol>
  <li>Create a certificate keystore by executing the following command:
    <blockquote>
  <pre><strong>${java_home}/bin/keytool -genkey -alias tomcat -keyalg RSA -validity 365</strong></pre>
  </blockquote>
    <p>    You will then get a set of prompts:</p>
    <blockquote>
      <pre>Enter keystore password: <strong>changeit</strong></pre>
      <pre>What is your first and last name? [Unknown]: <strong>www.mydomain.edu</strong></pre>
      <pre>What is the name of your organizational unit? [Unknown]: </pre>
      <pre>What is the name of your organization? [Unknown]: </pre>
      <pre>What is the name of your City or Locality? [Unknown]: </pre>
      <pre>What is the name of your State or Province? [Unknown]: </pre>
      <pre>What is the two-letter country code for this unit? [Unknown]: </pre>
      <pre>Is CN=*.ucar.edu, OU=UCAR Web Engineering Group, O=University Corporation for Atmospheric Research, L=Boulder, ST=Colorado, C=US correct?</pre>
      <pre>[no]: yes</pre>
      <pre>Enter key password for &lt;tomcat&gt;</pre>
      <pre>(RETURN if same as keystore password):</pre>
    </blockquote>
    <p>Be sure to  specify a password value of "changeit" and the web address of your Tomcat server for &quot;first and last name&quot;. The other values fill out as appropriate. This creates a <em>self-signed certificate</em> and puts it into the JDK's default keystore. Note the <strong>validity</strong> option on the command line, which is the number of days the certificate is valid. See <a href="http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/keytool.html">keytool documentation</a> for full description of managing keystores. </p>
  <li>
    <p>Edit <strong>${tomcat_home}/conf/server.xml</strong>, find the following section and uncomment it so it looks like: </p>
    <pre>    &lt;!-- Define a SSL Coyote HTTP/1.1 Connector on port 8443 --&gt;<br>    &lt;Connector port=&quot;8443&quot; <br>               maxThreads=&quot;150&quot; minSpareThreads=&quot;25&quot; maxSpareThreads=&quot;75&quot;<br>               enableLookups=&quot;false&quot; disableUploadTimeout=&quot;true&quot;<br>               acceptCount=&quot;100&quot; debug=&quot;0&quot; scheme=&quot;https&quot; secure=&quot;true&quot;<br>               clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot; /&gt;</pre>
  This enables Tomcat to use port 8443 for the HTTPS protocol, which uses SSL. All sensitive accesses will get redirected to that port.</li>
</ol>
<blockquote>
  <p> Note that if you choose to use a different port than 8443, you must also change the <strong>redirectPort=&quot;8443&quot;</strong> attribute on the regular (8080) Connector element in server.xml. </p>
</blockquote>
<h3>- Using a separate keystore </h3>
<p>You might prefer to keep your Tomcat keystore separate from the default JDK keystore, or to use a different password. Then modify the above as:</p>
<pre><strong>		</strong>${java_home}/bin/keytool -genkey -alias tomcat -keyalg RSA<strong> -<strong>keystore <strong>-validity 365</strong> &quot;/data/path/mykeystore&quot; </strong></strong></pre>
<pre>    &lt;Connector port=&quot;8443&quot; <br>               maxThreads=&quot;150&quot; minSpareThreads=&quot;25&quot; maxSpareThreads=&quot;75&quot;<br>               enableLookups=&quot;false&quot; disableUploadTimeout=&quot;true&quot;<br>               acceptCount=&quot;100&quot; debug=&quot;0&quot; scheme=&quot;https&quot; secure=&quot;true&quot;<br>               clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot;
               <strong>keystoreFile=&quot;/data/path/mykeystore&quot; keystorePass=&quot;mypassword&quot;</strong> /&gt;</pre>
<h3><strong>- Installing a Certificate from a Certificate Authority</strong></h3>
<p>The use of SSL in this way prevents a network sniffer from getting your password. A more sophisticated (and more difficult to perform) attack is the so called <em>man-in-the-middle</em> attack where someone pretends to be your server, and induces your client to send the password to it. </p>
<p>In the above,  we used self-signed certificates, and your browser will give you a warning  each time you access a web page that uses self-signed certificates. It will allow you to choose to continue however, and so a clever enough attacker might induce you to accept their self-signed certificate. To prevent this, you can obtain a certificate signed by a <em>Certificate Authority</em> (CA). You can then install it using <a href="http://jakarta.apache.org/tomcat/tomcat-5.0-doc/ssl-howto.html#Installing%20a%20Certificate%20from%20a%20Certificate%20Authority">these instructions</a>. The browser will see that its a valid certificate, and so you will never accept self-signed certificates and you will preclude man-in-the-middle attacks.</p>
<p>Obtaining and installing a CA signed certificate is a fair amount of work, but not really all that difficult. We recommend it if you plan on  leaving remote management  enabled in production mode.</p>
<h3>- Checking that the correct ports are enabled</h3>
<p>After restarting Tomcat, you can use <strong>netstat -an </strong>command to check that the ports are correctly configured. You should see lines like:</p>
<pre>  TCP    127.0.0.1:8080         0.0.0.0:0              LISTENING
  TCP    127.0.0.1:8443         0.0.0.0:0              LISTENING 
</pre>
<p>You also need to make sure that your firewall is allowing those ports through. </p>

//-->

<h3>- Default Tomcat applications</h3>

Tomcat ships with several default web applications, found in the 
${tomcat_home}/webapps directory. These defaults depend on the version of 
Tomcat and which installer you use.

<pre>
    * The ROOT application contains the server's main page. Any file that you 
      add under ${tomcat_home}/webapps/ROOT will be served.
    * The admin and manager applications are used for remote management. To 
      use these applications, you must add users with roles admin and manager, 
      respectively. The applications are then accessible from the main page, 
      and can be used to add further users, start and stop webapps, etc. You 
      should restrict the IP addresses that are allowed to run these 
      applications by editing the files admin.xml and manager.xml in the 
      ${tomcat_home}/conf/Catalina/localhost/ directory. Follow the directions
      the RemoteManagement section.
    * The servlets-examples and jsp-examples should probably be removed from a 
      production server, to minimize security exposure. You can do this from 
      the manager application or by deleting those directories from 
      ${tomcat_home}/webapps.
    * The tomcat-docs, balancer and webdav applications are probably harmless, 
      but can also be removed if you want.
</pre>

<h3>- Under the Remote Management Section, there are more security issues</h3>

<h3>- Java Security Manager</h3>

An additional level of security can be provided by running Tomcat with the 
Java Security Manager turned on. This can provide fine-grained security 
policies, at the cost of complexity in understanding what rights are needed to 
do any useful work, and how to grant them. This is needed if you allow 
untrusted servlets or JSPs to execute on your machine. If you are running just 
the THREDDS Data Server, you probably don't need to deal with this.

<h3>- Resources</h3>

  <li><a href="http://jakarta.apache.org/tomcat/faq/security.html">Tomcat Security FAQ</a> </li>
  <li><a href="http://www.amazon.com/exec/obidos/tg/detail/-/0672326361/qid=1119911434/sr=8-1/ref=sr_8_xs_ap_i1_xgl14/102-3771289-9904123?v=glance&s=books&n=507846">Tomcat 5 Unleashed </a>is a recent book about all aspects of Tomcat. </li>
  <li> <a href="http://www.amazon.com/exec/obidos/tg/detail/-/1861008309/ref%3Dpd%5Fsl%5Faw%5Falx-jeb-7-1%5Fbook%5F2595022%5F1/102-3771289-9904123">Apache Tomcat Security Handbook</a> dated but still useful, e.g. to use the Java Security Manager. Chapter 1 is online <a href="http://www.theserverside.com/articles/content/TomcatSecurity/TomcatSecurity.pdf">here</a>. </li>
  <li> <span name="intelliTxt" id="intelliTxt"><a href="http://www.oreilly.com/catalog/tomcat/">Tomcat: The Definitive Guide (O'Reilly)</a></span> also dated but  useful.The Security chapter is online <a href="http://www.oreilly.com/catalog/tomcat/chapter/ch06.pdf">here</a>. </li>

</pre>
