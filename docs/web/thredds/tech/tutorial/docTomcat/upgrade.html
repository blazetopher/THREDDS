<html>
<head>
<title>Upgrading</title>

</head>

<body>
<p>

<p>
Eventually one will want to upgrade to a new version of Tomcat or new version
of THREDDS Data Server but they will want to save the state of the present 
installation. Saving the state, avoids the problem of redoing the configuration or most
of the configurations. Also, if the upgraded is done correctly then it is 
possibile to
 return to the old installation easily if there is a problem with the new
installation.
</p>

<h2>Upgrading Tomcat and the TDS</h2>

<p>

For this tutorial it is assumed that apache-tomcat-5.5.17.tar.gz is the old
distribution and the new one is apache-tomcat-5.5.25.tar.gz. These steps are
done as user root and tomcat.

<pre>

- Go to where tomcat was installed 
% cd /opt

- Get tomcat5 distribution ie apache-tomcat-5.5.25.tar.gz from: 
	<a href="http://tomcat.apache.org">Apache Tomcat</a>

- Make Distribution directory and chown as root
% mkdir apache-tomcat-5.5.25
% chown tomcat:tomcat apache-tomcat-5.5.25

Unpack distribution  as tomcat
% tar xzvf apache-tomcat-5.5.25.tar.gz

<!--
- Remove/Make link from distribution directory to runtime
% cd ~tomcat
% rm runtime
% ln -s apache-tomcat-5.5.25 runtime
now /home/tomcat/runtime/ points to /home/tomcat/runtime/apache-tomcat-5.5.25
//-->

- Distribution directories should look like:
% ls apache-tomcat-5.5.25
logs/           NOTICE          server/
conf/           RUNNING.txt     RELEASE-NOTES
bin/            work/           common/
webapps/        LICENSE         shared/


- Go to bin directory and save original *sh in dist. If there isn't much change
  in the *sh scripts, one can copy them from the old distribution
% cd /home/tomcat/apache-tomcat-5.5.25/bin
% mkdir dist
% cp *sh dist
% cp /home/tomcat/apache-tomcat-5.5.17/bin/*sh .

The scripts need minor editing because the version has changed from:
apache-tomcat-5.5.17 -> apache-tomcat-5.5.25
edit *sh making the version changes.

- If you have changed users-tomcat.xml, you can copy the old version to the 
  new /home/tomcat/apache-tomcat-5.5.25/conf.
% cd /home/tomcat/apache-tomcat-5.5.25/conf
% cp /opt/apache-tomcat-5.5.17/conf/users-tomcat.xml .

</pre>
<p>
- If you have changed server.xml, and you are moving to a new major version of 
tomcat (eg 5.0 to 5.5), you must manually change the new 
/home/tomcat/apache-tomcat-5.5.25/conf/server.xml using instructions at: <a href="../RemoteManagement.html">RemoteManagement</a> , do not copy the 
old file. For minor version upgrades (eg 5.5.17 to 5.5.25), you can probably 
just copy the old file.
<pre>
% cd /home/tomcat/apache-tomcat-5.5.25/conf
% cp /home/tomcat/apache-tomcat-5.5.17/conf/server.xml .

- Copy old configurations (content directory) over to the new configurations place.
% cd /home/tomcat/apache-tomcat-5.5.25
% cp -r /home/tomcat/apache-tomcat-5.5.17/content .

- Copy the SSL keystore file over to new distribution.
% cp /home/tomcat/apache-tomcat-5.5.17/.keystore .

- Copy or download thredds.war to /home/tomcat/apache-tomcat-5.5.25/webapps.
% cd /home/tomcat/apache-tomcat-5.5.25/webapps
% cp /home/tomcat/apache-tomcat-5.5.17/webapps/thredds.war .
 or
 download latest <a href="http://www.unidata.ucar.edu/projects/THREDDS/tech/ind
ex.html#TDS">thredds.war</a>

- Stop old version tomcat
% cd /home/tomcat/apache-tomcat-5.5.17/bin
% ./shutdown.sh

- Start new version tomcat
% cd /home/tomcat/apache-tomcat-5.5.25/bin
% ./startup.sh


</pre>

<h2>Upgrading TDS</h2>

<p>

Upgrading the TDS is simple, replace the thredds.war file and remove the
thredds directory.  These steps are done as user tomcat.

<pre>

- Download thredds.war to ${tomcat_home}/${tomcat_version/webapps.
% cd ${tomcat_home}/${tomcat_version/webapps
Download latest <a href="http://www.unidata.ucar.edu/projects/THREDDS/tech/index.html#TDS">thredds.war</a>

- Stop tomcat
% cd /home/tomcat/apache-tomcat-5.5.17/bin
% ./shutdown.sh

- Remove thredds directory
% rm -rf thredds

- Start tomcat
% cd /home/tomcat/apache-tomcat-5.5.25/bin
% ./startup.sh


<h2>Testng your TDS installation</h2>
<p>

At this point there should be a new apache-tomcat-5.5.25 TDS installation. 

<pre>
- In the ${tomcat_home}/${tomcat_version}/logs directory
% less catalina.out
The following line should appear if started ok.
	INFO: Starting service Catalina

Now one should see messages about the TDS server starting up. There
might be some error messages, but these are usually the result of some
start up processes not being synchronized. At this point, ignore them.

The tomcat check is to see if a browser can find tomcat
	http://localhost:8080 
	should see:
		If you're seeing this page via a web browser, it means you've setup Tomcat successfully. Congratulations!

The TDS check is to point your brower at:
	http://localhost:8080/thredds/catalog.html 

You should see the Thredds catalog. 

<!--
This initializes the 
content directories with defaults (after this step, you can edit these 
without worrying about them being overwritten).
// -->

</pre>

</body>
</html>
