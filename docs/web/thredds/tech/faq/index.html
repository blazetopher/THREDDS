<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>TDS FAQ</title>
</head>

<body>
<h1><img src="../images/unidataLogo.png" alt="Unidata" align="middle" height="75" width="75">THREDDS Data Server FAQ</h1>

<hr width="100%">

<h2>TDS FAQ</h2>
<p>
  <strong>Q: What do the non-HTTP status codes in the <code>threddsServlet.log</code> files mean?</strong></p>

<blockquote>
  <p> The "Request Completed" messages in the <code>threddsServlet.log</code> files contain
    several fields including a status code.
    the HTTP status code returned in a completed response. If a request is forwarded to
    another internal service, a "1000 (Forwarded)" or "1001 ( </p>
  <pre>
2009-06-17T13:25:54.451 -0600 [     28949][      11] INFO
  - thredds.server.catalogservice.LocalCatalogServiceController
  - handlePublicDocumentRequest(): Request Completed - 1001 - -1 - 32
  </pre>
</blockquote>

<p><strong>Q: I'm seeing the error &quot;Inconsistent array length read: 538976288 !=  1668244581' when I open the dataset in the IDV. Why?</strong></p>
<blockquote>
  <p>The error &quot;Inconsistent array length read&quot; only tells you that  there was an error on the server in the middle of responding to an OPeNDAP request. You then must look in the   <strong>threddsServlet.log</strong> and find the error to know why. <br>
  </p>
</blockquote>
<hr width="100%">
<h2>Tomcat<a name="tomcat"></a> FAQ </h2>
<p><strong>Q: Im getting the error &quot;java.lang.OutOfMemoryError: PermGen<a name="PermGen"></a> space&quot;. Whats up?</strong></p>
  <blockquote>
    <p>If you reload the <strong>thredds.war</strong> webapp enough times without restarting Tomcat, you will eventually run into &quot;<strong>java.lang.OutOfMemoryError: PermGen space</strong>&quot;. This is a known bug in  JDK/Tomcat. The only thing to do is to stop and restart Tomcat. </p>
    <p wrap="">You can increase PermGen using this JVM option:     </p>
    <p wrap=""><strong>-XX:MaxPermSize=128m    </strong></p>
    <p wrap="">On the JDK1.6 -server JVM, the default seems to be 64m.     However, with enough redeploys , you will eventually run out of PermGen space no matter what your <strong>MaxPermSize</strong> setting is. We have gotten into the habit of restarting tomcat on our production server whenever we redeploy. Lots of redeploys only happen on our test server.</p>
    <p>Resources:</p>
    <ul>
      <li><a href="http://blogs.sun.com/fkieviet/entry/classloader_leaks_the_dreaded_java">&quot;Classloader leaks&quot; (sun blog)</a> (2006-10-16)</li>
      <li>"<a href="http://my.opera.com/karmazilla/blog/2007/09/29/return-of-the-permgen">Return of the PermGen</a>" (2007-09-29)</li>
      <li>"<a href="http://my.opera.com/karmazilla/blog/2007/03/15/permgen-strikes-back">PermGen Strikes Back</a>" (2007-03-15)</li>
      <li>"<a href="http://my.opera.com/karmazilla/blog/2007/03/13/good-riddance-permgen-outofmemoryerror">Good Riddance PermGen OutOfMemoryError</a>" (2007-03-13)</li>
    </ul>
  </blockquote>
  <p><strong>Q: Who is accessing my server? </strong></p>
  <blockquote>
    <p>When you examine the TDS access logs, you can see who is accessing the TDS by IP address. Use <strong>nslookup &lt;ip address&gt;</strong> to find out the host name. </p>
  </blockquote>
  <p><strong>Q: How can I control whether I want Web crawlers to access my server?</strong></p>
  <blockquote>
    <p>Well-behaved web crawlers are supposed to look for a <strong>robots.txt</strong> file on the server and follow its instructions. To set up a robots.txt file that excludes web crawlers from crawling your server, follow <a href="../reference/Performance.html#robots">these directions</a>. </p>
  </blockquote>
  <p><strong>Q: How can I prevent someone from accessing my server? </strong></p>
  <blockquote>
    <p>If you want to prevent some annoying person from accessing your server, its best to exclude them using their  IP address, to avoid having to do a reverse DNS lookup for each request. To do so, edit <strong>${tomcat_home}/conf/server.xml</strong>, find the following section and add the following Valve element:</p>
    <pre>  &lt;Host name=&quot;localhost&quot; debug=&quot;0&quot; appBase=&quot;webapps&quot; .. &gt; 
    <strong>&lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot; deny=&quot;</strong>18.83.0.150<strong>&quot; /&gt; </strong> 
   ...
  &lt;/Host&gt;</pre>
    <p>You can use lists of IP addresses as well as wildcards: </p>
    <ul>
      <li><strong>deny="18.83.0.150<strong></strong>, 128.100.34.99, 128.117.140.*"</strong></li>
    </ul>
    <p>You need to restart the server before this will take effect.</p>
  </blockquote>
  <p><strong>Q: How do I remove Servlet Autodeploy?</strong></p>
  <blockquote>
    <p>Its recommendded to remove autodetection of changes while Tomcat is running, for performance reasons. In a production environment, its better to explicitly redeploy the application: </p>
    <pre>   &lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; <strong>autoDeploy=&quot;false&quot;</strong>
     xmlValidation=&quot;false&quot; xmlNamespaceAware=&quot;false&quot;&gt;
   ...
  &lt;/Host&gt;</pre>
  </blockquote>
  <p><strong>Q: How do I remove port 8009 when using tomcat in standalone mode:</strong></p>
  <blockquote>
    <p>Unless you are using Tomcat with the Apache server, comment out this line in <strong>server.xml:</strong> </p>
    <pre>  &lt;Connector port=&quot;8009&quot; enableLookups=&quot;false&quot; redirectPort=&quot;8443&quot; protocol=&quot;AJP/1.3&quot; /&gt;<br>
  </pre>
</blockquote>
  <h3>Tomcat Resources</h3>
  <ul>
    <li><a href="http://jakarta.apache.org/tomcat/faq/">Tomcat FAQ (Apache site)</a> </li>
    <li><a href="http://tomcat.apache.org/tomcat-5.5-doc/index.html">Tomcat 5.5 documentation</a></li>
    <li><a href="http://www.coreservlets.com/Apache-Tomcat-Tutorial/">tutorial</a></li>
  </ul>

  <hr>
<address>
<img src="../images/thread.png" alt="THREDDS" height="108" width="110">
  This document is maintained by Unidata and was last updated Oct 2009.
  Send comments to <a href="mailto:support-thredds@unidata.ucar.edu">THREDDS support</a>.
</address>

</body>
</html>